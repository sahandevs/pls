{"version":3,"sources":["data/PLSDB.ts","Utils.tsx","Components/Pages/ExchangePage.tsx","hooks/useIsSmallScreen.ts","Components/Pages/SetupCurrencies.tsx","Components/Pages/SetupExchangeRates.tsx","data/SystemsDB.ts","Components/Pages/Systems/Canvas.tsx","Components/Pages/Systems/BorderTrigger.tsx","Components/Pages/Systems/CanvasNode.tsx","Components/Pages/Systems/GoalView.tsx","Components/Pages/Systems/SystemView.tsx","Components/Pages/Systems/ConnectionsView.tsx","Components/Pages/Systems/SystemsPage.tsx","Components/App.tsx","serviceWorker.ts","index.tsx"],"names":["PLSDBContext","React","createContext","firebase","window","usePLSDBContext","result","useContext","Error","PLSDatabase","currencies","BehaviorSubject","exchangeRates","bank","dbRef","combineLatest","this","pipe","skip","distinct","debounceTime","subscribe","next","save","currency","newValue","value","find","x","name","Object","assign","push","map","bankOf","v","Math","max","exchangeRate","canExchange","take","newBank","from","to","rate","filter","uid","database","ref","on","s","JSON","parse","val","console","log","set","stringify","useObservable","obs","defaultValue","useState","setValue","useEffect","sub","unsubscribe","getOrAskUser","key","localStorage","getItem","prompt","setItem","ExchangeButtonBase","onDone","innerRef","db","MenuItem","disabled","onClick","exchange","unit","ExchangeButton","forwardRef","props","ExchangeItem","getExchangeRates","currentValue","anchorEl","setAnchorEl","handleClose","Card","variant","style","margin","Box","padding","display","flexDirection","Typography","Button","event","currentTarget","aria-controls","aria-haspopup","Menu","id","keepMounted","open","onClose","item","addToBank","SpendItem","canSpend1","canSpend","length","ExchangePage","getCurrencies","alignItems","flexWrap","justifyContent","isSource","Divider","useIsSmallScreen","useMediaQuery","CurrencyItem","isNew","setName","icon","setIcon","description","setDescription","setIsSource","isTime","setIsTime","setUnit","isSmallScreen","isEdited","content","Icon","TextField","label","onChange","e","target","Checkbox","checked","addOrUpdateCurrency","removeCurrency","SetupCurrencies","i","Item","setFrom","setTo","toString","rateValue","setRateValue","Number","isValid","isNaN","FormControl","InputLabel","Select","labelId","d","marginX","inputMode","addOrUpdateExchangeRate","removeExchangeRate","SetupExchangeRates","rates","PLACEHOLDER_GOAL","bounds","top","height","left","width","labels","SystemsDBContext","useSystemsDBContext","toKey","obj","SystemsDB","_forceUpdate","goals","connections","systems","config","zoomLevel","cameraPosition","y","updated","alert","goal","goalKey","_system","sysSubject","throttleTime","system","a","b","flatMap","updateFromDiff","data","old","_new","indexedOldTargets","targetsDiff","_olds","news","newAdded","existed","outer","deleted","includes","findDiff","targetUpdateResult","forEach","_subject","useStyles","makeStyles","rootContainer","innerContainer","position","calculateTransform","Canvas","containerRef","useRef","positionRef","styles","size","setSize","isHoldingMouseMiddleButton","keyCode","isDown","setIsDown","onMouseDown","button","onMouseUp","document","addEventListener","removeEventListener","useIsHoldinMouseKey","setScale","useMemo","updateDbConfig","useCallback","updateInnerRefStyle","animate","current","innerText","toPrecision","ANIMATION","setAttribute","onKeyUp","_doUpdateScale","onMouseWheel","deltaY","useLayoutEffect","body","cursor","onMouseMove","movementX","movementY","calculateAndUpdateSize","innerHeight","getBoundingClientRect","innerWidth","fromEvent","className","overflow","children","bottom","right","opacity","BorderTrigger","rowStyle","cornerStyle","borderWidth","hLineStyle","flex","vLineStyle","onMouseEnter","onTL","undefined","state","onMouseLeave","onT","onTR","onL","onR","onBL","onB","onBR","CanvasNode","isHoldingBorder","updateManager","initial","forceRefresh","setVal","c","useForceUpdate","lastBorderState","update","calculate","filteredResult","setTimeout","sendUpdate","updates","scale","handle","onDrag","positionOffset","offsetPosition","GoalView","isSelected","selectedGoal","updateGoalWithKey","getGoalInitialValue","tap","_pos","toFixed","_bounds","elevation","userSelect","confirm","deleteGoal","fontSize","alignSelf","newName","dangerouslySetInnerHTML","__html","Chip","labelValue","color","SystemView","systemGoals","getSystemGoals","systemKey","updateSystemWithKey","getSystemInitialValue","systemNameBorder","borderColor","borderStyle","borderRadius","borderTopLeftRadius","pointerEvents","deleteSystem","paddingLeft","paddingRight","borderLeft","borderTop","borderRight","ConnectionsView","getConnectionsWithKeys","stroke","fill","strokeWidth","connection","ConnectionView","fromGoalKey","toGoalKey","getGoalWithKey","getBoxToBoxArrow","bow","sx","sy","cx","cy","ex","ey","endAngleAsDegrees","PI","r","deleteConnection","points","transform","SystemsPage","getZoomLevel","getGoalsWithKey","getSystemsWithKey","isInCreateConnectionMode","setIsInCreateConnectionMode","selectedFirstGoal","setSelectedFirstGoal","createConnection","Tooltip","title","IconButton","goalName","createGoal","systemName","createSystem","App","page","setPage","plsDb","systemsDb","username","password","didSetupDb","localUID","setupIfNeeded","loadFromFirebase","auth","signInWithEmailAndPassword","then","user","catch","message","location","reload","Provider","CssBaseline","AppBar","Tabs","_","centered","Tab","marginTop","minWidth","Boolean","hostname","match","ReactDOM","render","getElementById","navigator","serviceWorker","ready","registration","unregister","error"],"mappings":"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","file":"static/js/main.c7b63933.chunk.js","sourcesContent":["import { Observable, BehaviorSubject, combineLatest } from \"rxjs\";\nimport { map, take, skip, distinct, debounceTime } from \"rxjs/operators\";\nimport React from \"react\";\n\nexport const PLSDBContext = React.createContext<PLSDatabase | null>(null);\nconst firebase = (window as any).firebase;\nexport function usePLSDBContext(): PLSDatabase {\n  const result = React.useContext(PLSDBContext);\n  if (result == null)\n    throw new Error(\"useDBContext used outside of the context\");\n  return result;\n}\nexport type Currency = {\n  name: string;\n  unit: string;\n  isTime: boolean;\n  isSource: boolean;\n  icon: string;\n  description: string;\n};\n\nexport type ExchangeRate = {\n  from: Currency;\n  to: Currency;\n  rate: number;\n};\n\nexport type Bank = { [key: string]: number };\n\nexport class PLSDatabase {\n  constructor() {\n    combineLatest(\n      this.bank.pipe(skip(1), distinct()),\n      this.exchangeRates.pipe(skip(1), distinct()),\n      this.currencies.pipe(skip(1), distinct())\n    )\n      .pipe(debounceTime(1000))\n      .subscribe({ next: () => this.save() });\n  }\n\n  private currencies = new BehaviorSubject<Currency[]>([]);\n  private exchangeRates = new BehaviorSubject<ExchangeRate[]>([]);\n  private bank = new BehaviorSubject<Bank>({});\n\n  addOrUpdateCurrency(currency: Currency) {\n    const newValue = [...this.currencies.value];\n    const result = newValue.find((x) => x.name === currency.name);\n    if (result != null) {\n      Object.assign(result, currency);\n    } else {\n      newValue.push(currency);\n    }\n    this.currencies.next(newValue);\n  }\n\n  bankOf(currency: Currency): Observable<number> {\n    return this.bank.pipe(\n      map((bank) => {\n        return bank[currency.name] ?? 0;\n      })\n    );\n  }\n\n  canSpend(currency: Currency, value: number): Observable<boolean> {\n    return this.bankOf(currency).pipe(map((v) => v - value >= 0));\n  }\n\n  addToBank(currency: Currency, value: number) {\n    this.bank.next({\n      ...this.bank.value,\n      [currency.name]: Math.max(\n        0,\n        (this.bank.value[currency.name] ?? 0) + value\n      ),\n    });\n  }\n\n  exchange(exchangeRate: ExchangeRate, value: number) {\n    this.canExchange(exchangeRate, value)\n      .pipe(take(1))\n      .subscribe({\n        next: (canExchange) => {\n          if (canExchange) {\n            const newBank = { ...this.bank.value };\n            if (newBank[exchangeRate.from.name] == null) {\n              newBank[exchangeRate.from.name] = 0;\n            }\n            newBank[exchangeRate.from.name] -= value;\n            if (newBank[exchangeRate.to.name] == null) {\n              newBank[exchangeRate.to.name] = 0;\n            }\n            newBank[exchangeRate.to.name] += value * exchangeRate.rate;\n            this.bank.next(newBank);\n          }\n        },\n      });\n  }\n\n  canExchange(exchangeRate: ExchangeRate, value: number): Observable<boolean> {\n    return this.bankOf(exchangeRate.from).pipe(map((v) => v >= value));\n  }\n\n  removeCurrency(currency: Currency) {\n    this.currencies.next(\n      this.currencies.value.filter((x) => x.name !== currency.name)\n    );\n  }\n\n  addOrUpdateExchangeRate(rate: ExchangeRate) {\n    const newValue = [...this.exchangeRates.value];\n    const result = newValue.find(\n      (x) => x.from.name === rate.from.name && x.to.name === rate.to.name\n    );\n    if (result != null) {\n      Object.assign(result, rate);\n    } else {\n      newValue.push(rate);\n    }\n    this.exchangeRates.next(newValue);\n  }\n\n  removeExchangeRate(rate: ExchangeRate) {\n    this.exchangeRates.next(\n      this.exchangeRates.value.filter(\n        (x) => x.from.name === rate.from.name && x.to.name === rate.to.name\n      )\n    );\n  }\n\n  getCurrencies(): Observable<Currency[]> {\n    return this.currencies;\n  }\n\n  getExchangeRates(): Observable<ExchangeRate[]> {\n    return this.exchangeRates;\n  }\n\n  dbRef: any;\n\n  loadFromFirebase(uid: string) {\n    this.dbRef = firebase.database().ref(`sync_data/${uid}`);\n    this.dbRef.on(\"value\", (s: any) => {\n      const result = JSON.parse(s.val() ?? \"{}\");\n      this.currencies.next(result[\"currencies\"] ?? []);\n      this.exchangeRates.next(result[\"exchangeRates\"] ?? []);\n      this.bank.next(result[\"bank\"] ?? {});\n      console.log(\"Updating\");\n    });\n  }\n\n  save() {\n    const result = {\n      currencies: this.currencies.value,\n      exchangeRates: this.exchangeRates.value,\n      bank: this.bank.value,\n    };\n    this.dbRef.set(JSON.stringify(result));\n    console.log(\"Saving\");\n  }\n}\n\nexport function CreateOrGetDefaultPLSDatabase(): PLSDatabase {\n  const db = new PLSDatabase();\n  return db;\n}\n","import { Observable } from \"rxjs\";\nimport React from \"react\";\nimport { distinct } from \"rxjs/operators\";\nexport function useObservable<T>(\n  obs: Observable<T> | (() => Observable<T>),\n  defaultValue: T\n): T {\n  const [value, setValue] = React.useState(defaultValue);\n  React.useEffect(() => {\n    const _obs = typeof obs === \"function\" ? obs() : obs;\n    const sub = _obs.pipe(distinct()).subscribe({\n      next: (v) => {\n        setValue(v);\n      },\n    });\n    return () => sub.unsubscribe();\n    // TODO: it doens't support when obs changes\n    // eslint-disable-next-line\n  }, []);\n  return value;\n}\n\nexport function getOrAskUser(key: string): string {\n  let value = localStorage.getItem(key);\n  if (value == null) {\n    value = prompt(key) ?? \"\";\n    localStorage.setItem(key, value);\n  }\n  return value;\n}\n\nexport function useForceUpdate(): VoidFunction {\n  const [, setVal] = React.useState(0);\n  const cb = React.useCallback(() => setVal((c) => c + 1), []);\n  return cb;\n}\n","import React from \"react\";\nimport {\n  Box,\n  Typography,\n  Divider,\n  Button,\n  Card,\n  MenuItem,\n  Menu,\n} from \"@material-ui/core\";\nimport { usePLSDBContext, Currency, ExchangeRate } from \"../../data/PLSDB\";\nimport { useObservable } from \"../../Utils\";\ntype ExchangeButtonBaseProps = {\n  exchangeRate: ExchangeRate;\n  value: number;\n  onDone: () => void;\n  innerRef: any;\n};\nfunction ExchangeButtonBase({\n  exchangeRate,\n  value,\n  onDone,\n  innerRef,\n}: ExchangeButtonBaseProps) {\n  const db = usePLSDBContext();\n  const canExchange = useObservable(db.canExchange(exchangeRate, value), false);\n  return (\n    <MenuItem\n      disabled={!canExchange}\n      innerRef={innerRef}\n      onClick={() => {\n        db.exchange(exchangeRate, value);\n        onDone();\n      }}\n    >{`1 ${exchangeRate.from.unit} of ${exchangeRate.from.name} to ${\n      value * exchangeRate.rate\n    } ${exchangeRate.to.unit} of ${exchangeRate.to.name}`}</MenuItem>\n  );\n}\n\nconst ExchangeButton = React.forwardRef((props: Omit<ExchangeButtonBaseProps, \"innerRef\">, ref) => (\n  <ExchangeButtonBase {...props} innerRef={ref} />\n));\n\nfunction ExchangeItem({ currency }: { currency: Currency }) {\n  const db = usePLSDBContext();\n  const exchangeRates = useObservable(db.getExchangeRates(), []);\n  const currentValue = useObservable(db.bankOf(currency), 0);\n  const [anchorEl, setAnchorEl] = React.useState<Element | null>(null);\n  const handleClose = () => {\n    setAnchorEl(null);\n  };\n\n  return (\n    <Card variant={\"outlined\"} style={{ margin: 3 }}>\n      <Box padding={2} display={\"flex\"} flexDirection={\"column\"}>\n        <Typography>{`${currentValue} ${currency.unit} of ${currency.name}`}</Typography>\n        <Button\n          onClick={(event) => setAnchorEl(event.currentTarget)}\n          aria-controls=\"menu\"\n          aria-haspopup=\"true\"\n        >\n          {\"Exchange\"}\n        </Button>\n        <Menu\n          id=\"menu\"\n          anchorEl={anchorEl}\n          keepMounted\n          open={anchorEl != null}\n          onClose={handleClose}\n        >\n          {exchangeRates\n            .filter((x) => x.from.name === currency.name)\n            .map((item) => (\n              <ExchangeButton\n                key={item.from.name + \"_\" + item.to.name}\n                exchangeRate={item}\n                value={1}\n                onDone={handleClose}\n              />\n            ))}\n        </Menu>\n        <Box display={\"flex\"} flexDirection={\"row\"}>\n          <Button onClick={(event) => db.addToBank(currency, 1)}>{\"+1\"}</Button>\n          <Button onClick={(event) => db.addToBank(currency, -1)}>\n            {\"-1\"}\n          </Button>\n        </Box>\n      </Box>\n    </Card>\n  );\n}\n\nfunction SpendItem({ currency }: { currency: Currency }) {\n  const db = usePLSDBContext();\n  const currentValue = useObservable(db.bankOf(currency), 0);\n  const canSpend1 = useObservable(db.canSpend(currency, 1), false);\n  const exchangeRates = useObservable(db.getExchangeRates(), []).filter(\n    (x) => x.from.name === currency.name\n  );\n  const [anchorEl, setAnchorEl] = React.useState<Element | null>(null);\n  const handleClose = () => {\n    setAnchorEl(null);\n  };\n  return (\n    <Card variant={\"outlined\"} style={{ margin: 3 }}>\n      <Box padding={2} display={\"flex\"} flexDirection={\"column\"}>\n        <Typography>{`${currentValue} ${currency.unit} of ${currency.name}`}</Typography>\n        {exchangeRates.length > 0 && (\n          <>\n            <Button\n              onClick={(event) => setAnchorEl(event.currentTarget)}\n              aria-controls=\"menu\"\n              aria-haspopup=\"true\"\n            >\n              {\"Exchange\"}\n            </Button>\n            <Menu\n              id=\"menu\"\n              anchorEl={anchorEl}\n              keepMounted\n              open={anchorEl != null}\n              onClose={handleClose}\n            >\n              {exchangeRates\n                .filter((x) => x.from.name === currency.name)\n                .map((item) => (\n                  <ExchangeButton\n                    key={item.from.name + \"_\" + item.to.name}\n                    exchangeRate={item}\n                    value={1}\n                    onDone={handleClose}\n                  />\n                ))}\n            </Menu>\n          </>\n        )}\n        <Button\n          disabled={!canSpend1}\n          onClick={() => db.addToBank(currency, -1)}\n        >{`Spend 1 ${currency.unit}`}</Button>\n      </Box>\n    </Card>\n  );\n}\n\nexport function ExchangePage() {\n  const db = usePLSDBContext();\n  const currencies = useObservable(db.getCurrencies(), []);\n\n  return (\n    <Box display={\"flex\"} flexDirection={\"column\"} alignItems={\"center\"}>\n      <Typography variant={\"h5\"}>{\"Exchange\"}</Typography>\n      <Box\n        display={\"flex\"}\n        flexWrap={\"wrap\"}\n        flexDirection={\"row\"}\n        justifyContent={\"center\"}\n      >\n        {currencies\n          .filter((x) => x.isSource)\n          .map((currency) => (\n            <ExchangeItem key={currency.name} currency={currency} />\n          ))}\n      </Box>\n      <Divider variant={\"middle\"} />\n      <Typography variant={\"h5\"}>{\"Spend\"}</Typography>\n      <Box\n        display={\"flex\"}\n        flexWrap={\"wrap\"}\n        flexDirection={\"row\"}\n        justifyContent={\"center\"}\n      >\n        {currencies\n          .filter((x) => !x.isSource)\n          .map((currency) => (\n            <SpendItem key={currency.name} currency={currency} />\n          ))}\n      </Box>\n    </Box>\n  );\n}\n","import { useMediaQuery } from '@material-ui/core';\n\nexport function useIsSmallScreen() {\n  return useMediaQuery('(max-width:425px)');\n}\n","import React from \"react\";\nimport { Currency, usePLSDBContext } from \"../../data/PLSDB\";\nimport { useObservable } from \"../../Utils\";\nimport {\n  Box,\n  Icon,\n  Checkbox,\n  Button,\n  TextField,\n  Typography,\n  Card,\n} from \"@material-ui/core\";\nimport { useIsSmallScreen } from \"../../hooks/useIsSmallScreen\";\n\nfunction CurrencyItem({\n  currency,\n  isNew,\n}: {\n  currency: Currency;\n  isNew: boolean;\n}) {\n  const db = usePLSDBContext();\n  const [name, setName] = React.useState(() => currency.name);\n  const [icon, setIcon] = React.useState(() => currency.icon);\n  const [description, setDescription] = React.useState(\n    () => currency.description\n  );\n  const [isSource, setIsSource] = React.useState(() => currency.isSource);\n  const [isTime, setIsTime] = React.useState(() => currency.isTime);\n  const [unit, setUnit] = React.useState(() => currency.unit);\n  const isSmallScreen = useIsSmallScreen();\n  const isEdited =\n    name !== currency.name ||\n    icon !== currency.icon ||\n    description !== currency.description ||\n    isTime !== currency.isTime ||\n    unit !== currency.unit ||\n    isSource !== currency.isSource;\n\n  const content = (\n    <>\n      {!isNew && <Icon>{currency.icon}</Icon>}\n      {isNew && (\n        <TextField\n          label={\"Icon\"}\n          value={icon}\n          onChange={(e) => setIcon(e.target.value)}\n        />\n      )}\n      <TextField\n        label={\"Name\"}\n        value={name}\n        onChange={(e) => setName(e.target.value)}\n      />\n      <TextField\n        label={\"Description\"}\n        value={description}\n        onChange={(e) => setDescription(e.target.value)}\n      />\n      <TextField\n        label={\"Unit\"}\n        value={unit}\n        onChange={(e) => setUnit(e.target.value)}\n      />\n\n      <Checkbox checked={isTime} onChange={(e, v) => setIsTime(v)} />\n      <Typography>{\"Is time\"}</Typography>\n      <Checkbox checked={isSource} onChange={(e, v) => setIsSource(v)} />\n      <Typography>{\"Is source\"}</Typography>\n      {isEdited && (\n        <Button\n          onClick={() => {\n            db.addOrUpdateCurrency({\n              name,\n              icon,\n              description,\n              isTime,\n              unit,\n              isSource,\n            });\n          }}\n        >\n          <Icon>{\"save\"}</Icon>\n        </Button>\n      )}\n\n      {!isNew && (\n        <Button\n          onClick={() => {\n            db.removeCurrency(currency);\n          }}\n        >\n          <Icon>{\"delete\"}</Icon>\n        </Button>\n      )}\n    </>\n  );\n\n  if (isSmallScreen)\n    return (\n      <Card style={{ margin: 15 }}>\n        <Box\n          display={\"flex\"}\n          flexDirection={\"column\"}\n          alignItems={\"center\"}\n          justifyContent={\"space-between\"}\n          padding={1}\n        >\n          {content}\n        </Box>\n      </Card>\n    );\n\n  return (\n    <Box\n      display={\"flex\"}\n      flexDirection={\"row\"}\n      alignItems={\"center\"}\n      margin={1}\n      justifyContent={\"space-between\"}\n    >\n      {content}\n    </Box>\n  );\n}\n\nexport function SetupCurrencies() {\n  const db = usePLSDBContext();\n  const currencies = useObservable(db.getCurrencies(), []);\n  return (\n    <Box display={\"flex\"} flexDirection={\"column\"}>\n      {currencies.map((currency, i) => (\n        <CurrencyItem key={currency.name} currency={currency} isNew={false} />\n      ))}\n      <CurrencyItem\n        key={`new_currency_item_${currencies.length}`}\n        currency={{\n          name: `New currency ${currencies.length + 1}`,\n          description: \"\",\n          icon: \"\",\n          isSource: false,\n          isTime: false,\n          unit: \"hour\",\n        }}\n        isNew={true}\n      />\n    </Box>\n  );\n}\n","import React from \"react\";\nimport { ExchangeRate, usePLSDBContext } from \"../../data/PLSDB\";\nimport { useObservable } from \"../../Utils\";\nimport {\n  Box,\n  Icon,\n  Button,\n  TextField,\n  Typography,\n  FormControl,\n  InputLabel,\n  MenuItem,\n  Select,\n  Card,\n} from \"@material-ui/core\";\nimport { useIsSmallScreen } from \"../../hooks/useIsSmallScreen\";\n\nfunction Item({ rate, isNew }: { rate?: ExchangeRate; isNew: boolean }) {\n  const db = usePLSDBContext();\n  const currencies = useObservable(db.getCurrencies(), []);\n  const [from, setFrom] = React.useState(() => rate?.from);\n  const [to, setTo] = React.useState(() => rate?.to);\n  const [rateValue, setRateValue] = React.useState(\n    () => rate?.rate.toString() ?? \"\"\n  );\n  const isSmallScreen = useIsSmallScreen();\n\n  const isEdited =\n    from?.name !== rate?.from.name ||\n    to?.name !== rate?.to.name ||\n    Number(rateValue) !== rate?.rate;\n  const isValid =\n    !isNaN(Number(rateValue)) &&\n    from != null &&\n    to != null &&\n    Number(rateValue) > 0;\n\n  const content = (\n    <>\n      <Box display={\"flex\"} flexDirection={\"row\"}>\n        <FormControl>\n          <InputLabel id=\"from-label-id\">{\"From\"}</InputLabel>\n          <Select\n            labelId=\"from-label-id\"\n            value={from?.name}\n            onChange={(e: any, d: any) =>\n              setFrom(currencies.find((x) => x.name === e.target.value))\n            }\n          >\n            <MenuItem>{\"-\"}</MenuItem>\n            {currencies\n              .filter((x) => x.name !== to?.name)\n              .map((currency, i) => (\n                <MenuItem key={currency.name + \"_from\"} value={currency.name}>\n                  {currency.name}\n                </MenuItem>\n              ))}\n          </Select>\n        </FormControl>\n        <Box marginX={1} />\n        <TextField\n          value={rateValue}\n          inputMode={\"decimal\"}\n          onChange={(e) => setRateValue(e.target.value)}\n          label={\"Rate\"}\n        />\n        <Box marginX={1} />\n        <FormControl>\n          <InputLabel id=\"to-label-id\">{\"To\"}</InputLabel>\n          <Select\n            labelId=\"to-label-id\"\n            value={to?.name}\n            onChange={(e: any, d: any) =>\n              setTo(currencies.find((x) => x.name === e.target.value))\n            }\n          >\n            <MenuItem>{\"-\"}</MenuItem>\n            {currencies\n              .filter((x) => x.name !== from?.name)\n              .map((currency, i) => (\n                <MenuItem key={currency.name + \"_to\"} value={currency.name}>\n                  {currency.name}\n                </MenuItem>\n              ))}\n          </Select>\n        </FormControl>\n      </Box>\n      {isValid && (\n        <Typography>{`1 ${from?.unit} of ${from?.name} = ${Number(rateValue)} ${\n          to?.unit\n        } of ${to?.name}`}</Typography>\n      )}\n\n      <Box display={\"flex\"} flexDirection={\"row\"}>\n        {isEdited && isValid && (\n          <Button\n            onClick={() => {\n              if (from == null || to == null) return;\n              db.addOrUpdateExchangeRate({\n                from: from,\n                to: to,\n                rate: Number(rateValue),\n              });\n            }}\n          >\n            <Icon>{\"save\"}</Icon>\n          </Button>\n        )}\n\n        {!isNew && rate != null && (\n          <Button\n            onClick={() => {\n              db.removeExchangeRate(rate);\n            }}\n          >\n            <Icon>{\"delete\"}</Icon>\n          </Button>\n        )}\n      </Box>\n    </>\n  );\n\n  if (isSmallScreen)\n    return (\n      <Card style={{ margin: 10 }}>\n        <Box\n          display={\"flex\"}\n          flexDirection={\"column\"}\n          alignItems={\"center\"}\n          margin={1}\n        >\n          {content}\n        </Box>\n      </Card>\n    );\n\n  return (\n    <Box\n      display={\"flex\"}\n      flexDirection={\"row\"}\n      alignItems={\"center\"}\n      margin={1}\n      justifyContent={\"space-between\"}\n    >\n      {content}\n    </Box>\n  );\n}\n\nexport function SetupExchangeRates() {\n  const db = usePLSDBContext();\n  const rates = useObservable(db.getExchangeRates(), []);\n  return (\n    <Box display={\"flex\"} flexDirection={\"column\"}>\n      {rates.map((rate, i) => (\n        <Item\n          key={rate.from.name + \"_\" + rate.to.name + \"_\" + rate.rate}\n          rate={rate}\n          isNew={false}\n        />\n      ))}\n      <Item key={rates.length} isNew={true} />\n    </Box>\n  );\n}\n","import * as React from \"react\";\nimport { Observable, BehaviorSubject, combineLatest } from \"rxjs\";\nimport {\n  distinct,\n  map,\n  skip,\n  debounceTime,\n  flatMap,\n  throttleTime,\n} from \"rxjs/operators\";\nconst PLACEHOLDER_GOAL = {\n  bounds: { top: 0, height: 50, left: 0, width: 50 },\n  name: \"\",\n  labels: [],\n};\nconst firebase = (window as any).firebase;\nexport const SystemsDBContext = React.createContext<SystemsDB | null>(null);\nexport function useSystemsDBContext(): SystemsDB {\n  const result = React.useContext(SystemsDBContext);\n  if (result == null)\n    throw new Error(\"useDBContext used outside of the context\");\n  return result;\n}\n\nexport type Goal = {\n  name: string;\n  labels: string[];\n  bounds: Rect;\n};\n\nexport type Connection = {\n  from: string;\n  to: string;\n};\n\nexport type Rect = {\n  left: number;\n  top: number;\n  width: number;\n  height: number;\n};\n\nexport type System = {\n  name: string;\n  labels: string[];\n  bounds: Rect;\n};\n\nexport type Position = { x: number; y: number };\n\nexport type Config = {\n  zoomLevel: number;\n  cameraPosition: Position;\n};\n\nexport function toKey(obj: Goal | Connection | System): string {\n  if (obj[\"name\"] != null) return obj[\"name\"];\n  return obj[\"from\"] + \":\" + obj[\"to\"];\n}\n\nexport class SystemsDB {\n  private _forceUpdate = new BehaviorSubject(null);\n  private goals = new BehaviorSubject<BehaviorSubject<Goal>[]>([]);\n  private connections = new BehaviorSubject<BehaviorSubject<Connection>[]>([]);\n  private systems = new BehaviorSubject<BehaviorSubject<System>[]>([]);\n  config = new BehaviorSubject({\n    zoomLevel: 1,\n    cameraPosition: { x: 0, y: 0 },\n  });\n\n  constructor() {\n    combineLatest(\n      this.goals.pipe(\n        skip(1),\n        map((x) => JSON.stringify(x.map((x) => x.value))),\n        distinct()\n      ),\n      this.connections.pipe(\n        skip(1),\n        map((x) => JSON.stringify(x.map((x) => x.value))),\n        distinct()\n      ),\n      this.systems.pipe(\n        skip(1),\n        map((x) => JSON.stringify(x.map((x) => x.value))),\n        distinct()\n      ),\n      this.config.pipe(\n        skip(1),\n        map((x) => JSON.stringify(x)),\n        distinct()\n      ),\n      this._forceUpdate\n    )\n      .pipe(debounceTime(1000))\n      .subscribe({ next: () => this.save() });\n  }\n\n  getGoalInitialValue(key: string): Goal {\n    const result = this.goals.value.find((x) => toKey(x.value) === key)?.value;\n    if (result == null) return PLACEHOLDER_GOAL;\n    return result;\n  }\n\n  getGoalWithKey(key: string): Observable<Goal> {\n    const result = this.goals.value.find((x) => toKey(x.value) === key);\n    if (result == null) return new BehaviorSubject(PLACEHOLDER_GOAL);\n    return result;\n  }\n\n  updateGoalWithKey(key: string, updated: (current: Goal) => Goal) {\n    const result = this.goals.value.find((x) => toKey(x.value) === key);\n    if (result == null) return;\n    const newValue = updated(result.value);\n    if (\n      this.goals.value.find(\n        (x) => toKey(x.value) === toKey(newValue) && x !== result\n      ) != null\n    ) {\n      alert(\"There is already another goal with this name\");\n      return;\n    } else {\n      result.next(newValue);\n      this._forceUpdate.next(null);\n    }\n  }\n\n  deleteGoal(key: string) {\n    let goal: Goal | null = null;\n    this.goals.next(\n      this.goals.value.filter((x) => {\n        if (toKey(x.value) !== key) {\n          goal = x.value;\n          return true;\n        }\n        return false;\n      })\n    );\n    if (goal != null) {\n      const goalKey = toKey(goal);\n      this.connections.next(\n        this.connections.value.filter(\n          (x) => x.value.from === goalKey || x.value.to === goalKey\n        )\n      );\n    }\n  }\n\n  createGoal(goal: Goal) {\n    this.goals.next([...this.goals.value, new BehaviorSubject(goal)]);\n  }\n\n  getZoomLevel(): Observable<number> {\n    return this.config.pipe(\n      distinct(),\n      map((x) => x.zoomLevel)\n    );\n  }\n\n  getCameraPosition(): Observable<Position> {\n    return this.config.pipe(\n      distinct(),\n      map((x) => x.cameraPosition)\n    );\n  }\n\n  getGoalsWithKey(): Observable<[Observable<Goal>, string][]> {\n    return this.goals.pipe(map((x) => x.map((y) => [y, toKey(y.value)])));\n  }\n\n  getSystemsWithKey(): Observable<[Observable<System>, string][]> {\n    return this.systems.pipe(map((x) => x.map((y) => [y, toKey(y.value)])));\n  }\n\n  getConnectionsWithKeys(): Observable<[Connection, string][]> {\n    return this.connections.pipe(\n      map((x) => x.map((y) => [y.value, toKey(y.value)]))\n    );\n  }\n\n  deleteConnection(key: string) {\n    this.connections.next(\n      this.connections.value.filter((x) => toKey(x.value) !== key)\n    );\n  }\n\n  createConnection({ from, to }: { from: Goal; to: Goal }) {\n    this.connections.next([\n      ...this.connections.value,\n      new BehaviorSubject({ from: toKey(from), to: toKey(to) }),\n    ]);\n  }\n\n  getSystemGoals(_system: System | string): Observable<Observable<Goal>[]> {\n    const sysSubject = this.systems.value.find(\n      (x) =>\n        toKey(x.value) ===\n        (typeof _system === \"string\" ? _system : toKey(_system))\n    );\n    if (sysSubject == null) throw new Error(\"System not found\");\n    return combineLatest(sysSubject, this.goals).pipe(\n      throttleTime(30),\n      map(([system]) =>\n        this.goals.pipe(\n          throttleTime(30),\n          map((x) =>\n            x.filter((x) => isBoundAinY(x.value.bounds, system.bounds))\n          )\n        )\n      ),\n      flatMap((x) => x)\n    );\n  }\n\n  getSystemInitialValue(key: string): System {\n    const result = this.systems.value.find((x) => toKey(x.value) === key)\n      ?.value;\n    if (result == null) throw new Error(\"System not found\");\n    return result;\n  }\n\n  updateSystemWithKey(key: string, updated: (current: System) => System) {\n    const result = this.systems.value.find((x) => toKey(x.value) === key);\n    if (result == null) throw new Error(\"System not found\");\n    const newValue = updated(result.value);\n    if (\n      this.systems.value.find(\n        (x) => toKey(x.value) === toKey(newValue) && x !== result\n      ) != null\n    ) {\n      alert(\"There is already another goal with this name\");\n      return;\n    } else {\n      result.next(newValue);\n      this._forceUpdate.next(null);\n    }\n  }\n\n  deleteSystem(key: string) {\n    this.systems.next(this.systems.value.filter((x) => toKey(x.value) !== key));\n  }\n\n  createSystem(goal: Goal) {\n    this.systems.next([...this.systems.value, new BehaviorSubject(goal)]);\n  }\n\n  dbRef: any;\n\n  loadFromFirebase(uid: string) {\n    this.dbRef = firebase.database().ref(`systems/${uid}`);\n    this.dbRef.on(\"value\", (s: any) => {\n      console.log(\"Updating Systems\");\n      const result = JSON.parse(s.val() ?? \"{}\");\n      const goals: Goal[] = result[\"goals\"] ?? [];\n      const systems: System[] = result[\"systems\"] ?? [];\n      const connections: Connection[] = result[\"connections\"] ?? [];\n      const config: Config = result[\"config\"] ?? {\n        zoomLevel: 1,\n        cameraPosition: { x: 0, y: 0 },\n      };\n      if (JSON.stringify(config) !== JSON.stringify(this.config.value))\n        this.config.next(config);\n      updateFromDiff(this.goals, goals);\n      updateFromDiff(this.systems, systems);\n      updateFromDiff(this.connections, connections);\n    });\n  }\n\n  save() {\n    const result = {\n      goals: this.goals.value.map((x) => x.value),\n      systems: this.systems.value.map((x) => x.value),\n      connections: this.connections.value.map((x) => x.value),\n      config: this.config.value,\n    };\n    const data = JSON.stringify(result);\n    this.dbRef.set(data);\n    console.log(\"Saving Systems\");\n  }\n}\n\ntype SystesmDBEntities = System | Goal | Connection;\n\nfunction updateFromDiff<T extends SystesmDBEntities>(\n  old: BehaviorSubject<BehaviorSubject<T>[]>,\n  _new: T[]\n) {\n  const indexedOldTargets: {\n    [key: string]: BehaviorSubject<T>;\n  } = {};\n  const oldTargets = old.value.map((v) => {\n    indexedOldTargets[toKey(v.value)] = v;\n    return v.value;\n  });\n\n  const targetsDiff = findDiff(oldTargets, _new);\n  const targetUpdateResult: BehaviorSubject<T>[] = [\n    ...targetsDiff.newAdded.map((x) => new BehaviorSubject(x)),\n  ];\n  targetsDiff.existed.forEach((item) => {\n    const _subject = indexedOldTargets[toKey(item)];\n    targetUpdateResult.push(_subject);\n    if (JSON.stringify(_subject.value) !== JSON.stringify(item)) {\n      _subject.next(item);\n    }\n  });\n  old.next(targetUpdateResult);\n}\n\nfunction findDiff<T extends SystesmDBEntities>(\n  _olds: T[],\n  news: T[]\n): {\n  newAdded: T[];\n  deleted: T[];\n  existed: T[];\n} {\n  const newAdded: T[] = [];\n  const existed: T[] = [];\n  outer: for (const _new of news) {\n    for (const _old of _olds) {\n      if (toKey(_old) === toKey(_new)) {\n        existed.push(_new);\n        continue outer;\n      }\n    }\n    newAdded.push(_new);\n  }\n  const deleted = _olds.filter(\n    (x) => !existed.map((x) => toKey(x)).includes(toKey(x))\n  );\n\n  return {\n    newAdded,\n    deleted,\n    existed,\n  };\n}\n\nif (process.env.NODE_ENV === \"development\") {\n  // TODO: add these to test\n  const _win = window as any;\n  const connSet1: any[] = [\n    {\n      name: \"a\",\n      labels: [\"test1\"],\n    },\n    {\n      name: \"b\",\n    },\n    {\n      name: \"c\",\n    },\n  ];\n  const connSet2: any[] = [\n    {\n      name: \"a\",\n      labels: [],\n    },\n\n    {\n      name: \"c\",\n    },\n    {\n      name: \"k\",\n    },\n  ];\n  _win.findDiff = () => findDiff(connSet1, connSet2);\n}\n\nfunction isBoundAinY(a: Rect, b: Rect): boolean {\n  if (a.left <= b.left) return false;\n  if (a.top <= b.top) return false;\n  if (a.left + a.width >= b.left + b.width) return false;\n  if (a.top + a.height >= b.top + b.height) return false;\n\n  return true;\n}\n\nexport function CreateOrGetDefaultSystemsDatabase(): SystemsDB {\n  const db = new SystemsDB();\n  return db;\n}\n","import React from \"react\";\nimport { fromEvent, BehaviorSubject } from \"rxjs\";\nimport { debounceTime, take, skip } from \"rxjs/operators\";\nimport { makeStyles } from \"@material-ui/styles\";\nimport { Config, useSystemsDBContext } from \"../../../data/SystemsDB\";\n\nconst useStyles = makeStyles({\n  rootContainer: {\n    \"&::-webkit-scrollbar\": {\n      display: \"none\",\n    },\n  },\n  innerContainer: {\n    // TODO: max everything width + padding\n    width: \"100%\",\n    // TODO: max everyhing height + padding\n    height: \"100%\",\n    position: \"relative\",\n  },\n});\n\nfunction useIsHoldinMouseKey(keyCode: number): boolean {\n  const [isDown, setIsDown] = React.useState(false);\n  React.useEffect(() => {\n    const onMouseDown = (e: MouseEvent) => {\n      if (e.button === keyCode) setIsDown(true);\n    };\n    const onMouseUp = (e: MouseEvent) => {\n      if (e.button === keyCode) setIsDown(false);\n    };\n    window.document.addEventListener(\"mousedown\", onMouseDown);\n    window.document.addEventListener(\"mouseup\", onMouseUp);\n    return () => {\n      window.document.removeEventListener(\"mousedown\", onMouseDown);\n      window.document.removeEventListener(\"mouseup\", onMouseUp);\n    };\n  }, [keyCode]);\n  return isDown;\n}\n\nfunction calculateTransform({ zoomLevel, cameraPosition }: Config): string {\n  return `transform:translate(${cameraPosition.x}px,${cameraPosition.y}px) scale(${zoomLevel})`;\n}\n\nexport function Canvas(props: React.Props<{}>) {\n  const containerRef = React.useRef<HTMLDivElement>();\n  const innerRef = React.useRef<HTMLDivElement>();\n  const positionRef = React.useRef<HTMLParagraphElement>();\n  const db = useSystemsDBContext();\n  const styles = useStyles({});\n  const [size, setSize] = React.useState({ width: 0, height: 0 });\n  const isHoldingMouseMiddleButton = useIsHoldinMouseKey(1);\n  const [, setScale] = React.useState(1);\n  const config = React.useMemo<Config>(() => db.config.value, [db]);\n\n  const updateDbConfig = React.useCallback(() => {\n    db.config.next(config);\n  }, [db.config, config]);\n\n  const updateInnerRefStyle = React.useCallback(\n    (animate: boolean = false) => {\n      if (innerRef.current == null)\n        throw new Error(\"Unhandled situtation innerRef cannot be null here\");\n      if (positionRef.current != null) {\n        positionRef.current.innerText = `${config.cameraPosition.x}, ${\n          config.cameraPosition.y\n        } (x${config.zoomLevel.toPrecision(2)})`;\n      }\n\n      let value = calculateTransform(config);\n      const ANIMATION = \";transition: transform 100ms\";\n      if (animate) {\n        innerRef.current.setAttribute(\n          \"style\",\n          innerRef.current.style + ANIMATION\n        );\n        value += ANIMATION;\n      }\n\n      innerRef.current.setAttribute(\"style\", value);\n    },\n    [innerRef, config, positionRef]\n  );\n\n  React.useEffect(() => {\n    updateInnerRefStyle(false);\n  }, [updateInnerRefStyle]);\n\n  React.useEffect(() => {\n    // skip default value and wait for server value\n    const sub = db.config.pipe(skip(1), take(1)).subscribe({\n      next: (v) => {\n        config.cameraPosition = v.cameraPosition;\n        config.zoomLevel = v.zoomLevel;\n        updateInnerRefStyle(false);\n      },\n    });\n    return () => sub.unsubscribe();\n  }, [db, config, updateInnerRefStyle]);\n\n  // on space reset zoom to 1\n  React.useEffect(() => {\n    const onKeyUp = (e: KeyboardEvent) => {\n      const SPACE_KEY_CODE = 32;\n      if (e.keyCode === SPACE_KEY_CODE) {\n        config.zoomLevel = 1;\n        updateInnerRefStyle(true);\n        updateDbConfig();\n      }\n    };\n    window.document.addEventListener(\"keyup\", onKeyUp);\n    return () => window.document.removeEventListener(\"keyup\", onKeyUp);\n  }, [updateInnerRefStyle, config, updateDbConfig]);\n\n  // zoom\n  React.useEffect(() => {\n    const _doUpdateScale = new BehaviorSubject(null);\n    const sub = _doUpdateScale.pipe(debounceTime(100)).subscribe({\n      next: () => setScale(config.zoomLevel),\n    });\n    const onMouseWheel = (e: WheelEvent) => {\n      config.zoomLevel = Math.max(0.1, config.zoomLevel + e.deltaY * -0.0005);\n      updateDbConfig();\n      updateInnerRefStyle(true);\n      _doUpdateScale.next(null);\n    };\n    window.document.addEventListener(\"wheel\", onMouseWheel);\n    return () => {\n      window.document.removeEventListener(\"wheel\", onMouseWheel);\n      sub.unsubscribe();\n    };\n  }, [updateInnerRefStyle, config, updateDbConfig]);\n\n  React.useLayoutEffect(() => {\n    if (!isHoldingMouseMiddleButton) {\n      document.body.style.cursor = \"default\";\n      return;\n    } else {\n      document.body.style.cursor = \"move\";\n    }\n\n    const onMouseMove = (e: MouseEvent) => {\n      config.cameraPosition.x += e.movementX;\n      config.cameraPosition.y += e.movementY;\n      updateDbConfig();\n      // we directly update innerRef attribute because of performance resaons\n      updateInnerRefStyle();\n    };\n    document.addEventListener(\"mousemove\", onMouseMove);\n    return () => document.removeEventListener(\"mousemove\", onMouseMove);\n  }, [\n    isHoldingMouseMiddleButton,\n    innerRef,\n    updateInnerRefStyle,\n    config,\n    updateDbConfig,\n  ]);\n\n  // setup width and height\n  React.useLayoutEffect(() => {\n    const calculateAndUpdateSize = () => {\n      if (containerRef.current == null) throw new Error(\"Unhandled situtation\");\n      const height =\n        window.innerHeight - containerRef.current.getBoundingClientRect().top;\n      const width = window.innerWidth;\n      setSize({ height, width });\n    };\n    calculateAndUpdateSize();\n    const sub = fromEvent(window, \"resize\")\n      .pipe(debounceTime(50))\n      .subscribe({ next: () => calculateAndUpdateSize() });\n\n    return () => sub.unsubscribe();\n  }, [containerRef]);\n\n  return (\n    <div\n      ref={containerRef as any}\n      className={styles.rootContainer}\n      id=\"canvas\"\n      style={{\n        width: size.width,\n        height: size.height,\n        position: \"relative\",\n        overflow: \"hidden\",\n      }}\n    >\n      <div ref={innerRef as any} className={styles.innerContainer}>\n        {props.children}\n      </div>\n      <p\n        ref={positionRef as any}\n        style={{ position: \"absolute\", bottom: 0, right: 20, opacity: 0.5 }}\n      ></p>\n    </div>\n  );\n}\n","import React from \"react\";\n\ntype BorderTriggerEvent = {\n  state: \"entered\" | \"exited\";\n};\n\ntype TriggerEvent = (e: BorderTriggerEvent) => void;\n\nexport function BorderTrigger(props: {\n  children: React.ReactNode;\n  borderWidth: number;\n  style?: React.CSSProperties;\n  onTL?: TriggerEvent;\n  onT?: TriggerEvent;\n  onTR?: TriggerEvent;\n  onL?: TriggerEvent;\n  onR?: TriggerEvent;\n  onBL?: TriggerEvent;\n  onB?: TriggerEvent;\n  onBR?: TriggerEvent;\n  onMouseDown?: (e: React.MouseEvent<HTMLDivElement, MouseEvent>) => void;\n  onMouseMove?: (e: React.MouseEvent<HTMLDivElement, MouseEvent>) => void;\n  onMouseUp?: (e: React.MouseEvent<HTMLDivElement, MouseEvent>) => void;\n}) {\n  /*\n  [ ]---------[ ]\n   |           |\n   |   child   |\n   |           |\n  [ ]---------[ ]\n  */\n  const rowStyle: React.CSSProperties = {\n    display: \"flex\",\n    flexDirection: \"row\",\n  };\n  const cornerStyle: React.CSSProperties = {\n    width: props.borderWidth,\n    height: props.borderWidth,\n  };\n  const hLineStyle: React.CSSProperties = {\n    flex: 1,\n    height: props.borderWidth,\n  };\n  const vLineStyle: React.CSSProperties = {\n    width: props.borderWidth,\n  };\n  return (\n    <div\n      style={{\n        ...(props.style ?? {}),\n        display: \"flex\",\n        flexDirection: \"column\",\n      }}\n      onMouseMove={props.onMouseMove}\n    >\n      <div style={rowStyle}>\n        <div\n          onMouseEnter={\n            props.onTL == null\n              ? undefined\n              : () => props.onTL!({ state: \"entered\" })\n          }\n          onMouseLeave={\n            props.onTL == null\n              ? undefined\n              : () => props.onTL!({ state: \"exited\" })\n          }\n          onMouseDown={props.onMouseDown}\n          onMouseUp={props.onMouseUp}\n          style={{ ...cornerStyle, cursor: \"nw-resize\" }}\n        ></div>\n        <div\n          onMouseEnter={\n            props.onT == null\n              ? undefined\n              : () => props.onT!({ state: \"entered\" })\n          }\n          onMouseLeave={\n            props.onT == null\n              ? undefined\n              : () => props.onT!({ state: \"exited\" })\n          }\n          onMouseDown={props.onMouseDown}\n          onMouseUp={props.onMouseUp}\n          style={{ ...hLineStyle, cursor: \"n-resize\" }}\n        ></div>\n        <div\n          onMouseEnter={\n            props.onTR == null\n              ? undefined\n              : () => props.onTR!({ state: \"entered\" })\n          }\n          onMouseLeave={\n            props.onTR == null\n              ? undefined\n              : () => props.onTR!({ state: \"exited\" })\n          }\n          onMouseDown={props.onMouseDown}\n          onMouseUp={props.onMouseUp}\n          style={{ ...cornerStyle, cursor: \"ne-resize\" }}\n        ></div>\n      </div>\n      <div style={rowStyle}>\n        <div\n          onMouseEnter={\n            props.onL == null\n              ? undefined\n              : () => props.onL!({ state: \"entered\" })\n          }\n          onMouseLeave={\n            props.onL == null\n              ? undefined\n              : () => props.onL!({ state: \"exited\" })\n          }\n          onMouseDown={props.onMouseDown}\n          onMouseUp={props.onMouseUp}\n          style={{ ...vLineStyle, cursor: \"w-resize\" }}\n        ></div>\n        <div style={{width: \"100%\", height: \"100%\"}}>{props.children}</div>\n        <div\n          onMouseEnter={\n            props.onR == null\n              ? undefined\n              : () => props.onR!({ state: \"entered\" })\n          }\n          onMouseLeave={\n            props.onR == null\n              ? undefined\n              : () => props.onR!({ state: \"exited\" })\n          }\n          onMouseDown={props.onMouseDown}\n          onMouseUp={props.onMouseUp}\n          style={{ ...vLineStyle, cursor: \"w-resize\" }}\n        ></div>\n      </div>\n      <div style={rowStyle}>\n        <div\n          onMouseEnter={\n            props.onBL == null\n              ? undefined\n              : () => props.onBL!({ state: \"entered\" })\n          }\n          onMouseLeave={\n            props.onBL == null\n              ? undefined\n              : () => props.onBL!({ state: \"exited\" })\n          }\n          onMouseDown={props.onMouseDown}\n          onMouseUp={props.onMouseUp}\n          style={{ ...cornerStyle, cursor: \"sw-resize\" }}\n        ></div>\n        <div\n          onMouseEnter={\n            props.onB == null\n              ? undefined\n              : () => props.onB!({ state: \"entered\" })\n          }\n          onMouseLeave={\n            props.onB == null\n              ? undefined\n              : () => props.onB!({ state: \"exited\" })\n          }\n          onMouseDown={props.onMouseDown}\n          onMouseUp={props.onMouseUp}\n          style={{ ...hLineStyle, cursor: \"n-resize\" }}\n        ></div>\n        <div\n          onMouseEnter={\n            props.onBR == null\n              ? undefined\n              : () => props.onBR!({ state: \"entered\" })\n          }\n          onMouseLeave={\n            props.onBR == null\n              ? undefined\n              : () => props.onBR!({ state: \"exited\" })\n          }\n          onMouseDown={props.onMouseDown}\n          onMouseUp={props.onMouseUp}\n          style={{ ...cornerStyle, cursor: \"se-resize\" }}\n        ></div>\n      </div>\n    </div>\n  );\n}\n","import * as React from \"react\";\n\nimport Draggable from \"react-draggable\";\nimport { Rect } from \"../../../data/SystemsDB\";\nimport { BorderTrigger } from \"./BorderTrigger\";\nimport { Observable } from \"rxjs\";\nimport { filter } from \"rxjs/operators\";\nimport { useForceUpdate } from \"../../../Utils\";\n\nexport type UpdateManager = {\n  updates: Observable<Rect>;\n  sendUpdate: (e: Rect) => void;\n  initial: Rect;\n};\n\nexport function CanvasNode(props: {\n  children: (bounds: Rect) => React.ReactNode;\n  scale: number;\n  updateManager: UpdateManager;\n  offsetPosition?: { x: number, y: number}\n}) {\n  const isHoldingBorder = React.useRef(false);\n  const containerRef = React.useRef<HTMLDivElement>();\n  const bounds = React.useMemo<Rect>(() => props.updateManager.initial, [\n    props.updateManager,\n  ]);\n  const forceRefresh = useForceUpdate();\n  const lastBorderState = React.useRef<\n    \"tl\" | \"t\" | \"tr\" | \"l\" | \"r\" | \"br\" | \"b\" | \"bl\" | \"none\"\n  >(\"none\");\n\n  const update = React.useCallback(\n    (calculate: (c: Rect) => Rect) => {\n      const result = calculate(bounds);\n      const filteredResult = {\n        ...result,\n        width: Math.max(result.width, 100),\n        height: Math.max(result.height, 70),\n      };\n      Object.assign(bounds, filteredResult);\n      forceRefresh();\n      setTimeout(() => props.updateManager.sendUpdate(bounds), 50);\n    },\n    [bounds, forceRefresh, props.updateManager]\n  );\n\n  React.useEffect(() => {\n    const sub = props.updateManager.updates\n      .pipe(\n        filter(\n          (x) =>\n            x.width !== bounds.width ||\n            x.height !== bounds.height ||\n            x.top !== bounds.top ||\n            x.left !== bounds.left\n        )\n      )\n      .subscribe({\n        next: (v) => update(() => v),\n      });\n    return () => sub.unsubscribe();\n  }, [props.updateManager, bounds, update]);\n\n  React.useEffect(() => {\n    const onMouseMove = (e: MouseEvent) => {\n      if (!isHoldingBorder.current) return;\n      const movementX = e.movementX;\n      const movementY = e.movementY;\n\n      if (lastBorderState.current === \"r\")\n        update((c) => ({\n          ...c,\n          width: c.width + movementX,\n        }));\n      if (lastBorderState.current === \"br\")\n        update((c) => ({\n          ...c,\n          width: c.width + movementX,\n          height: c.height + movementY,\n        }));\n      if (lastBorderState.current === \"b\")\n        update((c) => ({\n          ...c,\n          height: c.height + movementY,\n        }));\n      if (lastBorderState.current === \"bl\")\n        update((c) => ({\n          ...c,\n          width: c.width + -movementX,\n          left: c.left + movementX,\n          height: c.height + movementY,\n        }));\n      if (lastBorderState.current === \"l\")\n        update((c) => ({\n          ...c,\n          width: c.width + -movementX,\n          left: c.left + movementX,\n        }));\n      if (lastBorderState.current === \"tl\")\n        update((c) => ({\n          ...c,\n          width: c.width + -movementX,\n          top: c.top + movementY,\n          left: c.left + movementX,\n          height: c.height + -movementY,\n        }));\n      if (lastBorderState.current === \"t\")\n        update((c) => ({\n          ...c,\n          top: c.top + movementY,\n          height: c.height + -movementY,\n        }));\n      if (lastBorderState.current === \"tr\")\n        update((c) => ({\n          ...c,\n          width: c.width + movementX,\n          top: c.top + movementY,\n          height: c.height + -movementY,\n        }));\n    };\n    const onMouseUp = (e: MouseEvent) => {\n      isHoldingBorder.current = false;\n    };\n    document.addEventListener(\"mousemove\", onMouseMove);\n    document.addEventListener(\"mouseup\", onMouseUp);\n    return () => {\n      document.removeEventListener(\"mousemove\", onMouseMove);\n      document.removeEventListener(\"mouseup\", onMouseUp);\n    };\n  }, [isHoldingBorder, lastBorderState, props.scale, update]);\n\n  const onMouseDown = (e: React.MouseEvent<HTMLDivElement, MouseEvent>) => {\n    isHoldingBorder.current = true;\n  };\n  return (\n    <Draggable\n      handle=\".handle\"\n      position={{ x: bounds.left, y: bounds.top }}\n      onDrag={(e, d) => {\n        update((c) => ({\n          ...c,\n          left: d.x,\n          top: d.y,\n        }));\n      }}\n      positionOffset={props.offsetPosition}\n      scale={props.scale}\n    >\n      <div ref={containerRef as any} style={{ position: \"absolute\" }}>\n        <BorderTrigger\n          onMouseDown={onMouseDown}\n          borderWidth={10}\n          onL={() =>\n            !isHoldingBorder.current && (lastBorderState.current = \"l\")\n          }\n          onR={() =>\n            !isHoldingBorder.current && (lastBorderState.current = \"r\")\n          }\n          onTL={() =>\n            !isHoldingBorder.current && (lastBorderState.current = \"tl\")\n          }\n          onT={() =>\n            !isHoldingBorder.current && (lastBorderState.current = \"t\")\n          }\n          onTR={() =>\n            !isHoldingBorder.current && (lastBorderState.current = \"tr\")\n          }\n          onBL={() =>\n            !isHoldingBorder.current && (lastBorderState.current = \"bl\")\n          }\n          onB={() =>\n            !isHoldingBorder.current && (lastBorderState.current = \"b\")\n          }\n          onBR={() =>\n            !isHoldingBorder.current && (lastBorderState.current = \"br\")\n          }\n        >\n          {props.children(bounds)}\n        </BorderTrigger>\n      </div>\n    </Draggable>\n  );\n}\n","import * as React from \"react\";\nimport { Card, Icon, Box, Chip } from \"@material-ui/core\";\nimport { Observable } from \"rxjs\";\nimport { map, tap } from \"rxjs/operators\";\nimport { CanvasNode, UpdateManager } from \"./CanvasNode\";\nimport { Goal, useSystemsDBContext } from \"../../../data/SystemsDB\";\nimport { useObservable } from \"../../../Utils\";\n\ntype GoalProps = {\n  goal: Observable<Goal>;\n  goalKey: string;\n  scale: number;\n  selectedGoal?: Goal;\n  onClick: (goal: Goal) => void;\n};\n\nexport function GoalView(props: GoalProps) {\n  const goal = useObservable(props.goal, null);\n  const isSelected = props.selectedGoal?.name === goal?.name;\n  const positionRef = React.useRef<HTMLParagraphElement>();\n  const db = useSystemsDBContext();\n  const updateManager = React.useMemo<UpdateManager>(\n    () => ({\n      sendUpdate: (v) =>\n        db.updateGoalWithKey(props.goalKey, (current) => ({\n          ...current,\n          bounds: v,\n        })),\n      initial: db.getGoalInitialValue(props.goalKey).bounds,\n      updates: props.goal.pipe(\n        map((v) => v.bounds),\n        tap((x) => {\n          if (positionRef.current != null) {\n            const _pos = `${x.left.toFixed(2)}, ${x.top.toFixed(2)}`;\n            const _bounds = `w${x.width.toFixed()}h${x.height.toFixed()}`;\n            positionRef.current.innerText = `${_pos} ${_bounds};`;\n          }\n        })\n      ),\n    }),\n    [props.goalKey, db, props.goal]\n  );\n  if (goal == null) return null;\n\n  return (\n    <CanvasNode updateManager={updateManager} scale={props.scale}>\n      {(bounds) => (\n        <Card\n          onClick={() => props.onClick(goal)}\n          elevation={4}\n          variant={isSelected ? \"elevation\" : \"outlined\"}\n          style={{\n            padding: 5,\n            width: bounds.width,\n            height: bounds.height,\n            display: \"flex\",\n            flexDirection: \"column\",\n            userSelect: \"none\",\n            justifyContent: \"space-between\",\n          }}\n        >\n          <div style={{ display: \"flex\", flexDirection: \"row\" }}>\n            <Icon className=\"handle\">{\"drag_handle\"}</Icon>\n            <Icon\n              style={{ cursor: \"pointer\" }}\n              onClick={() => {\n                const isConfirmed = window.confirm(\n                  \"Are you sure you want to delete this goal?\"\n                );\n                if (!isConfirmed) return;\n                db.deleteGoal(props.goalKey);\n              }}\n            >\n              {\"delete\"}\n            </Icon>\n          </div>\n          <div\n            style={{\n              display: \"flex\",\n              flexDirection: \"row\",\n              flexWrap: \"wrap\",\n              alignItems: \"baseline\",\n              fontSize: 30,\n              alignSelf: \"center\",\n              cursor: \"pointer\",\n            }}\n            className=\"content\"\n            onClick={() => {\n              const newName = prompt(\"Enter goal name\", goal.name);\n              if (newName == null) return;\n              db.updateGoalWithKey(props.goalKey, (c) => ({\n                ...c,\n                name: newName,\n              }));\n            }}\n            dangerouslySetInnerHTML={{ __html: goal.name }}\n          ></div>\n          <Box display=\"flex\" flexDirection=\"row\" flexWrap=\"warp\">\n            {goal.labels.map((label, i) => (\n              <Chip\n                onClick={() => {\n                  const isConfirmed = window.confirm(\n                    \"Are you sure you want to delete this label?\"\n                  );\n                  if (!isConfirmed) return;\n                  db.updateGoalWithKey(props.goalKey, (c) => ({\n                    ...c,\n                    labels: c.labels.filter((x) => x !== label),\n                  }));\n                }}\n                style={{ margin: 3 }}\n                size=\"small\"\n                key={i}\n                label={label}\n              />\n            ))}\n            <Chip\n              onClick={() => {\n                const labelValue = prompt(\"Enter label text\");\n                if (labelValue == null) return;\n                db.updateGoalWithKey(props.goalKey, (c) => ({\n                  ...c,\n                  labels: [...c.labels, labelValue],\n                }));\n              }}\n              style={{ margin: 3, cursor: \"pointer\" }}\n              size=\"small\"\n              color=\"primary\"\n              label={\"+\"}\n            />\n          </Box>\n          <p\n            ref={positionRef as any}\n            style={{ position: \"absolute\", bottom: 0, right: 20, opacity: 0.5 }}\n          ></p>\n        </Card>\n      )}\n    </CanvasNode>\n  );\n}\n","import * as React from \"react\";\nimport { Observable } from \"rxjs\";\nimport { map, tap } from \"rxjs/operators\";\nimport { CanvasNode, UpdateManager } from \"./CanvasNode\";\nimport { System, useSystemsDBContext } from \"../../../data/SystemsDB\";\nimport { useObservable } from \"../../../Utils\";\nimport { Icon } from \"@material-ui/core\";\n\ntype SystemProps = {\n  system: Observable<System>;\n  systemKey: string;\n  scale: number;\n  onClick?: (system: System) => void;\n};\n\nexport function SystemView(props: SystemProps) {\n  const system = useObservable(props.system, null);\n  const db = useSystemsDBContext();\n  const positionRef = React.useRef<HTMLParagraphElement>();\n  const systemGoals = useObservable(\n    () => db.getSystemGoals(props.systemKey),\n    []\n  );\n  const updateManager = React.useMemo<UpdateManager>(\n    () => ({\n      sendUpdate: (v) =>\n        db.updateSystemWithKey(props.systemKey, (current) => ({\n          ...current,\n          bounds: v,\n        })),\n      initial: db.getSystemInitialValue(props.systemKey).bounds,\n      updates: props.system.pipe(\n        map((v) => v.bounds),\n        tap((x) => {\n          if (positionRef.current != null) {\n            const _pos = `${x.left.toFixed(2)}, ${x.top.toFixed(2)}`;\n            const _bounds = `w${x.width.toFixed()}h${x.height.toFixed()}`;\n            positionRef.current.innerText = `${_pos} ${_bounds};`;\n          }\n        })\n      ),\n    }),\n    [props.systemKey, db, props.system]\n  );\n  if (system == null) return null;\n  const borderColor = \"rgba(0,0,0,0.6)\";\n  const systemNameBorder = `${borderColor} dashed`;\n  return (\n    <CanvasNode updateManager={updateManager} scale={props.scale}>\n      {(bounds) => (\n        <div\n          onClick={() => props.onClick != null && props.onClick(system)}\n          style={{\n            padding: 5,\n            width: bounds.width,\n            height: bounds.height,\n            display: \"flex\",\n            flexDirection: \"column\",\n            justifyContent: \"space-between\",\n            borderColor: borderColor,\n            borderWidth: 2,\n            borderStyle: \"dashed\",\n            borderRadius: 5,\n            borderTopLeftRadius: 0,\n            pointerEvents: \"visible\",\n          }}\n        >\n          <Icon className=\"handle\">{\"drag_handle\"}</Icon>\n          <Icon\n            style={{ cursor: \"pointer\", position: \"absolute\", left: 50 }}\n            onClick={() => {\n              const isConfirmed = window.confirm(\n                \"Are you sure you want to delete this system?\"\n              );\n              if (!isConfirmed) return;\n              db.deleteSystem(props.systemKey);\n            }}\n          >\n            {\"delete\"}\n          </Icon>\n          <p\n            style={{ position: \"absolute\", bottom: 0, left: 15 }}\n          >{`${systemGoals.length} Goals`}</p>\n          <div\n            style={{\n              position: \"absolute\",\n              top: -38,\n              fontSize: \"25pt\",\n              paddingLeft: 5,\n              paddingRight: 5,\n              left: 10,\n              borderLeft: systemNameBorder,\n              borderTop: systemNameBorder,\n              borderRight: systemNameBorder,\n              borderWidth: 2,\n            }}\n            onClick={() => {\n              const newName = prompt(\"Enter system name\", system.name);\n              if (newName == null) return;\n              db.updateSystemWithKey(props.systemKey, (c) => ({\n                ...c,\n                name: newName,\n              }));\n            }}\n            dangerouslySetInnerHTML={{ __html: system.name }}\n          ></div>\n          <p\n            ref={positionRef as any}\n            style={{ position: \"absolute\", bottom: 0, right: 20, opacity: 0.5 }}\n          ></p>\n        </div>\n      )}\n    </CanvasNode>\n  );\n}\n","import * as React from \"react\";\nimport { useSystemsDBContext, toKey } from \"../../../data/SystemsDB\";\nimport { getBoxToBoxArrow } from \"perfect-arrows\";\nimport { useObservable } from \"../../../Utils\";\ntype ConnectionProps = {};\n\nexport function ConnectionsView(props: ConnectionProps) {\n  const db = useSystemsDBContext();\n  const connections = useObservable(() => db.getConnectionsWithKeys(), []);\n  return (\n    <svg\n      style={{\n        width: \"100%\",\n        overflow: \"visible\",\n        height: \"100%\",\n      }}\n      stroke=\"#000\"\n      fill=\"#000\"\n      strokeWidth={3}\n    >\n      {connections.map(([connection, key]) => (\n        <ConnectionView\n          fromGoalKey={connection.from}\n          toGoalKey={connection.to}\n          key={key}\n        />\n      ))}\n    </svg>\n  );\n}\n\nfunction ConnectionView({\n  fromGoalKey,\n  toGoalKey,\n}: {\n  fromGoalKey: string;\n  toGoalKey: string;\n}) {\n  const db = useSystemsDBContext();\n  const from = useObservable(\n    () => db.getGoalWithKey(fromGoalKey),\n    db.getGoalInitialValue(fromGoalKey)\n  );\n  const to = useObservable(\n    () => db.getGoalWithKey(toGoalKey),\n    db.getGoalInitialValue(toGoalKey)\n  );\n  const [sx, sy, cx, cy, ex, ey, ae,] = getBoxToBoxArrow(\n    from.bounds.left,\n    from.bounds.top,\n    from.bounds.width + 20,\n    from.bounds.height + 20,\n    to.bounds.left,\n    to.bounds.top ,\n    to.bounds.width + 20,\n    to.bounds.height + 20, {\n      bow: 0.1\n    }\n  );\n\n  const endAngleAsDegrees = ae * (180 / Math.PI);\n  console.log(sx, sy);\n  return (\n    <>\n      <circle cx={sx} cy={sy} r={4} />\n      <path\n        d={`M${sx},${sy} Q${cx},${cy} ${ex},${ey}`}\n        fill=\"none\"\n        onClick={() => {\n          const isConfirmed = window.confirm(\n            \"Are you sure you want to delete this connection?\"\n          );\n          if (!isConfirmed) return;\n          db.deleteConnection(toKey({ from: fromGoalKey, to: toGoalKey }));\n        }}\n      />\n      <polygon\n        points=\"0,-6 12,0, 0,6\"\n        transform={`translate(${ex},${ey}) rotate(${endAngleAsDegrees})`}\n      />\n    </>\n  );\n}\n","import * as React from \"react\";\nimport { Canvas } from \"./Canvas\";\nimport { useSystemsDBContext, Goal, System } from \"../../../data/SystemsDB\";\nimport { useObservable } from \"../../../Utils\";\nimport { GoalView } from \"./GoalView\";\nimport { Card, IconButton, Icon, Tooltip } from \"@material-ui/core\";\nimport { SystemView } from \"./SystemView\";\nimport { ConnectionsView } from \"./ConnectionsView\";\n\nexport function SystemsPage() {\n  const db = useSystemsDBContext();\n  const scale = useObservable(() => db.getZoomLevel(), 1);\n  const goals = useObservable(() => db.getGoalsWithKey(), []);\n  const systems = useObservable(() => db.getSystemsWithKey(), []);\n  const [\n    isInCreateConnectionMode,\n    setIsInCreateConnectionMode,\n  ] = React.useState(false);\n\n  const [selectedFirstGoal, setSelectedFirstGoal] = React.useState<\n    Goal | undefined\n  >();\n\n  return (\n    <>\n      <Canvas>\n        {systems.map(([system, key]) => (\n          <SystemView key={key} system={system} scale={scale} systemKey={key} />\n        ))}\n\n        {goals.map(([goal, key]) => (\n          <GoalView\n            key={key}\n            goal={goal}\n            scale={scale}\n            onClick={(goal) => {\n              if (!isInCreateConnectionMode) return;\n              if (selectedFirstGoal == null) {\n                setSelectedFirstGoal(goal);\n              } else {\n                db.createConnection({\n                  from: selectedFirstGoal,\n                  to: goal,\n                });\n                setSelectedFirstGoal(undefined);\n                setIsInCreateConnectionMode(false);\n              }\n            }}\n            goalKey={key}\n            selectedGoal={selectedFirstGoal}\n          />\n        ))}\n        <ConnectionsView />\n      </Canvas>\n\n      <Card\n        elevation={10}\n        style={{\n          position: \"absolute\",\n          top: 70,\n          left: 20,\n          opacity: 0.7,\n          display: \"flex\",\n          flexDirection: \"column\",\n        }}\n      >\n        <Tooltip title=\"Add Goal\">\n          <IconButton\n            onClick={() => {\n              const goalName = prompt(\"Enter goal name\");\n              if (goalName == null) return;\n              const goal: Goal = {\n                labels: [],\n                name: goalName,\n                bounds: {\n                  left: -db.config.value.cameraPosition.x,\n                  top: -db.config.value.cameraPosition.y,\n                  height: 300,\n                  width: 400,\n                },\n              };\n              db.createGoal(goal);\n            }}\n          >\n            <Icon>{\"add\"}</Icon>\n          </IconButton>\n        </Tooltip>\n\n        <Tooltip title=\"Add System\">\n          <IconButton\n            onClick={() => {\n              const systemName = prompt(\"Enter system name\");\n              if (systemName == null) return;\n              const system: System = {\n                name: systemName,\n                labels: [],\n                bounds: {\n                  left: -db.config.value.cameraPosition.x,\n                  top: -db.config.value.cameraPosition.y,\n                  height: 300,\n                  width: 400,\n                },\n              };\n              db.createSystem(system);\n            }}\n          >\n            <Icon>{\"add\"}</Icon>\n          </IconButton>\n        </Tooltip>\n\n        <Tooltip title=\"Toggle Connection creation\">\n          <IconButton\n            onClick={() => {\n              if (isInCreateConnectionMode) {\n                setSelectedFirstGoal(undefined);\n                setIsInCreateConnectionMode(false);\n              } else {\n                setIsInCreateConnectionMode(true);\n              }\n            }}\n          >\n            <Icon color={isInCreateConnectionMode ? \"secondary\" : \"inherit\"}>\n              {\"trending_flat\"}\n            </Icon>\n          </IconButton>\n        </Tooltip>\n      </Card>\n    </>\n  );\n}\n","import React from \"react\";\nimport { CssBaseline, Box, Card, AppBar, Tab, Tabs } from \"@material-ui/core\";\nimport { ExchangePage } from \"./Pages/ExchangePage\";\nimport { SetupCurrencies } from \"./Pages/SetupCurrencies\";\nimport { SetupExchangeRates } from \"./Pages/SetupExchangeRates\";\nimport { PLSDBContext, CreateOrGetDefaultPLSDatabase } from \"../data/PLSDB\";\nimport { SystemsPage } from \"./Pages/Systems/SystemsPage\";\nimport { getOrAskUser } from \"../Utils\";\nimport {\n  CreateOrGetDefaultSystemsDatabase,\n  SystemsDBContext,\n} from \"../data/SystemsDB\";\nconst firebase = (window as any).firebase;\n\nfunction App() {\n  const [page, setPage] = React.useState(1);\n  const plsDb = React.useMemo(() => CreateOrGetDefaultPLSDatabase(), []);\n  const systemsDb = React.useMemo(\n    () => CreateOrGetDefaultSystemsDatabase(),\n    []\n  );\n  React.useEffect(() => {\n    const username = getOrAskUser(\"username\");\n    const password = getOrAskUser(\"password\");\n    console.log(plsDb);\n    console.log(systemsDb);\n    let didSetupDb = false;\n    const localUID = localStorage.getItem(\"uid\");\n    const setupIfNeeded = (uid: string) => {\n      if (didSetupDb) return;\n      didSetupDb = true;\n\n      plsDb.loadFromFirebase(uid);\n      systemsDb.loadFromFirebase(uid);\n    };\n    if (localUID != null) setupIfNeeded(localUID);\n    firebase\n      .auth()\n      .signInWithEmailAndPassword(username, password)\n      .then((r) => {\n        localStorage.setItem(\"uid\", r.user.uid);\n        setupIfNeeded(r.user.uid);\n      })\n      .catch((e) => {\n        alert(e.message);\n        if (localUID == null) window.location.reload();\n      });\n  }, [plsDb, systemsDb]);\n  return (\n    <PLSDBContext.Provider value={plsDb}>\n      <SystemsDBContext.Provider value={systemsDb}>\n        <CssBaseline />\n        <AppBar position=\"static\">\n          <Tabs value={page} onChange={(_, x) => setPage(x)} centered>\n            <Tab label=\"Setup Currencies\" />\n            <Tab label=\"Exchange\" />\n            <Tab label=\"Setup Exchange Rates\" />\n            <Tab label=\"Systems\" />\n          </Tabs>\n        </AppBar>\n        {page === 3 && <SystemsPage />}\n        {page !== 3 && (\n          <Box marginTop={5} flex={1} minWidth={\"75%\"}>\n            <Card>\n              {page === 0 && <SetupCurrencies />}\n              {page === 1 && <ExchangePage />}\n              {page === 2 && <SetupExchangeRates />}\n            </Card>\n          </Box>\n        )}\n      </SystemsDBContext.Provider>\n    </PLSDBContext.Provider>\n  );\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      process.env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport App from \"./Components/App\";\nimport * as serviceWorker from \"./serviceWorker\";\n\nReactDOM.render(<App />, document.getElementById(\"root\"));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}