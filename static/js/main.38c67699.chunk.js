(this.webpackJsonppls=this.webpackJsonppls||[]).push([[0],{111:function(e,n,t){e.exports=t(124)},124:function(e,n,t){"use strict";t.r(n);var a=t(0),o=t.n(a),r=t(13),i=t.n(r),u=t(11),c=t(167),l=t(168),s=t(173),f=t(169),m=t(171),d=t(154),v=t(181),h=t(155),b=t(156),p=t(96),g=t(158),y=t(63),E=t(12),w=t(29),x=t(64),O=t(65),j=t(176),k=t(178),C=t(150),M=t(151),S=t(152),R=t(72),L=t(179),D=o.a.createContext(null),K=window.firebase;function T(){var e=o.a.useContext(D);if(null==e)throw new Error("useDBContext used outside of the context");return e}var W=function(){function e(){var n=this;Object(x.a)(this,e),this.currencies=new j.a([]),this.exchangeRates=new j.a([]),this.bank=new j.a({}),this.dbRef=void 0,Object(k.a)(this.bank.pipe(Object(C.a)(1),Object(M.a)()),this.exchangeRates.pipe(Object(C.a)(1),Object(M.a)()),this.currencies.pipe(Object(C.a)(1),Object(M.a)())).pipe(Object(S.a)(1e3)).subscribe({next:function(){return n.save()}})}return Object(O.a)(e,[{key:"addOrUpdateCurrency",value:function(e){var n=Object(w.a)(this.currencies.value),t=n.find((function(n){return n.name===e.name}));null!=t?Object.assign(t,e):n.push(e),this.currencies.next(n)}},{key:"bankOf",value:function(e){return this.bank.pipe(Object(R.a)((function(n){var t;return null!==(t=n[e.name])&&void 0!==t?t:0})))}},{key:"canSpend",value:function(e,n){return this.bankOf(e).pipe(Object(R.a)((function(e){return e-n>=0})))}},{key:"addToBank",value:function(e,n){var t;this.bank.next(Object(E.a)({},this.bank.value,Object(y.a)({},e.name,Math.max(0,(null!==(t=this.bank.value[e.name])&&void 0!==t?t:0)+n))))}},{key:"exchange",value:function(e,n){var t=this;this.canExchange(e,n).pipe(Object(L.a)(1)).subscribe({next:function(a){if(a){var o=Object(E.a)({},t.bank.value);null==o[e.from.name]&&(o[e.from.name]=0),o[e.from.name]-=n,null==o[e.to.name]&&(o[e.to.name]=0),o[e.to.name]+=n*e.rate,t.bank.next(o)}}})}},{key:"canExchange",value:function(e,n){return this.bankOf(e.from).pipe(Object(R.a)((function(e){return e>=n})))}},{key:"removeCurrency",value:function(e){this.currencies.next(this.currencies.value.filter((function(n){return n.name!==e.name})))}},{key:"addOrUpdateExchangeRate",value:function(e){var n=Object(w.a)(this.exchangeRates.value),t=n.find((function(n){return n.from.name===e.from.name&&n.to.name===e.to.name}));null!=t?Object.assign(t,e):n.push(e),this.exchangeRates.next(n)}},{key:"removeExchangeRate",value:function(e){this.exchangeRates.next(this.exchangeRates.value.filter((function(n){return n.from.name!==e.from.name||n.to.name!==e.to.name})))}},{key:"getCurrencies",value:function(){return this.currencies}},{key:"getExchangeRates",value:function(){return this.exchangeRates}},{key:"loadFromFirebase",value:function(e){var n=this;K.firestore().enablePersistence().then((function(e){return console.log("OK enablePersistence",e)})).catch((function(e){return console.error("NOK enablePersistence",e)})),this.dbRef=K.database().ref("sync_data/".concat(e)),console.log(this.dbRef),this.dbRef.on("value",(function(e){var t,a,o,r,i=JSON.parse(null!==(t=e.val())&&void 0!==t?t:"{}");n.currencies.next(null!==(a=i.currencies)&&void 0!==a?a:[]),n.exchangeRates.next(null!==(o=i.exchangeRates)&&void 0!==o?o:[]),n.bank.next(null!==(r=i.bank)&&void 0!==r?r:{}),console.log("Updating")}))}},{key:"save",value:function(){var e={currencies:this.currencies.value,exchangeRates:this.exchangeRates.value,bank:this.bank.value};this.dbRef.set(JSON.stringify(e)),console.log("Saving")}}]),e}();function N(e,n){var t=o.a.useState(n),a=Object(u.a)(t,2),r=a[0],i=a[1];return o.a.useEffect((function(){var n=("function"===typeof e?e():e).subscribe({next:function(e){i(e)}});return function(){return n.unsubscribe()}}),[]),r}function U(e){var n,t=localStorage.getItem(e);null==t&&(t=null!==(n=prompt(e))&&void 0!==n?n:"",localStorage.setItem(e,t));return t}function G(e){var n=e.exchangeRate,t=e.value,a=e.onDone,r=e.innerRef,i=T(),u=N(i.canExchange(n,t),!1);return o.a.createElement(v.a,{disabled:!u,innerRef:r,onClick:function(){i.exchange(n,t),a()}},"1 ".concat(n.from.unit," of ").concat(n.from.name," to ").concat(t*n.rate," ").concat(n.to.unit," of ").concat(n.to.name))}var I=o.a.forwardRef((function(e,n){return o.a.createElement(G,Object.assign({},e,{innerRef:n}))}));function z(e){var n=e.currency,t=T(),a=N(t.getExchangeRates(),[]),r=N(t.bankOf(n),0),i=o.a.useState(null),c=Object(u.a)(i,2),l=c[0],s=c[1],f=function(){s(null)};return o.a.createElement(d.a,{variant:"outlined",style:{margin:3}},o.a.createElement(m.a,{padding:2,display:"flex",flexDirection:"column"},o.a.createElement(h.a,null,"".concat(r," ").concat(n.unit," of ").concat(n.name)),o.a.createElement(b.a,{onClick:function(e){return s(e.currentTarget)},"aria-controls":"menu","aria-haspopup":"true"},"Exchange"),o.a.createElement(p.a,{id:"menu",anchorEl:l,keepMounted:!0,open:null!=l,onClose:f},a.filter((function(e){return e.from.name===n.name})).map((function(e){return o.a.createElement(I,{key:e.from.name+"_"+e.to.name,exchangeRate:e,value:1,onDone:f})}))),o.a.createElement(m.a,{display:"flex",flexDirection:"row"},o.a.createElement(b.a,{onClick:function(e){return t.addToBank(n,1)}},"+1"),o.a.createElement(b.a,{onClick:function(e){return t.addToBank(n,-1)}},"-1"))))}function B(e){var n=e.currency,t=T(),a=N(t.bankOf(n),0),r=N(t.canSpend(n,1),!1),i=N(t.getExchangeRates(),[]).filter((function(e){return e.from.name===n.name})),c=o.a.useState(null),l=Object(u.a)(c,2),s=l[0],f=l[1],v=function(){f(null)};return o.a.createElement(d.a,{variant:"outlined",style:{margin:3}},o.a.createElement(m.a,{padding:2,display:"flex",flexDirection:"column"},o.a.createElement(h.a,null,"".concat(a," ").concat(n.unit," of ").concat(n.name)),i.length>0&&o.a.createElement(o.a.Fragment,null,o.a.createElement(b.a,{onClick:function(e){return f(e.currentTarget)},"aria-controls":"menu","aria-haspopup":"true"},"Exchange"),o.a.createElement(p.a,{id:"menu",anchorEl:s,keepMounted:!0,open:null!=s,onClose:v},i.filter((function(e){return e.from.name===n.name})).map((function(e){return o.a.createElement(I,{key:e.from.name+"_"+e.to.name,exchangeRate:e,value:1,onDone:v})})))),o.a.createElement(b.a,{disabled:!r,onClick:function(){return t.addToBank(n,-1)}},"Spend 1 ".concat(n.unit))))}function P(){var e=N(T().getCurrencies(),[]);return o.a.createElement(m.a,{display:"flex",flexDirection:"column",alignItems:"center"},o.a.createElement(h.a,{variant:"h5"},"Exchange"),o.a.createElement(m.a,{display:"flex",flexWrap:"wrap",flexDirection:"row",justifyContent:"center"},e.filter((function(e){return e.isSource})).map((function(e){return o.a.createElement(z,{key:e.name,currency:e})}))),o.a.createElement(g.a,{variant:"middle"}),o.a.createElement(h.a,{variant:"h5"},"Spend"),o.a.createElement(m.a,{display:"flex",flexWrap:"wrap",flexDirection:"row",justifyContent:"center"},e.filter((function(e){return!e.isSource})).map((function(e){return o.a.createElement(B,{key:e.name,currency:e})}))))}var F=t(160),_=t(182),J=t(175),A=t(159);function V(){return Object(A.a)("(max-width:425px)")}function X(e){var n=e.currency,t=e.isNew,a=T(),r=o.a.useState((function(){return n.name})),i=Object(u.a)(r,2),c=i[0],l=i[1],s=o.a.useState((function(){return n.icon})),f=Object(u.a)(s,2),v=f[0],p=f[1],g=o.a.useState((function(){return n.description})),y=Object(u.a)(g,2),E=y[0],w=y[1],x=o.a.useState((function(){return n.isSource})),O=Object(u.a)(x,2),j=O[0],k=O[1],C=o.a.useState((function(){return n.isTime})),M=Object(u.a)(C,2),S=M[0],R=M[1],L=o.a.useState((function(){return n.unit})),D=Object(u.a)(L,2),K=D[0],W=D[1],N=V(),U=c!==n.name||v!==n.icon||E!==n.description||S!==n.isTime||K!==n.unit||j!==n.isSource,G=o.a.createElement(o.a.Fragment,null,!t&&o.a.createElement(F.a,null,n.icon),t&&o.a.createElement(_.a,{label:"Icon",value:v,onChange:function(e){return p(e.target.value)}}),o.a.createElement(_.a,{label:"Name",value:c,onChange:function(e){return l(e.target.value)}}),o.a.createElement(_.a,{label:"Description",value:E,onChange:function(e){return w(e.target.value)}}),o.a.createElement(_.a,{label:"Unit",value:K,onChange:function(e){return W(e.target.value)}}),o.a.createElement(J.a,{checked:S,onChange:function(e,n){return R(n)}}),o.a.createElement(h.a,null,"Is time"),o.a.createElement(J.a,{checked:j,onChange:function(e,n){return k(n)}}),o.a.createElement(h.a,null,"Is source"),U&&o.a.createElement(b.a,{onClick:function(){a.addOrUpdateCurrency({name:c,icon:v,description:E,isTime:S,unit:K,isSource:j})}},o.a.createElement(F.a,null,"save")),!t&&o.a.createElement(b.a,{onClick:function(){a.removeCurrency(n)}},o.a.createElement(F.a,null,"delete")));return N?o.a.createElement(d.a,{style:{margin:15}},o.a.createElement(m.a,{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"space-between",padding:1},G)):o.a.createElement(m.a,{display:"flex",flexDirection:"row",alignItems:"center",margin:1,justifyContent:"space-between"},G)}function H(){var e=N(T().getCurrencies(),[]);return o.a.createElement(m.a,{display:"flex",flexDirection:"column"},e.map((function(e,n){return o.a.createElement(X,{key:e.name,currency:e,isNew:!1})})),o.a.createElement(X,{key:"new_currency_item_".concat(e.length),currency:{name:"New currency ".concat(e.length+1),description:"",icon:"",isSource:!1,isTime:!1,unit:"hour"},isNew:!0}))}var Y=t(163),Z=t(184),Q=t(174);function $(e){var n=e.rate,t=e.isNew,a=T(),r=N(a.getCurrencies(),[]),i=o.a.useState((function(){return null===n||void 0===n?void 0:n.from})),c=Object(u.a)(i,2),l=c[0],s=c[1],f=o.a.useState((function(){return null===n||void 0===n?void 0:n.to})),p=Object(u.a)(f,2),g=p[0],y=p[1],E=o.a.useState((function(){var e;return null!==(e=null===n||void 0===n?void 0:n.rate.toString())&&void 0!==e?e:""})),w=Object(u.a)(E,2),x=w[0],O=w[1],j=V(),k=(null===l||void 0===l?void 0:l.name)!==(null===n||void 0===n?void 0:n.from.name)||(null===g||void 0===g?void 0:g.name)!==(null===n||void 0===n?void 0:n.to.name)||Number(x)!==(null===n||void 0===n?void 0:n.rate),C=!isNaN(Number(x))&&null!=l&&null!=g&&Number(x)>0,M=o.a.createElement(o.a.Fragment,null,o.a.createElement(m.a,{display:"flex",flexDirection:"row"},o.a.createElement(Y.a,null,o.a.createElement(Z.a,{id:"from-label-id"},"From"),o.a.createElement(Q.a,{labelId:"from-label-id",value:null===l||void 0===l?void 0:l.name,onChange:function(e,n){return s(r.find((function(n){return n.name===e.target.value})))}},o.a.createElement(v.a,null,"-"),r.filter((function(e){return e.name!==(null===g||void 0===g?void 0:g.name)})).map((function(e,n){return o.a.createElement(v.a,{key:e.name+"_from",value:e.name},e.name)})))),o.a.createElement(m.a,{marginX:1}),o.a.createElement(_.a,{value:x,inputMode:"decimal",onChange:function(e){return O(e.target.value)},label:"Rate"}),o.a.createElement(m.a,{marginX:1}),o.a.createElement(Y.a,null,o.a.createElement(Z.a,{id:"to-label-id"},"To"),o.a.createElement(Q.a,{labelId:"to-label-id",value:null===g||void 0===g?void 0:g.name,onChange:function(e,n){return y(r.find((function(n){return n.name===e.target.value})))}},o.a.createElement(v.a,null,"-"),r.filter((function(e){return e.name!==(null===l||void 0===l?void 0:l.name)})).map((function(e,n){return o.a.createElement(v.a,{key:e.name+"_to",value:e.name},e.name)}))))),C&&o.a.createElement(h.a,null,"1 ".concat(null===l||void 0===l?void 0:l.unit," of ").concat(null===l||void 0===l?void 0:l.name," = ").concat(Number(x)," ").concat(null===g||void 0===g?void 0:g.unit," of ").concat(null===g||void 0===g?void 0:g.name)),o.a.createElement(m.a,{display:"flex",flexDirection:"row"},k&&C&&o.a.createElement(b.a,{onClick:function(){null!=l&&null!=g&&a.addOrUpdateExchangeRate({from:l,to:g,rate:Number(x)})}},o.a.createElement(F.a,null,"save")),!t&&null!=n&&o.a.createElement(b.a,{onClick:function(){a.removeExchangeRate(n)}},o.a.createElement(F.a,null,"delete"))));return j?o.a.createElement(d.a,{style:{margin:10}},o.a.createElement(m.a,{display:"flex",flexDirection:"column",alignItems:"center",margin:1},M)):o.a.createElement(m.a,{display:"flex",flexDirection:"row",alignItems:"center",margin:1,justifyContent:"space-between"},M)}function q(){var e=N(T().getExchangeRates(),[]);return o.a.createElement(m.a,{display:"flex",flexDirection:"column"},e.map((function(e,n){return o.a.createElement($,{key:e.from.name+"_"+e.to.name+"_"+e.rate,rate:e,isNew:!1})})),o.a.createElement($,{key:e.length,isNew:!0}))}var ee=t(165),ne=t(170),te=t(81),ae=t(185),oe=t(172),re={bounds:{top:0,height:50,left:0,width:50},name:"",labels:[]},ie=window.firebase,ue=a.createContext(null);function ce(){var e=a.useContext(ue);if(null==e)throw new Error("useDBContext used outside of the context");return e}function le(e){return null!=e.name?e.name:e.from+":"+e.to}var se=function(){function e(){var n=this;Object(x.a)(this,e),this._forceUpdate=new j.a(null),this.goals=new j.a([]),this.connections=new j.a([]),this.systems=new j.a([]),this.config=new j.a({zoomLevel:1,cameraPosition:{x:0,y:0}}),this.dbRef=void 0,Object(k.a)(this.goals.pipe(Object(C.a)(1),Object(R.a)((function(e){return JSON.stringify(e.map((function(e){return e.value})))})),Object(M.a)()),this.connections.pipe(Object(C.a)(1),Object(R.a)((function(e){return JSON.stringify(e.map((function(e){return e.value})))})),Object(M.a)()),this.systems.pipe(Object(C.a)(1),Object(R.a)((function(e){return JSON.stringify(e.map((function(e){return e.value})))})),Object(M.a)()),this.config.pipe(Object(C.a)(1),Object(R.a)((function(e){return JSON.stringify(e)})),Object(M.a)()),this._forceUpdate).pipe(Object(S.a)(1e3)).subscribe({next:function(){return n.save()}})}return Object(O.a)(e,[{key:"getGoalInitialValue",value:function(e){var n,t=null===(n=this.goals.value.find((function(n){return le(n.value)===e})))||void 0===n?void 0:n.value;return null==t?re:t}},{key:"getGoalWithKey",value:function(e){var n=this.goals.value.find((function(n){return le(n.value)===e}));return null==n?new j.a(re):n}},{key:"updateGoalWithKey",value:function(e,n){var t=this.goals.value.find((function(n){return le(n.value)===e}));if(null!=t){var a=n(t.value);null==this.goals.value.find((function(e){return le(e.value)===le(a)&&e!==t}))?(t.next(a),this._forceUpdate.next(null)):alert("There is already another goal with this name")}}},{key:"deleteGoal",value:function(e){this.goals.next(this.goals.value.filter((function(n){return le(n.value)!==e})))}},{key:"createGoal",value:function(e){this.goals.next([].concat(Object(w.a)(this.goals.value),[new j.a(e)]))}},{key:"getZoomLevel",value:function(){return this.config.pipe(Object(M.a)(),Object(R.a)((function(e){return e.zoomLevel})))}},{key:"getCameraPosition",value:function(){return this.config.pipe(Object(M.a)(),Object(R.a)((function(e){return e.cameraPosition})))}},{key:"getGoalsWithKey",value:function(){return this.goals.pipe(Object(R.a)((function(e){return e.map((function(e){return[e,le(e.value)]}))})))}},{key:"getSystemsWithKey",value:function(){return this.systems.pipe(Object(R.a)((function(e){return e.map((function(e){return[e,le(e.value)]}))})))}},{key:"getConnectionsWithKeys",value:function(){return this.connections.pipe(Object(R.a)((function(e){return e.map((function(e){return[e.value,le(e.value)]}))})))}},{key:"deleteConnection",value:function(e){this.connections.next(this.connections.value.filter((function(n){return le(n.value)!==e})))}},{key:"createConnection",value:function(e){var n=e.from,t=e.to;this.connections.next([].concat(Object(w.a)(this.connections.value),[new j.a({from:le(n),to:le(t)})]))}},{key:"getSystemGoals",value:function(e){var n=this,t=this.systems.value.find((function(n){return le(n.value)===("string"===typeof e?e:le(e))}));if(null==t)throw new Error("System not found");return Object(k.a)(t,this.goals).pipe(Object(ae.a)(30),Object(R.a)((function(e){var t=Object(u.a)(e,1)[0];return n.goals.pipe(Object(ae.a)(30),Object(R.a)((function(e){return e.filter((function(e){return n=e.value.bounds,a=t.bounds,!(n.left<=a.left)&&!(n.top<=a.top)&&!(n.left+n.width>=a.left+a.width)&&!(n.top+n.height>=a.top+a.height);var n,a}))})))})),Object(oe.a)((function(e){return e})))}},{key:"getSystemInitialValue",value:function(e){var n,t=null===(n=this.systems.value.find((function(n){return le(n.value)===e})))||void 0===n?void 0:n.value;if(null==t)throw new Error("System not found");return t}},{key:"updateSystemWithKey",value:function(e,n){var t=this.systems.value.find((function(n){return le(n.value)===e}));if(null==t)throw new Error("System not found");var a=n(t.value);null==this.systems.value.find((function(e){return le(e.value)===le(a)&&e!==t}))?(t.next(a),this._forceUpdate.next(null)):alert("There is already another goal with this name")}},{key:"deleteSystem",value:function(e){this.systems.next(this.systems.value.filter((function(n){return le(n.value)!==e})))}},{key:"createSystem",value:function(e){this.systems.next([].concat(Object(w.a)(this.systems.value),[new j.a(e)]))}},{key:"loadFromFirebase",value:function(e){var n=this;this.dbRef=ie.database().ref("systems/".concat(e)),this.dbRef.on("value",(function(e){var t,a,o,r,i;console.log("Updating Systems");var u=JSON.parse(null!==(t=e.val())&&void 0!==t?t:"{}"),c=null!==(a=u.goals)&&void 0!==a?a:[],l=null!==(o=u.systems)&&void 0!==o?o:[],s=null!==(r=u.connections)&&void 0!==r?r:[],f=null!==(i=u.config)&&void 0!==i?i:{zoomLevel:1,cameraPosition:{x:0,y:0}};JSON.stringify(f)!==JSON.stringify(n.config.value)&&n.config.next(f),fe(n.goals,c),fe(n.systems,l),fe(n.connections,s)}))}},{key:"save",value:function(){var e={goals:this.goals.value.map((function(e){return e.value})),systems:this.systems.value.map((function(e){return e.value})),connections:this.connections.value.map((function(e){return e.value})),config:this.config.value},n=JSON.stringify(e);this.dbRef.set(n),console.log("Saving Systems")}}]),e}();function fe(e,n){var t={},a=function(e,n){var t,a=[],o=[],r=Object(te.a)(n);try{e:for(r.s();!(t=r.n()).done;){var i,u=t.value,c=Object(te.a)(e);try{for(c.s();!(i=c.n()).done;){if(le(i.value)===le(u)){o.push(u);continue e}}}catch(s){c.e(s)}finally{c.f()}a.push(u)}}catch(s){r.e(s)}finally{r.f()}var l=e.filter((function(e){return!o.map((function(e){return le(e)})).includes(le(e))}));return{newAdded:a,deleted:l,existed:o}}(e.value.map((function(e){return t[le(e.value)]=e,e.value})),n),o=Object(w.a)(a.newAdded.map((function(e){return new j.a(e)})));a.existed.forEach((function(e){var n=t[le(e)];o.push(n),JSON.stringify(n.value)!==JSON.stringify(e)&&n.next(e)})),e.next(o)}var me=Object(ne.a)({rootContainer:{"&::-webkit-scrollbar":{display:"none"}},innerContainer:{width:"100%",height:"100%",position:"relative"}});function de(e){var n=e.zoomLevel,t=e.cameraPosition;return"transform:translate(".concat(t.x,"px,").concat(t.y,"px) scale(").concat(n,")")}function ve(e){var n=o.a.useRef(),t=o.a.useRef(),a=o.a.useRef(),r=ce(),i=me({}),c=o.a.useState({width:0,height:0}),l=Object(u.a)(c,2),s=l[0],f=l[1],m=function(e){var n=o.a.useState(!1),t=Object(u.a)(n,2),a=t[0],r=t[1];return o.a.useEffect((function(){var n=function(n){n.button===e&&r(!0)},t=function(n){n.button===e&&r(!1)};return window.document.addEventListener("mousedown",n),window.document.addEventListener("mouseup",t),function(){window.document.removeEventListener("mousedown",n),window.document.removeEventListener("mouseup",t)}}),[e]),a}(1),d=o.a.useState(1),v=Object(u.a)(d,2)[1],h=o.a.useMemo((function(){return r.config.value}),[r]),b=o.a.useCallback((function(){r.config.next(h)}),[r.config,h]),p=o.a.useCallback((function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(null==t.current)throw new Error("Unhandled situtation innerRef cannot be null here");null!=a.current&&(a.current.innerText="".concat(h.cameraPosition.x,", ").concat(h.cameraPosition.y," (x").concat(h.zoomLevel.toPrecision(2),")"));var n=de(h),o=";transition: transform 100ms";e&&(t.current.setAttribute("style",t.current.style+o),n+=o),t.current.setAttribute("style",n)}),[t,h,a]);return o.a.useEffect((function(){p(!1)}),[p]),o.a.useEffect((function(){var e=r.config.pipe(Object(C.a)(1),Object(L.a)(1)).subscribe({next:function(e){h.cameraPosition=e.cameraPosition,h.zoomLevel=e.zoomLevel,p(!1)}});return function(){return e.unsubscribe()}}),[r,h,p]),o.a.useEffect((function(){var e=function(e){32===e.keyCode&&(h.zoomLevel=1,p(!0),b())};return window.document.addEventListener("keyup",e),function(){return window.document.removeEventListener("keyup",e)}}),[p,h,b]),o.a.useEffect((function(){var e=new j.a(null),n=e.pipe(Object(S.a)(100)).subscribe({next:function(){return v(h.zoomLevel)}}),t=function(n){h.zoomLevel=Math.max(.1,h.zoomLevel+-5e-4*n.deltaY),b(),p(!0),e.next(null)};return window.document.addEventListener("wheel",t),function(){window.document.removeEventListener("wheel",t),n.unsubscribe()}}),[p,h,b]),o.a.useLayoutEffect((function(){if(m){document.body.style.cursor="move";var e=function(e){h.cameraPosition.x+=e.movementX,h.cameraPosition.y+=e.movementY,b(),p()};return document.addEventListener("mousemove",e),function(){return document.removeEventListener("mousemove",e)}}document.body.style.cursor="default"}),[m,t,p,h,b]),o.a.useLayoutEffect((function(){var e=function(){if(null==n.current)throw new Error("Unhandled situtation");var e=window.innerHeight-n.current.getBoundingClientRect().top,t=window.innerWidth;f({height:e,width:t})};e();var t=Object(ee.a)(window,"resize").pipe(Object(S.a)(50)).subscribe({next:function(){return e()}});return function(){return t.unsubscribe()}}),[n]),o.a.createElement("div",{ref:n,className:i.rootContainer,id:"canvas",style:{width:s.width,height:s.height,position:"relative",overflow:"hidden"}},o.a.createElement("div",{ref:t,className:i.innerContainer},e.children),o.a.createElement("p",{ref:a,style:{position:"absolute",bottom:0,right:20,opacity:.5}}))}var he=t(187),be=t(186),pe=t(93),ge=t.n(pe);function ye(e){var n,t={display:"flex",flexDirection:"row"},a={width:e.borderWidth,height:e.borderWidth},r={flex:1,height:e.borderWidth},i={width:e.borderWidth};return o.a.createElement("div",{style:Object(E.a)({},null!==(n=e.style)&&void 0!==n?n:{},{display:"flex",flexDirection:"column"}),onMouseMove:e.onMouseMove},o.a.createElement("div",{style:t},o.a.createElement("div",{onMouseEnter:null==e.onTL?void 0:function(){return e.onTL({state:"entered"})},onMouseLeave:null==e.onTL?void 0:function(){return e.onTL({state:"exited"})},onMouseDown:e.onMouseDown,onMouseUp:e.onMouseUp,style:Object(E.a)({},a,{cursor:"nw-resize"})}),o.a.createElement("div",{onMouseEnter:null==e.onT?void 0:function(){return e.onT({state:"entered"})},onMouseLeave:null==e.onT?void 0:function(){return e.onT({state:"exited"})},onMouseDown:e.onMouseDown,onMouseUp:e.onMouseUp,style:Object(E.a)({},r,{cursor:"n-resize"})}),o.a.createElement("div",{onMouseEnter:null==e.onTR?void 0:function(){return e.onTR({state:"entered"})},onMouseLeave:null==e.onTR?void 0:function(){return e.onTR({state:"exited"})},onMouseDown:e.onMouseDown,onMouseUp:e.onMouseUp,style:Object(E.a)({},a,{cursor:"ne-resize"})})),o.a.createElement("div",{style:t},o.a.createElement("div",{onMouseEnter:null==e.onL?void 0:function(){return e.onL({state:"entered"})},onMouseLeave:null==e.onL?void 0:function(){return e.onL({state:"exited"})},onMouseDown:e.onMouseDown,onMouseUp:e.onMouseUp,style:Object(E.a)({},i,{cursor:"w-resize"})}),o.a.createElement("div",{style:{width:"100%",height:"100%"}},e.children),o.a.createElement("div",{onMouseEnter:null==e.onR?void 0:function(){return e.onR({state:"entered"})},onMouseLeave:null==e.onR?void 0:function(){return e.onR({state:"exited"})},onMouseDown:e.onMouseDown,onMouseUp:e.onMouseUp,style:Object(E.a)({},i,{cursor:"w-resize"})})),o.a.createElement("div",{style:t},o.a.createElement("div",{onMouseEnter:null==e.onBL?void 0:function(){return e.onBL({state:"entered"})},onMouseLeave:null==e.onBL?void 0:function(){return e.onBL({state:"exited"})},onMouseDown:e.onMouseDown,onMouseUp:e.onMouseUp,style:Object(E.a)({},a,{cursor:"sw-resize"})}),o.a.createElement("div",{onMouseEnter:null==e.onB?void 0:function(){return e.onB({state:"entered"})},onMouseLeave:null==e.onB?void 0:function(){return e.onB({state:"exited"})},onMouseDown:e.onMouseDown,onMouseUp:e.onMouseUp,style:Object(E.a)({},r,{cursor:"n-resize"})}),o.a.createElement("div",{onMouseEnter:null==e.onBR?void 0:function(){return e.onBR({state:"entered"})},onMouseLeave:null==e.onBR?void 0:function(){return e.onBR({state:"exited"})},onMouseDown:e.onMouseDown,onMouseUp:e.onMouseUp,style:Object(E.a)({},a,{cursor:"se-resize"})})))}var Ee=t(166);function we(e){var n=a.useRef(!1),t=a.useRef(),r=a.useMemo((function(){return e.updateManager.initial}),[e.updateManager]),i=function(){var e=o.a.useState(0),n=Object(u.a)(e,2)[1];return o.a.useCallback((function(){return n((function(e){return e+1}))}),[])}(),c=a.useRef("none"),l=a.useCallback((function(n){var t=n(r),a=Object(E.a)({},t,{width:Math.max(t.width,100),height:Math.max(t.height,70)});Object.assign(r,a),i(),setTimeout((function(){return e.updateManager.sendUpdate(r)}),50)}),[r,i,e.updateManager]);a.useEffect((function(){var n=e.updateManager.updates.pipe(Object(Ee.a)((function(e){return e.width!==r.width||e.height!==r.height||e.top!==r.top||e.left!==r.left}))).subscribe({next:function(e){return l((function(){return e}))}});return function(){return n.unsubscribe()}}),[e.updateManager,r,l]),a.useEffect((function(){var e=function(e){if(n.current){var t=e.movementX,a=e.movementY;"r"===c.current&&l((function(e){return Object(E.a)({},e,{width:e.width+t})})),"br"===c.current&&l((function(e){return Object(E.a)({},e,{width:e.width+t,height:e.height+a})})),"b"===c.current&&l((function(e){return Object(E.a)({},e,{height:e.height+a})})),"bl"===c.current&&l((function(e){return Object(E.a)({},e,{width:e.width+-t,left:e.left+t,height:e.height+a})})),"l"===c.current&&l((function(e){return Object(E.a)({},e,{width:e.width+-t,left:e.left+t})})),"tl"===c.current&&l((function(e){return Object(E.a)({},e,{width:e.width+-t,top:e.top+a,left:e.left+t,height:e.height+-a})})),"t"===c.current&&l((function(e){return Object(E.a)({},e,{top:e.top+a,height:e.height+-a})})),"tr"===c.current&&l((function(e){return Object(E.a)({},e,{width:e.width+t,top:e.top+a,height:e.height+-a})}))}},t=function(e){n.current=!1};return document.addEventListener("mousemove",e),document.addEventListener("mouseup",t),function(){document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",t)}}),[n,c,e.scale,l]);return a.createElement(ge.a,{handle:".handle",position:{x:r.left,y:r.top},onDrag:function(e,n){l((function(e){return Object(E.a)({},e,{left:n.x,top:n.y})}))},positionOffset:e.offsetPosition,scale:e.scale},a.createElement("div",{ref:t,style:{position:"absolute"}},a.createElement(ye,{onMouseDown:function(e){n.current=!0},borderWidth:10,onL:function(){return!n.current&&(c.current="l")},onR:function(){return!n.current&&(c.current="r")},onTL:function(){return!n.current&&(c.current="tl")},onT:function(){return!n.current&&(c.current="t")},onTR:function(){return!n.current&&(c.current="tr")},onBL:function(){return!n.current&&(c.current="bl")},onB:function(){return!n.current&&(c.current="b")},onBR:function(){return!n.current&&(c.current="br")}},e.children(r))))}function xe(e){var n,t=N(e.goal,null),o=(null===(n=e.selectedGoal)||void 0===n?void 0:n.name)===(null===t||void 0===t?void 0:t.name),r=a.useRef(),i=ce(),u=a.useMemo((function(){return{sendUpdate:function(n){return i.updateGoalWithKey(e.goalKey,(function(e){return Object(E.a)({},e,{bounds:n})}))},initial:i.getGoalInitialValue(e.goalKey).bounds,updates:e.goal.pipe(Object(R.a)((function(e){return e.bounds})),Object(be.a)((function(e){if(null!=r.current){var n="".concat(e.left.toFixed(2),", ").concat(e.top.toFixed(2)),t="w".concat(e.width.toFixed(),"h").concat(e.height.toFixed());r.current.innerText="".concat(n," ").concat(t,";")}})))}}),[e.goalKey,i,e.goal]);return null==t?null:a.createElement(we,{updateManager:u,scale:e.scale},(function(n){return a.createElement(d.a,{onClick:function(){return e.onClick(t)},elevation:4,variant:o?"elevation":"outlined",style:{padding:5,width:n.width,height:n.height,display:"flex",flexDirection:"column",userSelect:"none",justifyContent:"space-between"}},a.createElement("div",{style:{display:"flex",flexDirection:"row"}},a.createElement(F.a,{className:"handle"},"drag_handle"),a.createElement(F.a,{style:{cursor:"pointer"},onClick:function(){window.confirm("Are you sure you want to delete this goal?")&&i.deleteGoal(e.goalKey)}},"delete")),a.createElement("div",{style:{display:"flex",flexDirection:"row",flexWrap:"wrap",alignItems:"baseline",fontSize:30,alignSelf:"center",cursor:"pointer"},className:"content",onClick:function(){var n=prompt("Enter goal name",t.name);null!=n&&i.updateGoalWithKey(e.goalKey,(function(e){return Object(E.a)({},e,{name:n})}))},dangerouslySetInnerHTML:{__html:t.name}}),a.createElement(m.a,{display:"flex",flexDirection:"row",flexWrap:"warp"},t.labels.map((function(n,t){return a.createElement(he.a,{onClick:function(){window.confirm("Are you sure you want to delete this label?")&&i.updateGoalWithKey(e.goalKey,(function(e){return Object(E.a)({},e,{labels:e.labels.filter((function(e){return e!==n}))})}))},style:{margin:3},size:"small",key:t,label:n})})),a.createElement(he.a,{onClick:function(){var n=prompt("Enter label text");null!=n&&i.updateGoalWithKey(e.goalKey,(function(e){return Object(E.a)({},e,{labels:[].concat(Object(w.a)(e.labels),[n])})}))},style:{margin:3,cursor:"pointer"},size:"small",color:"primary",label:"+"})),a.createElement("p",{ref:r,style:{position:"absolute",bottom:0,right:20,opacity:.5}}))}))}var Oe=t(180),je=t(164);function ke(e){var n=N(e.system,null),t=ce(),o=a.useRef(),r=N((function(){return t.getSystemGoals(e.systemKey)}),[]),i=a.useMemo((function(){return{sendUpdate:function(n){return t.updateSystemWithKey(e.systemKey,(function(e){return Object(E.a)({},e,{bounds:n})}))},initial:t.getSystemInitialValue(e.systemKey).bounds,updates:e.system.pipe(Object(R.a)((function(e){return e.bounds})),Object(be.a)((function(e){if(null!=o.current){var n="".concat(e.left.toFixed(2),", ").concat(e.top.toFixed(2)),t="w".concat(e.width.toFixed(),"h").concat(e.height.toFixed());o.current.innerText="".concat(n," ").concat(t,";")}})))}}),[e.systemKey,t,e.system]);if(null==n)return null;var u="".concat("rgba(0,0,0,0.6)"," dashed");return a.createElement(we,{updateManager:i,scale:e.scale},(function(i){return a.createElement("div",{onClick:function(){return null!=e.onClick&&e.onClick(n)},style:{padding:5,width:i.width,height:i.height,display:"flex",flexDirection:"column",justifyContent:"space-between",borderColor:"rgba(0,0,0,0.6)",borderWidth:2,borderStyle:"dashed",borderRadius:5,borderTopLeftRadius:0,pointerEvents:"visible"}},a.createElement(F.a,{className:"handle"},"drag_handle"),a.createElement(F.a,{style:{cursor:"pointer",position:"absolute",left:50},onClick:function(){window.confirm("Are you sure you want to delete this system?")&&t.deleteSystem(e.systemKey)}},"delete"),a.createElement("p",{style:{position:"absolute",bottom:0,left:15}},"".concat(r.length," Goals")),a.createElement("div",{style:{position:"absolute",top:-38,fontSize:"25pt",paddingLeft:5,paddingRight:5,left:10,borderLeft:u,borderTop:u,borderRight:u,borderWidth:2},onClick:function(){var a=prompt("Enter system name",n.name);null!=a&&t.updateSystemWithKey(e.systemKey,(function(e){return Object(E.a)({},e,{name:a})}))},dangerouslySetInnerHTML:{__html:n.name}}),a.createElement("p",{ref:o,style:{position:"absolute",bottom:0,right:20,opacity:.5}}))}))}var Ce=t(94);function Me(e){var n=ce(),t=N((function(){return n.getConnectionsWithKeys()}),[]);return a.createElement("svg",{style:{width:"100%",overflow:"visible",height:"100%"},stroke:"#000",fill:"#000",strokeWidth:3},t.map((function(e){var n=Object(u.a)(e,2),t=n[0],o=n[1];return a.createElement(Se,{fromGoalKey:t.from,toGoalKey:t.to,key:o})})))}function Se(e){var n=e.fromGoalKey,t=e.toGoalKey,o=ce(),r=N((function(){return o.getGoalWithKey(n)}),o.getGoalInitialValue(n)),i=N((function(){return o.getGoalWithKey(t)}),o.getGoalInitialValue(t)),c=Object(Ce.a)(r.bounds.left,r.bounds.top,r.bounds.width+20,r.bounds.height+20,i.bounds.left,i.bounds.top,i.bounds.width+20,i.bounds.height+20,{bow:.1}),l=Object(u.a)(c,7),s=l[0],f=l[1],m=l[2],d=l[3],v=l[4],h=l[5],b=l[6]*(180/Math.PI);return console.log(s,f),a.createElement(a.Fragment,null,a.createElement("circle",{cx:s,cy:f,r:4}),a.createElement("path",{d:"M".concat(s,",").concat(f," Q").concat(m,",").concat(d," ").concat(v,",").concat(h),fill:"none",onClick:function(){window.confirm("Are you sure you want to delete this connection?")&&o.deleteConnection(le({from:n,to:t}))}}),a.createElement("polygon",{points:"0,-6 12,0, 0,6",transform:"translate(".concat(v,",").concat(h,") rotate(").concat(b,")")}))}function Re(){var e=ce(),n=N((function(){return e.getZoomLevel()}),1),t=N((function(){return e.getGoalsWithKey()}),[]),o=N((function(){return e.getSystemsWithKey()}),[]),r=a.useState(!1),i=Object(u.a)(r,2),c=i[0],l=i[1],s=a.useState(),f=Object(u.a)(s,2),m=f[0],v=f[1];return a.createElement(a.Fragment,null,a.createElement(ve,null,o.map((function(e){var t=Object(u.a)(e,2),o=t[0],r=t[1];return a.createElement(ke,{key:r,system:o,scale:n,systemKey:r})})),t.map((function(t){var o=Object(u.a)(t,2),r=o[0],i=o[1];return a.createElement(xe,{key:i,goal:r,scale:n,onClick:function(n){c&&(null==m?v(n):(e.createConnection({from:m,to:n}),v(void 0),l(!1)))},goalKey:i,selectedGoal:m})})),a.createElement(Me,null)),a.createElement(d.a,{elevation:10,style:{position:"absolute",top:70,left:20,opacity:.7,display:"flex",flexDirection:"column"}},a.createElement(Oe.a,{title:"Add Goal"},a.createElement(je.a,{onClick:function(){var n=prompt("Enter goal name");if(null!=n){var t={labels:[],name:n,bounds:{left:-e.config.value.cameraPosition.x,top:-e.config.value.cameraPosition.y,height:300,width:400}};e.createGoal(t)}}},a.createElement(F.a,null,"add"))),a.createElement(Oe.a,{title:"Add System"},a.createElement(je.a,{onClick:function(){var n=prompt("Enter system name");if(null!=n){var t={name:n,labels:[],bounds:{left:-e.config.value.cameraPosition.x,top:-e.config.value.cameraPosition.y,height:300,width:400}};e.createSystem(t)}}},a.createElement(F.a,null,"add"))),a.createElement(Oe.a,{title:"Toggle Connection creation"},a.createElement(je.a,{onClick:function(){c?(v(void 0),l(!1)):l(!0)}},a.createElement(F.a,{color:c?"secondary":"inherit"},"trending_flat")))))}var Le=window.firebase;var De=function(){var e=o.a.useState(1),n=Object(u.a)(e,2),t=n[0],a=n[1],r=o.a.useMemo((function(){return new W}),[]),i=o.a.useMemo((function(){return new se}),[]);return o.a.useEffect((function(){var e=U("username"),n=U("password");console.log(r),console.log(i);var t=!1,a=localStorage.getItem("uid"),o=function(e){t||(t=!0,r.loadFromFirebase(e),i.loadFromFirebase(e))};null!=a&&o(a),Le.auth().signInWithEmailAndPassword(e,n).then((function(e){localStorage.setItem("uid",e.user.uid),o(e.user.uid)})).catch((function(e){alert(e.message),null==a?window.location.reload():o(a)}))}),[r,i]),o.a.createElement(D.Provider,{value:r},o.a.createElement(ue.Provider,{value:i},o.a.createElement(c.a,null),o.a.createElement(l.a,{position:"static"},o.a.createElement(s.a,{value:t,onChange:function(e,n){return a(n)},centered:!0},o.a.createElement(f.a,{label:"Setup Currencies"}),o.a.createElement(f.a,{label:"Exchange"}),o.a.createElement(f.a,{label:"Setup Exchange Rates"}),o.a.createElement(f.a,{label:"Systems"}))),3===t&&o.a.createElement(Re,null),3!==t&&o.a.createElement(m.a,{marginTop:5,flex:1,minWidth:"75%"},o.a.createElement(d.a,null,0===t&&o.a.createElement(H,null),1===t&&o.a.createElement(P,null),2===t&&o.a.createElement(q,null)))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(o.a.createElement(De,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[111,1,2]]]);
//# sourceMappingURL=main.38c67699.chunk.js.map