{"version":3,"sources":["data/PLSDB.ts","Utils.tsx","Components/Pages/ExchangePage.tsx","hooks/useIsSmallScreen.ts","Components/Pages/SetupCurrencies.tsx","Components/Pages/SetupExchangeRates.tsx","data/SystemsDB.ts","Components/Pages/Systems/Canvas.tsx","Components/Pages/Systems/BorderTrigger.tsx","Components/Pages/Systems/CanvasNode.tsx","Components/Pages/Systems/GoalView.tsx","Components/Pages/Systems/SystemView.tsx","Components/Pages/Systems/ConnectionsView.tsx","Components/Pages/Systems/SystemsPage.tsx","Components/App.tsx","serviceWorker.ts","index.tsx"],"names":["PLSDBContext","React","createContext","firebase","window","usePLSDBContext","result","useContext","Error","PLSDatabase","currencies","BehaviorSubject","exchangeRates","bank","dbRef","combineLatest","this","pipe","skip","distinct","debounceTime","subscribe","next","save","currency","newValue","value","find","x","name","Object","assign","push","map","bankOf","v","Math","max","exchangeRate","canExchange","take","newBank","from","to","rate","filter","uid","firestore","enablePersistence","then","console","log","catch","err","error","database","ref","on","s","JSON","parse","val","set","stringify","useObservable","obs","defaultValue","useState","setValue","useEffect","sub","unsubscribe","getOrAskUser","key","localStorage","getItem","prompt","setItem","ExchangeButtonBase","onDone","innerRef","db","MenuItem","disabled","onClick","exchange","unit","ExchangeButton","forwardRef","props","ExchangeItem","getExchangeRates","currentValue","anchorEl","setAnchorEl","handleClose","Card","variant","style","margin","Box","padding","display","flexDirection","Typography","Button","event","currentTarget","aria-controls","aria-haspopup","Menu","id","keepMounted","open","onClose","item","addToBank","SpendItem","canSpend1","canSpend","length","ExchangePage","getCurrencies","alignItems","flexWrap","justifyContent","isSource","Divider","useIsSmallScreen","useMediaQuery","CurrencyItem","isNew","setName","icon","setIcon","description","setDescription","setIsSource","isTime","setIsTime","setUnit","isSmallScreen","isEdited","content","Icon","TextField","label","onChange","e","target","Checkbox","checked","addOrUpdateCurrency","removeCurrency","SetupCurrencies","i","Item","setFrom","setTo","toString","rateValue","setRateValue","Number","isValid","isNaN","FormControl","InputLabel","Select","labelId","d","marginX","inputMode","addOrUpdateExchangeRate","removeExchangeRate","SetupExchangeRates","rates","PLACEHOLDER_GOAL","bounds","top","height","left","width","labels","SystemsDBContext","useSystemsDBContext","toKey","obj","SystemsDB","_forceUpdate","goals","connections","systems","config","zoomLevel","cameraPosition","y","updated","alert","goal","_system","sysSubject","throttleTime","system","a","b","flatMap","updateFromDiff","data","old","_new","indexedOldTargets","targetsDiff","_olds","news","newAdded","existed","outer","deleted","includes","findDiff","targetUpdateResult","forEach","_subject","useStyles","makeStyles","rootContainer","innerContainer","position","calculateTransform","Canvas","containerRef","useRef","positionRef","styles","size","setSize","isHoldingMouseMiddleButton","keyCode","isDown","setIsDown","onMouseDown","button","onMouseUp","document","addEventListener","removeEventListener","useIsHoldinMouseKey","setScale","useMemo","updateDbConfig","useCallback","updateInnerRefStyle","animate","current","innerText","toPrecision","ANIMATION","setAttribute","onKeyUp","_doUpdateScale","onMouseWheel","deltaY","useLayoutEffect","body","cursor","onMouseMove","movementX","movementY","calculateAndUpdateSize","innerHeight","getBoundingClientRect","innerWidth","fromEvent","className","overflow","children","bottom","right","opacity","BorderTrigger","rowStyle","cornerStyle","borderWidth","hLineStyle","flex","vLineStyle","onMouseEnter","onTL","undefined","state","onMouseLeave","onT","onTR","onL","onR","onBL","onB","onBR","CanvasNode","isHoldingBorder","updateManager","initial","forceRefresh","setVal","c","useForceUpdate","lastBorderState","update","calculate","filteredResult","setTimeout","sendUpdate","updates","scale","handle","onDrag","positionOffset","offsetPosition","GoalView","isSelected","selectedGoal","updateGoalWithKey","goalKey","getGoalInitialValue","tap","_pos","toFixed","_bounds","elevation","userSelect","confirm","deleteGoal","fontSize","alignSelf","newName","dangerouslySetInnerHTML","__html","Chip","labelValue","color","SystemView","systemGoals","getSystemGoals","systemKey","updateSystemWithKey","getSystemInitialValue","systemNameBorder","borderColor","borderStyle","borderRadius","borderTopLeftRadius","pointerEvents","deleteSystem","paddingLeft","paddingRight","borderLeft","borderTop","borderRight","ConnectionsView","getConnectionsWithKeys","stroke","fill","strokeWidth","connection","ConnectionView","fromGoalKey","toGoalKey","getGoalWithKey","getBoxToBoxArrow","bow","sx","sy","cx","cy","ex","ey","endAngleAsDegrees","PI","r","deleteConnection","points","transform","SystemsPage","getZoomLevel","getGoalsWithKey","getSystemsWithKey","isInCreateConnectionMode","setIsInCreateConnectionMode","selectedFirstGoal","setSelectedFirstGoal","createConnection","Tooltip","title","IconButton","goalName","createGoal","systemName","createSystem","App","page","setPage","plsDb","systemsDb","username","password","didSetupDb","localUID","setupIfNeeded","loadFromFirebase","auth","signInWithEmailAndPassword","user","message","location","reload","Provider","CssBaseline","AppBar","Tabs","_","centered","Tab","marginTop","minWidth","Boolean","hostname","match","ReactDOM","render","getElementById","navigator","serviceWorker","ready","registration","unregister"],"mappings":"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","file":"static/js/main.38c67699.chunk.js","sourcesContent":["import { Observable, BehaviorSubject, combineLatest } from \"rxjs\";\nimport { map, take, skip, distinct, debounceTime } from \"rxjs/operators\";\nimport React from \"react\";\n\nexport const PLSDBContext = React.createContext<PLSDatabase | null>(null);\nconst firebase = (window as any).firebase;\nexport function usePLSDBContext(): PLSDatabase {\n  const result = React.useContext(PLSDBContext);\n  if (result == null)\n    throw new Error(\"useDBContext used outside of the context\");\n  return result;\n}\nexport type Currency = {\n  name: string;\n  unit: string;\n  isTime: boolean;\n  isSource: boolean;\n  icon: string;\n  description: string;\n};\n\nexport type ExchangeRate = {\n  from: Currency;\n  to: Currency;\n  rate: number;\n};\n\nexport type Bank = { [key: string]: number };\n\nexport class PLSDatabase {\n  constructor() {\n    combineLatest(\n      this.bank.pipe(skip(1), distinct()),\n      this.exchangeRates.pipe(skip(1), distinct()),\n      this.currencies.pipe(skip(1), distinct())\n    )\n      .pipe(debounceTime(1000))\n      .subscribe({ next: () => this.save() });\n  }\n\n  private currencies = new BehaviorSubject<Currency[]>([]);\n  private exchangeRates = new BehaviorSubject<ExchangeRate[]>([]);\n  private bank = new BehaviorSubject<Bank>({});\n\n  addOrUpdateCurrency(currency: Currency) {\n    const newValue = [...this.currencies.value];\n    const result = newValue.find((x) => x.name === currency.name);\n    if (result != null) {\n      Object.assign(result, currency);\n    } else {\n      newValue.push(currency);\n    }\n    this.currencies.next(newValue);\n  }\n\n  bankOf(currency: Currency): Observable<number> {\n    return this.bank.pipe(\n      map((bank) => {\n        return bank[currency.name] ?? 0;\n      })\n    );\n  }\n\n  canSpend(currency: Currency, value: number): Observable<boolean> {\n    return this.bankOf(currency).pipe(map((v) => v - value >= 0));\n  }\n\n  addToBank(currency: Currency, value: number) {\n    this.bank.next({\n      ...this.bank.value,\n      [currency.name]: Math.max(\n        0,\n        (this.bank.value[currency.name] ?? 0) + value\n      ),\n    });\n  }\n\n  exchange(exchangeRate: ExchangeRate, value: number) {\n    this.canExchange(exchangeRate, value)\n      .pipe(take(1))\n      .subscribe({\n        next: (canExchange) => {\n          if (canExchange) {\n            const newBank = { ...this.bank.value };\n            if (newBank[exchangeRate.from.name] == null) {\n              newBank[exchangeRate.from.name] = 0;\n            }\n            newBank[exchangeRate.from.name] -= value;\n            if (newBank[exchangeRate.to.name] == null) {\n              newBank[exchangeRate.to.name] = 0;\n            }\n            newBank[exchangeRate.to.name] += value * exchangeRate.rate;\n            this.bank.next(newBank);\n          }\n        },\n      });\n  }\n\n  canExchange(exchangeRate: ExchangeRate, value: number): Observable<boolean> {\n    return this.bankOf(exchangeRate.from).pipe(map((v) => v >= value));\n  }\n\n  removeCurrency(currency: Currency) {\n    this.currencies.next(\n      this.currencies.value.filter((x) => x.name !== currency.name)\n    );\n  }\n\n  addOrUpdateExchangeRate(rate: ExchangeRate) {\n    const newValue = [...this.exchangeRates.value];\n    const result = newValue.find(\n      (x) => x.from.name === rate.from.name && x.to.name === rate.to.name\n    );\n    if (result != null) {\n      Object.assign(result, rate);\n    } else {\n      newValue.push(rate);\n    }\n    this.exchangeRates.next(newValue);\n  }\n\n  removeExchangeRate(rate: ExchangeRate) {\n    this.exchangeRates.next(\n      this.exchangeRates.value.filter(\n        (x) => x.from.name !== rate.from.name || x.to.name !== rate.to.name\n      )\n    );\n  }\n\n  getCurrencies(): Observable<Currency[]> {\n    return this.currencies;\n  }\n\n  getExchangeRates(): Observable<ExchangeRate[]> {\n    return this.exchangeRates;\n  }\n\n  dbRef: any;\n\n  loadFromFirebase(uid: string) {\n    firebase.firestore().enablePersistence()\n      .then(x => console.log(\"OK enablePersistence\", x))\n      .catch(err => console.error(\"NOK enablePersistence\", err));\n    this.dbRef = firebase.database().ref(`sync_data/${uid}`);\n    console.log(this.dbRef);\n    this.dbRef.on(\"value\", (s: any) => {\n      const result = JSON.parse(s.val() ?? \"{}\");\n      this.currencies.next(result[\"currencies\"] ?? []);\n      this.exchangeRates.next(result[\"exchangeRates\"] ?? []);\n      this.bank.next(result[\"bank\"] ?? {});\n      console.log(\"Updating\");\n    });\n  }\n\n  save() {\n    const result = {\n      currencies: this.currencies.value,\n      exchangeRates: this.exchangeRates.value,\n      bank: this.bank.value,\n    };\n    this.dbRef.set(JSON.stringify(result));\n    console.log(\"Saving\");\n  }\n}\n\nexport function CreateOrGetDefaultPLSDatabase(): PLSDatabase {\n  const db = new PLSDatabase();\n  return db;\n}\n","import { Observable } from \"rxjs\";\nimport React from \"react\";\nexport function useObservable<T>(\n  obs: Observable<T> | (() => Observable<T>),\n  defaultValue: T\n): T {\n  const [value, setValue] = React.useState(defaultValue);\n  React.useEffect(() => {\n    const _obs = typeof obs === \"function\" ? obs() : obs;\n    const sub = _obs.subscribe({\n      next: (v) => {\n        setValue(v);\n      },\n    });\n    return () => sub.unsubscribe();\n    // TODO: it doens't support when obs changes\n    // eslint-disable-next-line\n  }, []);\n  return value;\n}\n\nexport function getOrAskUser(key: string): string {\n  let value = localStorage.getItem(key);\n  if (value == null) {\n    value = prompt(key) ?? \"\";\n    localStorage.setItem(key, value);\n  }\n  return value;\n}\n\nexport function useForceUpdate(): VoidFunction {\n  const [, setVal] = React.useState(0);\n  const cb = React.useCallback(() => setVal((c) => c + 1), []);\n  return cb;\n}\n","import React from \"react\";\nimport {\n  Box,\n  Typography,\n  Divider,\n  Button,\n  Card,\n  MenuItem,\n  Menu,\n} from \"@material-ui/core\";\nimport { usePLSDBContext, Currency, ExchangeRate } from \"../../data/PLSDB\";\nimport { useObservable } from \"../../Utils\";\ntype ExchangeButtonBaseProps = {\n  exchangeRate: ExchangeRate;\n  value: number;\n  onDone: () => void;\n  innerRef: any;\n};\nfunction ExchangeButtonBase({\n  exchangeRate,\n  value,\n  onDone,\n  innerRef,\n}: ExchangeButtonBaseProps) {\n  const db = usePLSDBContext();\n  const canExchange = useObservable(db.canExchange(exchangeRate, value), false);\n  return (\n    <MenuItem\n      disabled={!canExchange}\n      innerRef={innerRef}\n      onClick={() => {\n        db.exchange(exchangeRate, value);\n        onDone();\n      }}\n    >{`1 ${exchangeRate.from.unit} of ${exchangeRate.from.name} to ${\n      value * exchangeRate.rate\n    } ${exchangeRate.to.unit} of ${exchangeRate.to.name}`}</MenuItem>\n  );\n}\n\nconst ExchangeButton = React.forwardRef((props: Omit<ExchangeButtonBaseProps, \"innerRef\">, ref) => (\n  <ExchangeButtonBase {...props} innerRef={ref} />\n));\n\nfunction ExchangeItem({ currency }: { currency: Currency }) {\n  const db = usePLSDBContext();\n  const exchangeRates = useObservable(db.getExchangeRates(), []);\n  const currentValue = useObservable(db.bankOf(currency), 0);\n  const [anchorEl, setAnchorEl] = React.useState<Element | null>(null);\n  const handleClose = () => {\n    setAnchorEl(null);\n  };\n\n  return (\n    <Card variant={\"outlined\"} style={{ margin: 3 }}>\n      <Box padding={2} display={\"flex\"} flexDirection={\"column\"}>\n        <Typography>{`${currentValue} ${currency.unit} of ${currency.name}`}</Typography>\n        <Button\n          onClick={(event) => setAnchorEl(event.currentTarget)}\n          aria-controls=\"menu\"\n          aria-haspopup=\"true\"\n        >\n          {\"Exchange\"}\n        </Button>\n        <Menu\n          id=\"menu\"\n          anchorEl={anchorEl}\n          keepMounted\n          open={anchorEl != null}\n          onClose={handleClose}\n        >\n          {exchangeRates\n            .filter((x) => x.from.name === currency.name)\n            .map((item) => (\n              <ExchangeButton\n                key={item.from.name + \"_\" + item.to.name}\n                exchangeRate={item}\n                value={1}\n                onDone={handleClose}\n              />\n            ))}\n        </Menu>\n        <Box display={\"flex\"} flexDirection={\"row\"}>\n          <Button onClick={(event) => db.addToBank(currency, 1)}>{\"+1\"}</Button>\n          <Button onClick={(event) => db.addToBank(currency, -1)}>\n            {\"-1\"}\n          </Button>\n        </Box>\n      </Box>\n    </Card>\n  );\n}\n\nfunction SpendItem({ currency }: { currency: Currency }) {\n  const db = usePLSDBContext();\n  const currentValue = useObservable(db.bankOf(currency), 0);\n  const canSpend1 = useObservable(db.canSpend(currency, 1), false);\n  const exchangeRates = useObservable(db.getExchangeRates(), []).filter(\n    (x) => x.from.name === currency.name\n  );\n  const [anchorEl, setAnchorEl] = React.useState<Element | null>(null);\n  const handleClose = () => {\n    setAnchorEl(null);\n  };\n  return (\n    <Card variant={\"outlined\"} style={{ margin: 3 }}>\n      <Box padding={2} display={\"flex\"} flexDirection={\"column\"}>\n        <Typography>{`${currentValue} ${currency.unit} of ${currency.name}`}</Typography>\n        {exchangeRates.length > 0 && (\n          <>\n            <Button\n              onClick={(event) => setAnchorEl(event.currentTarget)}\n              aria-controls=\"menu\"\n              aria-haspopup=\"true\"\n            >\n              {\"Exchange\"}\n            </Button>\n            <Menu\n              id=\"menu\"\n              anchorEl={anchorEl}\n              keepMounted\n              open={anchorEl != null}\n              onClose={handleClose}\n            >\n              {exchangeRates\n                .filter((x) => x.from.name === currency.name)\n                .map((item) => (\n                  <ExchangeButton\n                    key={item.from.name + \"_\" + item.to.name}\n                    exchangeRate={item}\n                    value={1}\n                    onDone={handleClose}\n                  />\n                ))}\n            </Menu>\n          </>\n        )}\n        <Button\n          disabled={!canSpend1}\n          onClick={() => db.addToBank(currency, -1)}\n        >{`Spend 1 ${currency.unit}`}</Button>\n      </Box>\n    </Card>\n  );\n}\n\nexport function ExchangePage() {\n  const db = usePLSDBContext();\n  const currencies = useObservable(db.getCurrencies(), []);\n\n  return (\n    <Box display={\"flex\"} flexDirection={\"column\"} alignItems={\"center\"}>\n      <Typography variant={\"h5\"}>{\"Exchange\"}</Typography>\n      <Box\n        display={\"flex\"}\n        flexWrap={\"wrap\"}\n        flexDirection={\"row\"}\n        justifyContent={\"center\"}\n      >\n        {currencies\n          .filter((x) => x.isSource)\n          .map((currency) => (\n            <ExchangeItem key={currency.name} currency={currency} />\n          ))}\n      </Box>\n      <Divider variant={\"middle\"} />\n      <Typography variant={\"h5\"}>{\"Spend\"}</Typography>\n      <Box\n        display={\"flex\"}\n        flexWrap={\"wrap\"}\n        flexDirection={\"row\"}\n        justifyContent={\"center\"}\n      >\n        {currencies\n          .filter((x) => !x.isSource)\n          .map((currency) => (\n            <SpendItem key={currency.name} currency={currency} />\n          ))}\n      </Box>\n    </Box>\n  );\n}\n","import { useMediaQuery } from '@material-ui/core';\n\nexport function useIsSmallScreen() {\n  return useMediaQuery('(max-width:425px)');\n}\n","import React from \"react\";\nimport { Currency, usePLSDBContext } from \"../../data/PLSDB\";\nimport { useObservable } from \"../../Utils\";\nimport {\n  Box,\n  Icon,\n  Checkbox,\n  Button,\n  TextField,\n  Typography,\n  Card,\n} from \"@material-ui/core\";\nimport { useIsSmallScreen } from \"../../hooks/useIsSmallScreen\";\n\nfunction CurrencyItem({\n  currency,\n  isNew,\n}: {\n  currency: Currency;\n  isNew: boolean;\n}) {\n  const db = usePLSDBContext();\n  const [name, setName] = React.useState(() => currency.name);\n  const [icon, setIcon] = React.useState(() => currency.icon);\n  const [description, setDescription] = React.useState(\n    () => currency.description\n  );\n  const [isSource, setIsSource] = React.useState(() => currency.isSource);\n  const [isTime, setIsTime] = React.useState(() => currency.isTime);\n  const [unit, setUnit] = React.useState(() => currency.unit);\n  const isSmallScreen = useIsSmallScreen();\n  const isEdited =\n    name !== currency.name ||\n    icon !== currency.icon ||\n    description !== currency.description ||\n    isTime !== currency.isTime ||\n    unit !== currency.unit ||\n    isSource !== currency.isSource;\n\n  const content = (\n    <>\n      {!isNew && <Icon>{currency.icon}</Icon>}\n      {isNew && (\n        <TextField\n          label={\"Icon\"}\n          value={icon}\n          onChange={(e) => setIcon(e.target.value)}\n        />\n      )}\n      <TextField\n        label={\"Name\"}\n        value={name}\n        onChange={(e) => setName(e.target.value)}\n      />\n      <TextField\n        label={\"Description\"}\n        value={description}\n        onChange={(e) => setDescription(e.target.value)}\n      />\n      <TextField\n        label={\"Unit\"}\n        value={unit}\n        onChange={(e) => setUnit(e.target.value)}\n      />\n\n      <Checkbox checked={isTime} onChange={(e, v) => setIsTime(v)} />\n      <Typography>{\"Is time\"}</Typography>\n      <Checkbox checked={isSource} onChange={(e, v) => setIsSource(v)} />\n      <Typography>{\"Is source\"}</Typography>\n      {isEdited && (\n        <Button\n          onClick={() => {\n            db.addOrUpdateCurrency({\n              name,\n              icon,\n              description,\n              isTime,\n              unit,\n              isSource,\n            });\n          }}\n        >\n          <Icon>{\"save\"}</Icon>\n        </Button>\n      )}\n\n      {!isNew && (\n        <Button\n          onClick={() => {\n            db.removeCurrency(currency);\n          }}\n        >\n          <Icon>{\"delete\"}</Icon>\n        </Button>\n      )}\n    </>\n  );\n\n  if (isSmallScreen)\n    return (\n      <Card style={{ margin: 15 }}>\n        <Box\n          display={\"flex\"}\n          flexDirection={\"column\"}\n          alignItems={\"center\"}\n          justifyContent={\"space-between\"}\n          padding={1}\n        >\n          {content}\n        </Box>\n      </Card>\n    );\n\n  return (\n    <Box\n      display={\"flex\"}\n      flexDirection={\"row\"}\n      alignItems={\"center\"}\n      margin={1}\n      justifyContent={\"space-between\"}\n    >\n      {content}\n    </Box>\n  );\n}\n\nexport function SetupCurrencies() {\n  const db = usePLSDBContext();\n  const currencies = useObservable(db.getCurrencies(), []);\n  return (\n    <Box display={\"flex\"} flexDirection={\"column\"}>\n      {currencies.map((currency, i) => (\n        <CurrencyItem key={currency.name} currency={currency} isNew={false} />\n      ))}\n      <CurrencyItem\n        key={`new_currency_item_${currencies.length}`}\n        currency={{\n          name: `New currency ${currencies.length + 1}`,\n          description: \"\",\n          icon: \"\",\n          isSource: false,\n          isTime: false,\n          unit: \"hour\",\n        }}\n        isNew={true}\n      />\n    </Box>\n  );\n}\n","import React from \"react\";\nimport { ExchangeRate, usePLSDBContext } from \"../../data/PLSDB\";\nimport { useObservable } from \"../../Utils\";\nimport {\n  Box,\n  Icon,\n  Button,\n  TextField,\n  Typography,\n  FormControl,\n  InputLabel,\n  MenuItem,\n  Select,\n  Card,\n} from \"@material-ui/core\";\nimport { useIsSmallScreen } from \"../../hooks/useIsSmallScreen\";\n\nfunction Item({ rate, isNew }: { rate?: ExchangeRate; isNew: boolean }) {\n  const db = usePLSDBContext();\n  const currencies = useObservable(db.getCurrencies(), []);\n  const [from, setFrom] = React.useState(() => rate?.from);\n  const [to, setTo] = React.useState(() => rate?.to);\n  const [rateValue, setRateValue] = React.useState(\n    () => rate?.rate.toString() ?? \"\"\n  );\n  const isSmallScreen = useIsSmallScreen();\n\n  const isEdited =\n    from?.name !== rate?.from.name ||\n    to?.name !== rate?.to.name ||\n    Number(rateValue) !== rate?.rate;\n  const isValid =\n    !isNaN(Number(rateValue)) &&\n    from != null &&\n    to != null &&\n    Number(rateValue) > 0;\n\n  const content = (\n    <>\n      <Box display={\"flex\"} flexDirection={\"row\"}>\n        <FormControl>\n          <InputLabel id=\"from-label-id\">{\"From\"}</InputLabel>\n          <Select\n            labelId=\"from-label-id\"\n            value={from?.name}\n            onChange={(e: any, d: any) =>\n              setFrom(currencies.find((x) => x.name === e.target.value))\n            }\n          >\n            <MenuItem>{\"-\"}</MenuItem>\n            {currencies\n              .filter((x) => x.name !== to?.name)\n              .map((currency, i) => (\n                <MenuItem key={currency.name + \"_from\"} value={currency.name}>\n                  {currency.name}\n                </MenuItem>\n              ))}\n          </Select>\n        </FormControl>\n        <Box marginX={1} />\n        <TextField\n          value={rateValue}\n          inputMode={\"decimal\"}\n          onChange={(e) => setRateValue(e.target.value)}\n          label={\"Rate\"}\n        />\n        <Box marginX={1} />\n        <FormControl>\n          <InputLabel id=\"to-label-id\">{\"To\"}</InputLabel>\n          <Select\n            labelId=\"to-label-id\"\n            value={to?.name}\n            onChange={(e: any, d: any) =>\n              setTo(currencies.find((x) => x.name === e.target.value))\n            }\n          >\n            <MenuItem>{\"-\"}</MenuItem>\n            {currencies\n              .filter((x) => x.name !== from?.name)\n              .map((currency, i) => (\n                <MenuItem key={currency.name + \"_to\"} value={currency.name}>\n                  {currency.name}\n                </MenuItem>\n              ))}\n          </Select>\n        </FormControl>\n      </Box>\n      {isValid && (\n        <Typography>{`1 ${from?.unit} of ${from?.name} = ${Number(rateValue)} ${\n          to?.unit\n        } of ${to?.name}`}</Typography>\n      )}\n\n      <Box display={\"flex\"} flexDirection={\"row\"}>\n        {isEdited && isValid && (\n          <Button\n            onClick={() => {\n              if (from == null || to == null) return;\n              db.addOrUpdateExchangeRate({\n                from: from,\n                to: to,\n                rate: Number(rateValue),\n              });\n            }}\n          >\n            <Icon>{\"save\"}</Icon>\n          </Button>\n        )}\n\n        {!isNew && rate != null && (\n          <Button\n            onClick={() => {\n              db.removeExchangeRate(rate);\n            }}\n          >\n            <Icon>{\"delete\"}</Icon>\n          </Button>\n        )}\n      </Box>\n    </>\n  );\n\n  if (isSmallScreen)\n    return (\n      <Card style={{ margin: 10 }}>\n        <Box\n          display={\"flex\"}\n          flexDirection={\"column\"}\n          alignItems={\"center\"}\n          margin={1}\n        >\n          {content}\n        </Box>\n      </Card>\n    );\n\n  return (\n    <Box\n      display={\"flex\"}\n      flexDirection={\"row\"}\n      alignItems={\"center\"}\n      margin={1}\n      justifyContent={\"space-between\"}\n    >\n      {content}\n    </Box>\n  );\n}\n\nexport function SetupExchangeRates() {\n  const db = usePLSDBContext();\n  const rates = useObservable(db.getExchangeRates(), []);\n  return (\n    <Box display={\"flex\"} flexDirection={\"column\"}>\n      {rates.map((rate, i) => (\n        <Item\n          key={rate.from.name + \"_\" + rate.to.name + \"_\" + rate.rate}\n          rate={rate}\n          isNew={false}\n        />\n      ))}\n      <Item key={rates.length} isNew={true} />\n    </Box>\n  );\n}\n","import * as React from \"react\";\nimport { Observable, BehaviorSubject, combineLatest } from \"rxjs\";\nimport {\n  distinct,\n  map,\n  skip,\n  debounceTime,\n  flatMap,\n  throttleTime,\n} from \"rxjs/operators\";\nconst PLACEHOLDER_GOAL = {\n  bounds: { top: 0, height: 50, left: 0, width: 50 },\n  name: \"\",\n  labels: [],\n};\nconst firebase = (window as any).firebase;\nexport const SystemsDBContext = React.createContext<SystemsDB | null>(null);\nexport function useSystemsDBContext(): SystemsDB {\n  const result = React.useContext(SystemsDBContext);\n  if (result == null)\n    throw new Error(\"useDBContext used outside of the context\");\n  return result;\n}\n\nexport type Goal = {\n  name: string;\n  labels: string[];\n  bounds: Rect;\n};\n\nexport type Connection = {\n  from: string;\n  to: string;\n};\n\nexport type Rect = {\n  left: number;\n  top: number;\n  width: number;\n  height: number;\n};\n\nexport type System = {\n  name: string;\n  labels: string[];\n  bounds: Rect;\n};\n\nexport type Position = { x: number; y: number };\n\nexport type Config = {\n  zoomLevel: number;\n  cameraPosition: Position;\n};\n\nexport function toKey(obj: Goal | Connection | System): string {\n  if (obj[\"name\"] != null) return obj[\"name\"];\n  return obj[\"from\"] + \":\" + obj[\"to\"];\n}\n\nexport class SystemsDB {\n  private _forceUpdate = new BehaviorSubject(null);\n  private goals = new BehaviorSubject<BehaviorSubject<Goal>[]>([]);\n  private connections = new BehaviorSubject<BehaviorSubject<Connection>[]>([]);\n  private systems = new BehaviorSubject<BehaviorSubject<System>[]>([]);\n  config = new BehaviorSubject({\n    zoomLevel: 1,\n    cameraPosition: { x: 0, y: 0 },\n  });\n\n  constructor() {\n    combineLatest(\n      this.goals.pipe(\n        skip(1),\n        map((x) => JSON.stringify(x.map((x) => x.value))),\n        distinct()\n      ),\n      this.connections.pipe(\n        skip(1),\n        map((x) => JSON.stringify(x.map((x) => x.value))),\n        distinct()\n      ),\n      this.systems.pipe(\n        skip(1),\n        map((x) => JSON.stringify(x.map((x) => x.value))),\n        distinct()\n      ),\n      this.config.pipe(\n        skip(1),\n        map((x) => JSON.stringify(x)),\n        distinct()\n      ),\n      this._forceUpdate\n    )\n      .pipe(debounceTime(1000))\n      .subscribe({ next: () => this.save() });\n  }\n\n  getGoalInitialValue(key: string): Goal {\n    const result = this.goals.value.find((x) => toKey(x.value) === key)?.value;\n    if (result == null) return PLACEHOLDER_GOAL;\n    return result;\n  }\n\n  getGoalWithKey(key: string): Observable<Goal> {\n    const result = this.goals.value.find((x) => toKey(x.value) === key);\n    if (result == null) return new BehaviorSubject(PLACEHOLDER_GOAL);\n    return result;\n  }\n\n  updateGoalWithKey(key: string, updated: (current: Goal) => Goal) {\n    const result = this.goals.value.find((x) => toKey(x.value) === key);\n    if (result == null) return;\n    const newValue = updated(result.value);\n    if (\n      this.goals.value.find(\n        (x) => toKey(x.value) === toKey(newValue) && x !== result\n      ) != null\n    ) {\n      alert(\"There is already another goal with this name\");\n      return;\n    } else {\n      result.next(newValue);\n      this._forceUpdate.next(null);\n    }\n  }\n\n  deleteGoal(key: string) {\n    // let goal: Goal | null = null;\n    this.goals.next(\n      this.goals.value.filter((x) => {\n        if (toKey(x.value) !== key) {\n          // goal = x.value;\n          return true;\n        }\n        return false;\n      })\n    );\n    // if (goal != null) {\n    //   const goalKey = toKey(goal);\n    //   this.connections.next(\n    //     this.connections.value.filter(\n    //       (x) => x.value.from === goalKey || x.value.to === goalKey\n    //     )\n    //   );\n    // }\n  }\n\n  createGoal(goal: Goal) {\n    this.goals.next([...this.goals.value, new BehaviorSubject(goal)]);\n  }\n\n  getZoomLevel(): Observable<number> {\n    return this.config.pipe(\n      distinct(),\n      map((x) => x.zoomLevel)\n    );\n  }\n\n  getCameraPosition(): Observable<Position> {\n    return this.config.pipe(\n      distinct(),\n      map((x) => x.cameraPosition)\n    );\n  }\n\n  getGoalsWithKey(): Observable<[Observable<Goal>, string][]> {\n    return this.goals.pipe(map((x) => x.map((y) => [y, toKey(y.value)])));\n  }\n\n  getSystemsWithKey(): Observable<[Observable<System>, string][]> {\n    return this.systems.pipe(map((x) => x.map((y) => [y, toKey(y.value)])));\n  }\n\n  getConnectionsWithKeys(): Observable<[Connection, string][]> {\n    return this.connections.pipe(\n      map((x) => x.map((y) => [y.value, toKey(y.value)]))\n    );\n  }\n\n  deleteConnection(key: string) {\n    this.connections.next(\n      this.connections.value.filter((x) => toKey(x.value) !== key)\n    );\n  }\n\n  createConnection({ from, to }: { from: Goal; to: Goal }) {\n    this.connections.next([\n      ...this.connections.value,\n      new BehaviorSubject({ from: toKey(from), to: toKey(to) }),\n    ]);\n  }\n\n  getSystemGoals(_system: System | string): Observable<Observable<Goal>[]> {\n    const sysSubject = this.systems.value.find(\n      (x) =>\n        toKey(x.value) ===\n        (typeof _system === \"string\" ? _system : toKey(_system))\n    );\n    if (sysSubject == null) throw new Error(\"System not found\");\n    return combineLatest(sysSubject, this.goals).pipe(\n      throttleTime(30),\n      map(([system]) =>\n        this.goals.pipe(\n          throttleTime(30),\n          map((x) =>\n            x.filter((x) => isBoundAinY(x.value.bounds, system.bounds))\n          )\n        )\n      ),\n      flatMap((x) => x)\n    );\n  }\n\n  getSystemInitialValue(key: string): System {\n    const result = this.systems.value.find((x) => toKey(x.value) === key)\n      ?.value;\n    if (result == null) throw new Error(\"System not found\");\n    return result;\n  }\n\n  updateSystemWithKey(key: string, updated: (current: System) => System) {\n    const result = this.systems.value.find((x) => toKey(x.value) === key);\n    if (result == null) throw new Error(\"System not found\");\n    const newValue = updated(result.value);\n    if (\n      this.systems.value.find(\n        (x) => toKey(x.value) === toKey(newValue) && x !== result\n      ) != null\n    ) {\n      alert(\"There is already another goal with this name\");\n      return;\n    } else {\n      result.next(newValue);\n      this._forceUpdate.next(null);\n    }\n  }\n\n  deleteSystem(key: string) {\n    this.systems.next(this.systems.value.filter((x) => toKey(x.value) !== key));\n  }\n\n  createSystem(goal: Goal) {\n    this.systems.next([...this.systems.value, new BehaviorSubject(goal)]);\n  }\n\n  dbRef: any;\n\n  loadFromFirebase(uid: string) {\n    this.dbRef = firebase.database().ref(`systems/${uid}`);\n    this.dbRef.on(\"value\", (s: any) => {\n      console.log(\"Updating Systems\");\n      const result = JSON.parse(s.val() ?? \"{}\");\n      const goals: Goal[] = result[\"goals\"] ?? [];\n      const systems: System[] = result[\"systems\"] ?? [];\n      const connections: Connection[] = result[\"connections\"] ?? [];\n      const config: Config = result[\"config\"] ?? {\n        zoomLevel: 1,\n        cameraPosition: { x: 0, y: 0 },\n      };\n      if (JSON.stringify(config) !== JSON.stringify(this.config.value))\n        this.config.next(config);\n      updateFromDiff(this.goals, goals);\n      updateFromDiff(this.systems, systems);\n      updateFromDiff(this.connections, connections);\n    });\n  }\n\n  save() {\n    const result = {\n      goals: this.goals.value.map((x) => x.value),\n      systems: this.systems.value.map((x) => x.value),\n      connections: this.connections.value.map((x) => x.value),\n      config: this.config.value,\n    };\n    const data = JSON.stringify(result);\n    this.dbRef.set(data);\n    console.log(\"Saving Systems\");\n  }\n}\n\ntype SystesmDBEntities = System | Goal | Connection;\n\nfunction updateFromDiff<T extends SystesmDBEntities>(\n  old: BehaviorSubject<BehaviorSubject<T>[]>,\n  _new: T[]\n) {\n  const indexedOldTargets: {\n    [key: string]: BehaviorSubject<T>;\n  } = {};\n  const oldTargets = old.value.map((v) => {\n    indexedOldTargets[toKey(v.value)] = v;\n    return v.value;\n  });\n\n  const targetsDiff = findDiff(oldTargets, _new);\n  const targetUpdateResult: BehaviorSubject<T>[] = [\n    ...targetsDiff.newAdded.map((x) => new BehaviorSubject(x)),\n  ];\n  targetsDiff.existed.forEach((item) => {\n    const _subject = indexedOldTargets[toKey(item)];\n    targetUpdateResult.push(_subject);\n    if (JSON.stringify(_subject.value) !== JSON.stringify(item)) {\n      _subject.next(item);\n    }\n  });\n  old.next(targetUpdateResult);\n}\n\nfunction findDiff<T extends SystesmDBEntities>(\n  _olds: T[],\n  news: T[]\n): {\n  newAdded: T[];\n  deleted: T[];\n  existed: T[];\n} {\n  const newAdded: T[] = [];\n  const existed: T[] = [];\n  outer: for (const _new of news) {\n    for (const _old of _olds) {\n      if (toKey(_old) === toKey(_new)) {\n        existed.push(_new);\n        continue outer;\n      }\n    }\n    newAdded.push(_new);\n  }\n  const deleted = _olds.filter(\n    (x) => !existed.map((x) => toKey(x)).includes(toKey(x))\n  );\n\n  return {\n    newAdded,\n    deleted,\n    existed,\n  };\n}\n\nif (process.env.NODE_ENV === \"development\") {\n  // TODO: add these to test\n  const _win = window as any;\n  const connSet1: any[] = [\n    {\n      name: \"a\",\n      labels: [\"test1\"],\n    },\n    {\n      name: \"b\",\n    },\n    {\n      name: \"c\",\n    },\n  ];\n  const connSet2: any[] = [\n    {\n      name: \"a\",\n      labels: [],\n    },\n\n    {\n      name: \"c\",\n    },\n    {\n      name: \"k\",\n    },\n  ];\n  _win.findDiff = () => findDiff(connSet1, connSet2);\n}\n\nfunction isBoundAinY(a: Rect, b: Rect): boolean {\n  if (a.left <= b.left) return false;\n  if (a.top <= b.top) return false;\n  if (a.left + a.width >= b.left + b.width) return false;\n  if (a.top + a.height >= b.top + b.height) return false;\n\n  return true;\n}\n\nexport function CreateOrGetDefaultSystemsDatabase(): SystemsDB {\n  const db = new SystemsDB();\n  return db;\n}\n","import React from \"react\";\nimport { fromEvent, BehaviorSubject } from \"rxjs\";\nimport { debounceTime, take, skip } from \"rxjs/operators\";\nimport { makeStyles } from \"@material-ui/styles\";\nimport { Config, useSystemsDBContext } from \"../../../data/SystemsDB\";\n\nconst useStyles = makeStyles({\n  rootContainer: {\n    \"&::-webkit-scrollbar\": {\n      display: \"none\",\n    },\n  },\n  innerContainer: {\n    // TODO: max everything width + padding\n    width: \"100%\",\n    // TODO: max everyhing height + padding\n    height: \"100%\",\n    position: \"relative\",\n  },\n});\n\nfunction useIsHoldinMouseKey(keyCode: number): boolean {\n  const [isDown, setIsDown] = React.useState(false);\n  React.useEffect(() => {\n    const onMouseDown = (e: MouseEvent) => {\n      if (e.button === keyCode) setIsDown(true);\n    };\n    const onMouseUp = (e: MouseEvent) => {\n      if (e.button === keyCode) setIsDown(false);\n    };\n    window.document.addEventListener(\"mousedown\", onMouseDown);\n    window.document.addEventListener(\"mouseup\", onMouseUp);\n    return () => {\n      window.document.removeEventListener(\"mousedown\", onMouseDown);\n      window.document.removeEventListener(\"mouseup\", onMouseUp);\n    };\n  }, [keyCode]);\n  return isDown;\n}\n\nfunction calculateTransform({ zoomLevel, cameraPosition }: Config): string {\n  return `transform:translate(${cameraPosition.x}px,${cameraPosition.y}px) scale(${zoomLevel})`;\n}\n\nexport function Canvas(props: React.Props<{}>) {\n  const containerRef = React.useRef<HTMLDivElement>();\n  const innerRef = React.useRef<HTMLDivElement>();\n  const positionRef = React.useRef<HTMLParagraphElement>();\n  const db = useSystemsDBContext();\n  const styles = useStyles({});\n  const [size, setSize] = React.useState({ width: 0, height: 0 });\n  const isHoldingMouseMiddleButton = useIsHoldinMouseKey(1);\n  const [, setScale] = React.useState(1);\n  const config = React.useMemo<Config>(() => db.config.value, [db]);\n\n  const updateDbConfig = React.useCallback(() => {\n    db.config.next(config);\n  }, [db.config, config]);\n\n  const updateInnerRefStyle = React.useCallback(\n    (animate: boolean = false) => {\n      if (innerRef.current == null)\n        throw new Error(\"Unhandled situtation innerRef cannot be null here\");\n      if (positionRef.current != null) {\n        positionRef.current.innerText = `${config.cameraPosition.x}, ${\n          config.cameraPosition.y\n        } (x${config.zoomLevel.toPrecision(2)})`;\n      }\n\n      let value = calculateTransform(config);\n      const ANIMATION = \";transition: transform 100ms\";\n      if (animate) {\n        innerRef.current.setAttribute(\n          \"style\",\n          innerRef.current.style + ANIMATION\n        );\n        value += ANIMATION;\n      }\n\n      innerRef.current.setAttribute(\"style\", value);\n    },\n    [innerRef, config, positionRef]\n  );\n\n  React.useEffect(() => {\n    updateInnerRefStyle(false);\n  }, [updateInnerRefStyle]);\n\n  React.useEffect(() => {\n    // skip default value and wait for server value\n    const sub = db.config.pipe(skip(1), take(1)).subscribe({\n      next: (v) => {\n        config.cameraPosition = v.cameraPosition;\n        config.zoomLevel = v.zoomLevel;\n        updateInnerRefStyle(false);\n      },\n    });\n    return () => sub.unsubscribe();\n  }, [db, config, updateInnerRefStyle]);\n\n  // on space reset zoom to 1\n  React.useEffect(() => {\n    const onKeyUp = (e: KeyboardEvent) => {\n      const SPACE_KEY_CODE = 32;\n      if (e.keyCode === SPACE_KEY_CODE) {\n        config.zoomLevel = 1;\n        updateInnerRefStyle(true);\n        updateDbConfig();\n      }\n    };\n    window.document.addEventListener(\"keyup\", onKeyUp);\n    return () => window.document.removeEventListener(\"keyup\", onKeyUp);\n  }, [updateInnerRefStyle, config, updateDbConfig]);\n\n  // zoom\n  React.useEffect(() => {\n    const _doUpdateScale = new BehaviorSubject(null);\n    const sub = _doUpdateScale.pipe(debounceTime(100)).subscribe({\n      next: () => setScale(config.zoomLevel),\n    });\n    const onMouseWheel = (e: WheelEvent) => {\n      config.zoomLevel = Math.max(0.1, config.zoomLevel + e.deltaY * -0.0005);\n      updateDbConfig();\n      updateInnerRefStyle(true);\n      _doUpdateScale.next(null);\n    };\n    window.document.addEventListener(\"wheel\", onMouseWheel);\n    return () => {\n      window.document.removeEventListener(\"wheel\", onMouseWheel);\n      sub.unsubscribe();\n    };\n  }, [updateInnerRefStyle, config, updateDbConfig]);\n\n  React.useLayoutEffect(() => {\n    if (!isHoldingMouseMiddleButton) {\n      document.body.style.cursor = \"default\";\n      return;\n    } else {\n      document.body.style.cursor = \"move\";\n    }\n\n    const onMouseMove = (e: MouseEvent) => {\n      config.cameraPosition.x += e.movementX;\n      config.cameraPosition.y += e.movementY;\n      updateDbConfig();\n      // we directly update innerRef attribute because of performance resaons\n      updateInnerRefStyle();\n    };\n    document.addEventListener(\"mousemove\", onMouseMove);\n    return () => document.removeEventListener(\"mousemove\", onMouseMove);\n  }, [\n    isHoldingMouseMiddleButton,\n    innerRef,\n    updateInnerRefStyle,\n    config,\n    updateDbConfig,\n  ]);\n\n  // setup width and height\n  React.useLayoutEffect(() => {\n    const calculateAndUpdateSize = () => {\n      if (containerRef.current == null) throw new Error(\"Unhandled situtation\");\n      const height =\n        window.innerHeight - containerRef.current.getBoundingClientRect().top;\n      const width = window.innerWidth;\n      setSize({ height, width });\n    };\n    calculateAndUpdateSize();\n    const sub = fromEvent(window, \"resize\")\n      .pipe(debounceTime(50))\n      .subscribe({ next: () => calculateAndUpdateSize() });\n\n    return () => sub.unsubscribe();\n  }, [containerRef]);\n\n  return (\n    <div\n      ref={containerRef as any}\n      className={styles.rootContainer}\n      id=\"canvas\"\n      style={{\n        width: size.width,\n        height: size.height,\n        position: \"relative\",\n        overflow: \"hidden\",\n      }}\n    >\n      <div ref={innerRef as any} className={styles.innerContainer}>\n        {props.children}\n      </div>\n      <p\n        ref={positionRef as any}\n        style={{ position: \"absolute\", bottom: 0, right: 20, opacity: 0.5 }}\n      ></p>\n    </div>\n  );\n}\n","import React from \"react\";\n\ntype BorderTriggerEvent = {\n  state: \"entered\" | \"exited\";\n};\n\ntype TriggerEvent = (e: BorderTriggerEvent) => void;\n\nexport function BorderTrigger(props: {\n  children: React.ReactNode;\n  borderWidth: number;\n  style?: React.CSSProperties;\n  onTL?: TriggerEvent;\n  onT?: TriggerEvent;\n  onTR?: TriggerEvent;\n  onL?: TriggerEvent;\n  onR?: TriggerEvent;\n  onBL?: TriggerEvent;\n  onB?: TriggerEvent;\n  onBR?: TriggerEvent;\n  onMouseDown?: (e: React.MouseEvent<HTMLDivElement, MouseEvent>) => void;\n  onMouseMove?: (e: React.MouseEvent<HTMLDivElement, MouseEvent>) => void;\n  onMouseUp?: (e: React.MouseEvent<HTMLDivElement, MouseEvent>) => void;\n}) {\n  /*\n  [ ]---------[ ]\n   |           |\n   |   child   |\n   |           |\n  [ ]---------[ ]\n  */\n  const rowStyle: React.CSSProperties = {\n    display: \"flex\",\n    flexDirection: \"row\",\n  };\n  const cornerStyle: React.CSSProperties = {\n    width: props.borderWidth,\n    height: props.borderWidth,\n  };\n  const hLineStyle: React.CSSProperties = {\n    flex: 1,\n    height: props.borderWidth,\n  };\n  const vLineStyle: React.CSSProperties = {\n    width: props.borderWidth,\n  };\n  return (\n    <div\n      style={{\n        ...(props.style ?? {}),\n        display: \"flex\",\n        flexDirection: \"column\",\n      }}\n      onMouseMove={props.onMouseMove}\n    >\n      <div style={rowStyle}>\n        <div\n          onMouseEnter={\n            props.onTL == null\n              ? undefined\n              : () => props.onTL!({ state: \"entered\" })\n          }\n          onMouseLeave={\n            props.onTL == null\n              ? undefined\n              : () => props.onTL!({ state: \"exited\" })\n          }\n          onMouseDown={props.onMouseDown}\n          onMouseUp={props.onMouseUp}\n          style={{ ...cornerStyle, cursor: \"nw-resize\" }}\n        ></div>\n        <div\n          onMouseEnter={\n            props.onT == null\n              ? undefined\n              : () => props.onT!({ state: \"entered\" })\n          }\n          onMouseLeave={\n            props.onT == null\n              ? undefined\n              : () => props.onT!({ state: \"exited\" })\n          }\n          onMouseDown={props.onMouseDown}\n          onMouseUp={props.onMouseUp}\n          style={{ ...hLineStyle, cursor: \"n-resize\" }}\n        ></div>\n        <div\n          onMouseEnter={\n            props.onTR == null\n              ? undefined\n              : () => props.onTR!({ state: \"entered\" })\n          }\n          onMouseLeave={\n            props.onTR == null\n              ? undefined\n              : () => props.onTR!({ state: \"exited\" })\n          }\n          onMouseDown={props.onMouseDown}\n          onMouseUp={props.onMouseUp}\n          style={{ ...cornerStyle, cursor: \"ne-resize\" }}\n        ></div>\n      </div>\n      <div style={rowStyle}>\n        <div\n          onMouseEnter={\n            props.onL == null\n              ? undefined\n              : () => props.onL!({ state: \"entered\" })\n          }\n          onMouseLeave={\n            props.onL == null\n              ? undefined\n              : () => props.onL!({ state: \"exited\" })\n          }\n          onMouseDown={props.onMouseDown}\n          onMouseUp={props.onMouseUp}\n          style={{ ...vLineStyle, cursor: \"w-resize\" }}\n        ></div>\n        <div style={{width: \"100%\", height: \"100%\"}}>{props.children}</div>\n        <div\n          onMouseEnter={\n            props.onR == null\n              ? undefined\n              : () => props.onR!({ state: \"entered\" })\n          }\n          onMouseLeave={\n            props.onR == null\n              ? undefined\n              : () => props.onR!({ state: \"exited\" })\n          }\n          onMouseDown={props.onMouseDown}\n          onMouseUp={props.onMouseUp}\n          style={{ ...vLineStyle, cursor: \"w-resize\" }}\n        ></div>\n      </div>\n      <div style={rowStyle}>\n        <div\n          onMouseEnter={\n            props.onBL == null\n              ? undefined\n              : () => props.onBL!({ state: \"entered\" })\n          }\n          onMouseLeave={\n            props.onBL == null\n              ? undefined\n              : () => props.onBL!({ state: \"exited\" })\n          }\n          onMouseDown={props.onMouseDown}\n          onMouseUp={props.onMouseUp}\n          style={{ ...cornerStyle, cursor: \"sw-resize\" }}\n        ></div>\n        <div\n          onMouseEnter={\n            props.onB == null\n              ? undefined\n              : () => props.onB!({ state: \"entered\" })\n          }\n          onMouseLeave={\n            props.onB == null\n              ? undefined\n              : () => props.onB!({ state: \"exited\" })\n          }\n          onMouseDown={props.onMouseDown}\n          onMouseUp={props.onMouseUp}\n          style={{ ...hLineStyle, cursor: \"n-resize\" }}\n        ></div>\n        <div\n          onMouseEnter={\n            props.onBR == null\n              ? undefined\n              : () => props.onBR!({ state: \"entered\" })\n          }\n          onMouseLeave={\n            props.onBR == null\n              ? undefined\n              : () => props.onBR!({ state: \"exited\" })\n          }\n          onMouseDown={props.onMouseDown}\n          onMouseUp={props.onMouseUp}\n          style={{ ...cornerStyle, cursor: \"se-resize\" }}\n        ></div>\n      </div>\n    </div>\n  );\n}\n","import * as React from \"react\";\n\nimport Draggable from \"react-draggable\";\nimport { Rect } from \"../../../data/SystemsDB\";\nimport { BorderTrigger } from \"./BorderTrigger\";\nimport { Observable } from \"rxjs\";\nimport { filter } from \"rxjs/operators\";\nimport { useForceUpdate } from \"../../../Utils\";\n\nexport type UpdateManager = {\n  updates: Observable<Rect>;\n  sendUpdate: (e: Rect) => void;\n  initial: Rect;\n};\n\nexport function CanvasNode(props: {\n  children: (bounds: Rect) => React.ReactNode;\n  scale: number;\n  updateManager: UpdateManager;\n  offsetPosition?: { x: number, y: number}\n}) {\n  const isHoldingBorder = React.useRef(false);\n  const containerRef = React.useRef<HTMLDivElement>();\n  const bounds = React.useMemo<Rect>(() => props.updateManager.initial, [\n    props.updateManager,\n  ]);\n  const forceRefresh = useForceUpdate();\n  const lastBorderState = React.useRef<\n    \"tl\" | \"t\" | \"tr\" | \"l\" | \"r\" | \"br\" | \"b\" | \"bl\" | \"none\"\n  >(\"none\");\n\n  const update = React.useCallback(\n    (calculate: (c: Rect) => Rect) => {\n      const result = calculate(bounds);\n      const filteredResult = {\n        ...result,\n        width: Math.max(result.width, 100),\n        height: Math.max(result.height, 70),\n      };\n      Object.assign(bounds, filteredResult);\n      forceRefresh();\n      setTimeout(() => props.updateManager.sendUpdate(bounds), 50);\n    },\n    [bounds, forceRefresh, props.updateManager]\n  );\n\n  React.useEffect(() => {\n    const sub = props.updateManager.updates\n      .pipe(\n        filter(\n          (x) =>\n            x.width !== bounds.width ||\n            x.height !== bounds.height ||\n            x.top !== bounds.top ||\n            x.left !== bounds.left\n        )\n      )\n      .subscribe({\n        next: (v) => update(() => v),\n      });\n    return () => sub.unsubscribe();\n  }, [props.updateManager, bounds, update]);\n\n  React.useEffect(() => {\n    const onMouseMove = (e: MouseEvent) => {\n      if (!isHoldingBorder.current) return;\n      const movementX = e.movementX;\n      const movementY = e.movementY;\n\n      if (lastBorderState.current === \"r\")\n        update((c) => ({\n          ...c,\n          width: c.width + movementX,\n        }));\n      if (lastBorderState.current === \"br\")\n        update((c) => ({\n          ...c,\n          width: c.width + movementX,\n          height: c.height + movementY,\n        }));\n      if (lastBorderState.current === \"b\")\n        update((c) => ({\n          ...c,\n          height: c.height + movementY,\n        }));\n      if (lastBorderState.current === \"bl\")\n        update((c) => ({\n          ...c,\n          width: c.width + -movementX,\n          left: c.left + movementX,\n          height: c.height + movementY,\n        }));\n      if (lastBorderState.current === \"l\")\n        update((c) => ({\n          ...c,\n          width: c.width + -movementX,\n          left: c.left + movementX,\n        }));\n      if (lastBorderState.current === \"tl\")\n        update((c) => ({\n          ...c,\n          width: c.width + -movementX,\n          top: c.top + movementY,\n          left: c.left + movementX,\n          height: c.height + -movementY,\n        }));\n      if (lastBorderState.current === \"t\")\n        update((c) => ({\n          ...c,\n          top: c.top + movementY,\n          height: c.height + -movementY,\n        }));\n      if (lastBorderState.current === \"tr\")\n        update((c) => ({\n          ...c,\n          width: c.width + movementX,\n          top: c.top + movementY,\n          height: c.height + -movementY,\n        }));\n    };\n    const onMouseUp = (e: MouseEvent) => {\n      isHoldingBorder.current = false;\n    };\n    document.addEventListener(\"mousemove\", onMouseMove);\n    document.addEventListener(\"mouseup\", onMouseUp);\n    return () => {\n      document.removeEventListener(\"mousemove\", onMouseMove);\n      document.removeEventListener(\"mouseup\", onMouseUp);\n    };\n  }, [isHoldingBorder, lastBorderState, props.scale, update]);\n\n  const onMouseDown = (e: React.MouseEvent<HTMLDivElement, MouseEvent>) => {\n    isHoldingBorder.current = true;\n  };\n  return (\n    <Draggable\n      handle=\".handle\"\n      position={{ x: bounds.left, y: bounds.top }}\n      onDrag={(e, d) => {\n        update((c) => ({\n          ...c,\n          left: d.x,\n          top: d.y,\n        }));\n      }}\n      positionOffset={props.offsetPosition}\n      scale={props.scale}\n    >\n      <div ref={containerRef as any} style={{ position: \"absolute\" }}>\n        <BorderTrigger\n          onMouseDown={onMouseDown}\n          borderWidth={10}\n          onL={() =>\n            !isHoldingBorder.current && (lastBorderState.current = \"l\")\n          }\n          onR={() =>\n            !isHoldingBorder.current && (lastBorderState.current = \"r\")\n          }\n          onTL={() =>\n            !isHoldingBorder.current && (lastBorderState.current = \"tl\")\n          }\n          onT={() =>\n            !isHoldingBorder.current && (lastBorderState.current = \"t\")\n          }\n          onTR={() =>\n            !isHoldingBorder.current && (lastBorderState.current = \"tr\")\n          }\n          onBL={() =>\n            !isHoldingBorder.current && (lastBorderState.current = \"bl\")\n          }\n          onB={() =>\n            !isHoldingBorder.current && (lastBorderState.current = \"b\")\n          }\n          onBR={() =>\n            !isHoldingBorder.current && (lastBorderState.current = \"br\")\n          }\n        >\n          {props.children(bounds)}\n        </BorderTrigger>\n      </div>\n    </Draggable>\n  );\n}\n","import * as React from \"react\";\nimport { Card, Icon, Box, Chip } from \"@material-ui/core\";\nimport { Observable } from \"rxjs\";\nimport { map, tap } from \"rxjs/operators\";\nimport { CanvasNode, UpdateManager } from \"./CanvasNode\";\nimport { Goal, useSystemsDBContext } from \"../../../data/SystemsDB\";\nimport { useObservable } from \"../../../Utils\";\n\ntype GoalProps = {\n  goal: Observable<Goal>;\n  goalKey: string;\n  scale: number;\n  selectedGoal?: Goal;\n  onClick: (goal: Goal) => void;\n};\n\nexport function GoalView(props: GoalProps) {\n  const goal = useObservable(props.goal, null);\n  const isSelected = props.selectedGoal?.name === goal?.name;\n  const positionRef = React.useRef<HTMLParagraphElement>();\n  const db = useSystemsDBContext();\n  const updateManager = React.useMemo<UpdateManager>(\n    () => ({\n      sendUpdate: (v) =>\n        db.updateGoalWithKey(props.goalKey, (current) => ({\n          ...current,\n          bounds: v,\n        })),\n      initial: db.getGoalInitialValue(props.goalKey).bounds,\n      updates: props.goal.pipe(\n        map((v) => v.bounds),\n        tap((x) => {\n          if (positionRef.current != null) {\n            const _pos = `${x.left.toFixed(2)}, ${x.top.toFixed(2)}`;\n            const _bounds = `w${x.width.toFixed()}h${x.height.toFixed()}`;\n            positionRef.current.innerText = `${_pos} ${_bounds};`;\n          }\n        })\n      ),\n    }),\n    [props.goalKey, db, props.goal]\n  );\n  if (goal == null) return null;\n\n  return (\n    <CanvasNode updateManager={updateManager} scale={props.scale}>\n      {(bounds) => (\n        <Card\n          onClick={() => props.onClick(goal)}\n          elevation={4}\n          variant={isSelected ? \"elevation\" : \"outlined\"}\n          style={{\n            padding: 5,\n            width: bounds.width,\n            height: bounds.height,\n            display: \"flex\",\n            flexDirection: \"column\",\n            userSelect: \"none\",\n            justifyContent: \"space-between\",\n          }}\n        >\n          <div style={{ display: \"flex\", flexDirection: \"row\" }}>\n            <Icon className=\"handle\">{\"drag_handle\"}</Icon>\n            <Icon\n              style={{ cursor: \"pointer\" }}\n              onClick={() => {\n                const isConfirmed = window.confirm(\n                  \"Are you sure you want to delete this goal?\"\n                );\n                if (!isConfirmed) return;\n                db.deleteGoal(props.goalKey);\n              }}\n            >\n              {\"delete\"}\n            </Icon>\n          </div>\n          <div\n            style={{\n              display: \"flex\",\n              flexDirection: \"row\",\n              flexWrap: \"wrap\",\n              alignItems: \"baseline\",\n              fontSize: 30,\n              alignSelf: \"center\",\n              cursor: \"pointer\",\n            }}\n            className=\"content\"\n            onClick={() => {\n              const newName = prompt(\"Enter goal name\", goal.name);\n              if (newName == null) return;\n              db.updateGoalWithKey(props.goalKey, (c) => ({\n                ...c,\n                name: newName,\n              }));\n            }}\n            dangerouslySetInnerHTML={{ __html: goal.name }}\n          ></div>\n          <Box display=\"flex\" flexDirection=\"row\" flexWrap=\"warp\">\n            {goal.labels.map((label, i) => (\n              <Chip\n                onClick={() => {\n                  const isConfirmed = window.confirm(\n                    \"Are you sure you want to delete this label?\"\n                  );\n                  if (!isConfirmed) return;\n                  db.updateGoalWithKey(props.goalKey, (c) => ({\n                    ...c,\n                    labels: c.labels.filter((x) => x !== label),\n                  }));\n                }}\n                style={{ margin: 3 }}\n                size=\"small\"\n                key={i}\n                label={label}\n              />\n            ))}\n            <Chip\n              onClick={() => {\n                const labelValue = prompt(\"Enter label text\");\n                if (labelValue == null) return;\n                db.updateGoalWithKey(props.goalKey, (c) => ({\n                  ...c,\n                  labels: [...c.labels, labelValue],\n                }));\n              }}\n              style={{ margin: 3, cursor: \"pointer\" }}\n              size=\"small\"\n              color=\"primary\"\n              label={\"+\"}\n            />\n          </Box>\n          <p\n            ref={positionRef as any}\n            style={{ position: \"absolute\", bottom: 0, right: 20, opacity: 0.5 }}\n          ></p>\n        </Card>\n      )}\n    </CanvasNode>\n  );\n}\n","import * as React from \"react\";\nimport { Observable } from \"rxjs\";\nimport { map, tap } from \"rxjs/operators\";\nimport { CanvasNode, UpdateManager } from \"./CanvasNode\";\nimport { System, useSystemsDBContext } from \"../../../data/SystemsDB\";\nimport { useObservable } from \"../../../Utils\";\nimport { Icon } from \"@material-ui/core\";\n\ntype SystemProps = {\n  system: Observable<System>;\n  systemKey: string;\n  scale: number;\n  onClick?: (system: System) => void;\n};\n\nexport function SystemView(props: SystemProps) {\n  const system = useObservable(props.system, null);\n  const db = useSystemsDBContext();\n  const positionRef = React.useRef<HTMLParagraphElement>();\n  const systemGoals = useObservable(\n    () => db.getSystemGoals(props.systemKey),\n    []\n  );\n  const updateManager = React.useMemo<UpdateManager>(\n    () => ({\n      sendUpdate: (v) =>\n        db.updateSystemWithKey(props.systemKey, (current) => ({\n          ...current,\n          bounds: v,\n        })),\n      initial: db.getSystemInitialValue(props.systemKey).bounds,\n      updates: props.system.pipe(\n        map((v) => v.bounds),\n        tap((x) => {\n          if (positionRef.current != null) {\n            const _pos = `${x.left.toFixed(2)}, ${x.top.toFixed(2)}`;\n            const _bounds = `w${x.width.toFixed()}h${x.height.toFixed()}`;\n            positionRef.current.innerText = `${_pos} ${_bounds};`;\n          }\n        })\n      ),\n    }),\n    [props.systemKey, db, props.system]\n  );\n  if (system == null) return null;\n  const borderColor = \"rgba(0,0,0,0.6)\";\n  const systemNameBorder = `${borderColor} dashed`;\n  return (\n    <CanvasNode updateManager={updateManager} scale={props.scale}>\n      {(bounds) => (\n        <div\n          onClick={() => props.onClick != null && props.onClick(system)}\n          style={{\n            padding: 5,\n            width: bounds.width,\n            height: bounds.height,\n            display: \"flex\",\n            flexDirection: \"column\",\n            justifyContent: \"space-between\",\n            borderColor: borderColor,\n            borderWidth: 2,\n            borderStyle: \"dashed\",\n            borderRadius: 5,\n            borderTopLeftRadius: 0,\n            pointerEvents: \"visible\",\n          }}\n        >\n          <Icon className=\"handle\">{\"drag_handle\"}</Icon>\n          <Icon\n            style={{ cursor: \"pointer\", position: \"absolute\", left: 50 }}\n            onClick={() => {\n              const isConfirmed = window.confirm(\n                \"Are you sure you want to delete this system?\"\n              );\n              if (!isConfirmed) return;\n              db.deleteSystem(props.systemKey);\n            }}\n          >\n            {\"delete\"}\n          </Icon>\n          <p\n            style={{ position: \"absolute\", bottom: 0, left: 15 }}\n          >{`${systemGoals.length} Goals`}</p>\n          <div\n            style={{\n              position: \"absolute\",\n              top: -38,\n              fontSize: \"25pt\",\n              paddingLeft: 5,\n              paddingRight: 5,\n              left: 10,\n              borderLeft: systemNameBorder,\n              borderTop: systemNameBorder,\n              borderRight: systemNameBorder,\n              borderWidth: 2,\n            }}\n            onClick={() => {\n              const newName = prompt(\"Enter system name\", system.name);\n              if (newName == null) return;\n              db.updateSystemWithKey(props.systemKey, (c) => ({\n                ...c,\n                name: newName,\n              }));\n            }}\n            dangerouslySetInnerHTML={{ __html: system.name }}\n          ></div>\n          <p\n            ref={positionRef as any}\n            style={{ position: \"absolute\", bottom: 0, right: 20, opacity: 0.5 }}\n          ></p>\n        </div>\n      )}\n    </CanvasNode>\n  );\n}\n","import * as React from \"react\";\nimport { useSystemsDBContext, toKey } from \"../../../data/SystemsDB\";\nimport { getBoxToBoxArrow } from \"perfect-arrows\";\nimport { useObservable } from \"../../../Utils\";\ntype ConnectionProps = {};\n\nexport function ConnectionsView(props: ConnectionProps) {\n  const db = useSystemsDBContext();\n  const connections = useObservable(() => db.getConnectionsWithKeys(), []);\n  return (\n    <svg\n      style={{\n        width: \"100%\",\n        overflow: \"visible\",\n        height: \"100%\",\n      }}\n      stroke=\"#000\"\n      fill=\"#000\"\n      strokeWidth={3}\n    >\n      {connections.map(([connection, key]) => (\n        <ConnectionView\n          fromGoalKey={connection.from}\n          toGoalKey={connection.to}\n          key={key}\n        />\n      ))}\n    </svg>\n  );\n}\n\nfunction ConnectionView({\n  fromGoalKey,\n  toGoalKey,\n}: {\n  fromGoalKey: string;\n  toGoalKey: string;\n}) {\n  const db = useSystemsDBContext();\n  const from = useObservable(\n    () => db.getGoalWithKey(fromGoalKey),\n    db.getGoalInitialValue(fromGoalKey)\n  );\n  const to = useObservable(\n    () => db.getGoalWithKey(toGoalKey),\n    db.getGoalInitialValue(toGoalKey)\n  );\n  const [sx, sy, cx, cy, ex, ey, ae,] = getBoxToBoxArrow(\n    from.bounds.left,\n    from.bounds.top,\n    from.bounds.width + 20,\n    from.bounds.height + 20,\n    to.bounds.left,\n    to.bounds.top ,\n    to.bounds.width + 20,\n    to.bounds.height + 20, {\n      bow: 0.1\n    }\n  );\n\n  const endAngleAsDegrees = ae * (180 / Math.PI);\n  console.log(sx, sy);\n  return (\n    <>\n      <circle cx={sx} cy={sy} r={4} />\n      <path\n        d={`M${sx},${sy} Q${cx},${cy} ${ex},${ey}`}\n        fill=\"none\"\n        onClick={() => {\n          const isConfirmed = window.confirm(\n            \"Are you sure you want to delete this connection?\"\n          );\n          if (!isConfirmed) return;\n          db.deleteConnection(toKey({ from: fromGoalKey, to: toGoalKey }));\n        }}\n      />\n      <polygon\n        points=\"0,-6 12,0, 0,6\"\n        transform={`translate(${ex},${ey}) rotate(${endAngleAsDegrees})`}\n      />\n    </>\n  );\n}\n","import * as React from \"react\";\nimport { Canvas } from \"./Canvas\";\nimport { useSystemsDBContext, Goal, System } from \"../../../data/SystemsDB\";\nimport { useObservable } from \"../../../Utils\";\nimport { GoalView } from \"./GoalView\";\nimport { Card, IconButton, Icon, Tooltip } from \"@material-ui/core\";\nimport { SystemView } from \"./SystemView\";\nimport { ConnectionsView } from \"./ConnectionsView\";\n\nexport function SystemsPage() {\n  const db = useSystemsDBContext();\n  const scale = useObservable(() => db.getZoomLevel(), 1);\n  const goals = useObservable(() => db.getGoalsWithKey(), []);\n  const systems = useObservable(() => db.getSystemsWithKey(), []);\n  const [\n    isInCreateConnectionMode,\n    setIsInCreateConnectionMode,\n  ] = React.useState(false);\n\n  const [selectedFirstGoal, setSelectedFirstGoal] = React.useState<\n    Goal | undefined\n  >();\n\n  return (\n    <>\n      <Canvas>\n        {systems.map(([system, key]) => (\n          <SystemView key={key} system={system} scale={scale} systemKey={key} />\n        ))}\n\n        {goals.map(([goal, key]) => (\n          <GoalView\n            key={key}\n            goal={goal}\n            scale={scale}\n            onClick={(goal) => {\n              if (!isInCreateConnectionMode) return;\n              if (selectedFirstGoal == null) {\n                setSelectedFirstGoal(goal);\n              } else {\n                db.createConnection({\n                  from: selectedFirstGoal,\n                  to: goal,\n                });\n                setSelectedFirstGoal(undefined);\n                setIsInCreateConnectionMode(false);\n              }\n            }}\n            goalKey={key}\n            selectedGoal={selectedFirstGoal}\n          />\n        ))}\n        <ConnectionsView />\n      </Canvas>\n\n      <Card\n        elevation={10}\n        style={{\n          position: \"absolute\",\n          top: 70,\n          left: 20,\n          opacity: 0.7,\n          display: \"flex\",\n          flexDirection: \"column\",\n        }}\n      >\n        <Tooltip title=\"Add Goal\">\n          <IconButton\n            onClick={() => {\n              const goalName = prompt(\"Enter goal name\");\n              if (goalName == null) return;\n              const goal: Goal = {\n                labels: [],\n                name: goalName,\n                bounds: {\n                  left: -db.config.value.cameraPosition.x,\n                  top: -db.config.value.cameraPosition.y,\n                  height: 300,\n                  width: 400,\n                },\n              };\n              db.createGoal(goal);\n            }}\n          >\n            <Icon>{\"add\"}</Icon>\n          </IconButton>\n        </Tooltip>\n\n        <Tooltip title=\"Add System\">\n          <IconButton\n            onClick={() => {\n              const systemName = prompt(\"Enter system name\");\n              if (systemName == null) return;\n              const system: System = {\n                name: systemName,\n                labels: [],\n                bounds: {\n                  left: -db.config.value.cameraPosition.x,\n                  top: -db.config.value.cameraPosition.y,\n                  height: 300,\n                  width: 400,\n                },\n              };\n              db.createSystem(system);\n            }}\n          >\n            <Icon>{\"add\"}</Icon>\n          </IconButton>\n        </Tooltip>\n\n        <Tooltip title=\"Toggle Connection creation\">\n          <IconButton\n            onClick={() => {\n              if (isInCreateConnectionMode) {\n                setSelectedFirstGoal(undefined);\n                setIsInCreateConnectionMode(false);\n              } else {\n                setIsInCreateConnectionMode(true);\n              }\n            }}\n          >\n            <Icon color={isInCreateConnectionMode ? \"secondary\" : \"inherit\"}>\n              {\"trending_flat\"}\n            </Icon>\n          </IconButton>\n        </Tooltip>\n      </Card>\n    </>\n  );\n}\n","import React from \"react\";\nimport { CssBaseline, Box, Card, AppBar, Tab, Tabs } from \"@material-ui/core\";\nimport { ExchangePage } from \"./Pages/ExchangePage\";\nimport { SetupCurrencies } from \"./Pages/SetupCurrencies\";\nimport { SetupExchangeRates } from \"./Pages/SetupExchangeRates\";\nimport { PLSDBContext, CreateOrGetDefaultPLSDatabase } from \"../data/PLSDB\";\nimport { SystemsPage } from \"./Pages/Systems/SystemsPage\";\nimport { getOrAskUser } from \"../Utils\";\nimport {\n  CreateOrGetDefaultSystemsDatabase,\n  SystemsDBContext,\n} from \"../data/SystemsDB\";\nconst firebase = (window as any).firebase;\n\nfunction App() {\n  const [page, setPage] = React.useState(1);\n  const plsDb = React.useMemo(() => CreateOrGetDefaultPLSDatabase(), []);\n  const systemsDb = React.useMemo(\n    () => CreateOrGetDefaultSystemsDatabase(),\n    []\n  );\n  React.useEffect(() => {\n    const username = getOrAskUser(\"username\");\n    const password = getOrAskUser(\"password\");\n    console.log(plsDb);\n    console.log(systemsDb);\n    let didSetupDb = false;\n    const localUID = localStorage.getItem(\"uid\");\n    const setupIfNeeded = (uid: string) => {\n      if (didSetupDb) return;\n      didSetupDb = true;\n\n      plsDb.loadFromFirebase(uid);\n      systemsDb.loadFromFirebase(uid);\n    };\n    if (localUID != null) setupIfNeeded(localUID);\n    firebase\n      .auth()\n      .signInWithEmailAndPassword(username, password)\n      .then((r) => {\n        localStorage.setItem(\"uid\", r.user.uid);\n        setupIfNeeded(r.user.uid);\n      })\n      .catch((e) => {\n        alert(e.message);\n        if (localUID == null) window.location.reload();\n        else setupIfNeeded(localUID)\n      });\n  }, [plsDb, systemsDb]);\n  return (\n    <PLSDBContext.Provider value={plsDb}>\n      <SystemsDBContext.Provider value={systemsDb}>\n        <CssBaseline />\n        <AppBar position=\"static\">\n          <Tabs value={page} onChange={(_, x) => setPage(x)} centered>\n            <Tab label=\"Setup Currencies\" />\n            <Tab label=\"Exchange\" />\n            <Tab label=\"Setup Exchange Rates\" />\n            <Tab label=\"Systems\" />\n          </Tabs>\n        </AppBar>\n        {page === 3 && <SystemsPage />}\n        {page !== 3 && (\n          <Box marginTop={5} flex={1} minWidth={\"75%\"}>\n            <Card>\n              {page === 0 && <SetupCurrencies />}\n              {page === 1 && <ExchangePage />}\n              {page === 2 && <SetupExchangeRates />}\n            </Card>\n          </Box>\n        )}\n      </SystemsDBContext.Provider>\n    </PLSDBContext.Provider>\n  );\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      process.env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport App from \"./Components/App\";\nimport * as serviceWorker from \"./serviceWorker\";\n\nReactDOM.render(<App />, document.getElementById(\"root\"));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}