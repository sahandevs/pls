(this.webpackJsonppls=this.webpackJsonppls||[]).push([[0],{88:function(e,n,a){e.exports=a(96)},96:function(e,n,a){"use strict";a.r(n);var t=a(0),r=a.n(t),c=a(9),l=a.n(c),i=a(14),u=a(139),o=a(140),m=a(144),s=a(141),f=a(143),d=a(130),v=a(151),h=a(131),E=a(132),g=a(75),b=a(133),p=a(53),x=a(64),y=a(65),k=a(70),O=a(71),w=a(148),j=a(149),C=a(126),R=a(127),S=a(145),D=a(128),N=a(150),I=r.a.createContext(null),T=window.firebase;function _(){var e=r.a.useContext(I);if(null==e)throw new Error("useDBContext used outside of the context");return e}var F=function(){function e(){var n=this;Object(k.a)(this,e),this.currencies=new w.a([]),this.exchangeRates=new w.a([]),this.bank=new w.a({}),this.dbRef=void 0,Object(j.a)(this.bank.pipe(Object(C.a)(1),Object(R.a)()),this.exchangeRates.pipe(Object(C.a)(1),Object(R.a)()),this.currencies.pipe(Object(C.a)(1),Object(R.a)())).pipe(Object(S.a)(1e3)).subscribe({next:function(){return n.save()}})}return Object(O.a)(e,[{key:"addOrUpdateCurrency",value:function(e){var n=Object(y.a)(this.currencies.value),a=n.find((function(n){return n.name===e.name}));null!=a?Object.assign(a,e):n.push(e),this.currencies.next(n)}},{key:"bankOf",value:function(e){return this.bank.pipe(Object(D.a)((function(n){var a;return null!==(a=n[e.name])&&void 0!==a?a:0})))}},{key:"canSpend",value:function(e,n){return this.bankOf(e).pipe(Object(D.a)((function(e){return e-n>=0})))}},{key:"addToBank",value:function(e,n){var a;this.bank.next(Object(x.a)({},this.bank.value,Object(p.a)({},e.name,Math.max(0,(null!==(a=this.bank.value[e.name])&&void 0!==a?a:0)+n))))}},{key:"exchange",value:function(e,n){var a=this;this.canExchange(e,n).pipe(Object(N.a)(1)).subscribe({next:function(t){if(t){var r=Object(x.a)({},a.bank.value);null==r[e.from.name]&&(r[e.from.name]=0),r[e.from.name]-=n,null==r[e.to.name]&&(r[e.to.name]=0),r[e.to.name]+=n*e.rate,a.bank.next(r)}}})}},{key:"canExchange",value:function(e,n){return this.bankOf(e.from).pipe(Object(D.a)((function(e){return e>=n})))}},{key:"removeCurrency",value:function(e){this.currencies.next(this.currencies.value.filter((function(n){return n.name!==e.name})))}},{key:"addOrUpdateExchangeRate",value:function(e){var n=Object(y.a)(this.exchangeRates.value),a=n.find((function(n){return n.from.name===e.from.name&&n.to.name===e.to.name}));null!=a?Object.assign(a,e):n.push(e),this.exchangeRates.next(n)}},{key:"removeExchangeRate",value:function(e){this.exchangeRates.next(this.exchangeRates.value.filter((function(n){return n.from.name===e.from.name&&n.to.name===e.to.name})))}},{key:"getCurrencies",value:function(){return this.currencies}},{key:"getExchangeRates",value:function(){return this.exchangeRates}},{key:"loadFromFirebase",value:function(e){var n=this;this.dbRef=T.database().ref("sync_data/".concat(e)),this.dbRef.on("value",(function(e){var a,t,r,c,l=JSON.parse(null!==(a=e.val())&&void 0!==a?a:"{}");n.currencies.next(null!==(t=l.currencies)&&void 0!==t?t:[]),n.exchangeRates.next(null!==(r=l.exchangeRates)&&void 0!==r?r:[]),n.bank.next(null!==(c=l.bank)&&void 0!==c?c:{}),console.log("Updating")}))}},{key:"save",value:function(){var e={currencies:this.currencies.value,exchangeRates:this.exchangeRates.value,bank:this.bank.value};this.dbRef.set(JSON.stringify(e)),console.log("Saving")}}]),e}();function B(e){var n,a=localStorage.getItem(e);null==a&&(a=null!==(n=prompt(e))&&void 0!==n?n:"",localStorage.setItem(e,a));return a}function U(e,n){var a=r.a.useState(n),t=Object(i.a)(a,2),c=t[0],l=t[1];return r.a.useEffect((function(){var n=("function"===typeof e?e():e).subscribe({next:function(e){l(e)}});return function(){return n.unsubscribe()}}),[e]),c}function W(e){var n=e.exchangeRate,a=e.value,t=e.onDone,c=e.innerRef,l=_(),i=U(l.canExchange(n,a),!1);return r.a.createElement(v.a,{disabled:!i,innerRef:c,onClick:function(){l.exchange(n,a),t()}},"1 ".concat(n.from.unit," of ").concat(n.from.name," to ").concat(a*n.rate," ").concat(n.to.unit," of ").concat(n.to.name))}var M=r.a.forwardRef((function(e,n){return r.a.createElement(W,Object.assign({},e,{innerRef:n}))}));function J(e){var n=e.currency,a=_(),t=U(a.getExchangeRates(),[]),c=U(a.bankOf(n),0),l=r.a.useState(null),u=Object(i.a)(l,2),o=u[0],m=u[1],s=function(){m(null)};return r.a.createElement(d.a,{variant:"outlined",style:{margin:3}},r.a.createElement(f.a,{padding:2,display:"flex",flexDirection:"column"},r.a.createElement(h.a,null,"".concat(c," ").concat(n.unit," of ").concat(n.name)),r.a.createElement(E.a,{onClick:function(e){return m(e.currentTarget)},"aria-controls":"menu","aria-haspopup":"true"},"Exchange"),r.a.createElement(g.a,{id:"menu",anchorEl:o,keepMounted:!0,open:null!=o,onClose:s},t.filter((function(e){return e.from.name===n.name})).map((function(e){return r.a.createElement(M,{key:e.from.name+"_"+e.to.name,exchangeRate:e,value:1,onDone:s})}))),r.a.createElement(f.a,{display:"flex",flexDirection:"row"},r.a.createElement(E.a,{onClick:function(e){return a.addToBank(n,1)}},"+1"),r.a.createElement(E.a,{onClick:function(e){return a.addToBank(n,-1)}},"-1"))))}function P(e){var n=e.currency,a=_(),t=U(a.bankOf(n),0),c=U(a.canSpend(n,1),!1),l=U(a.getExchangeRates(),[]).filter((function(e){return e.from.name===n.name})),u=r.a.useState(null),o=Object(i.a)(u,2),m=o[0],s=o[1],v=function(){s(null)};return r.a.createElement(d.a,{variant:"outlined",style:{margin:3}},r.a.createElement(f.a,{padding:2,display:"flex",flexDirection:"column"},r.a.createElement(h.a,null,"".concat(t," ").concat(n.unit," of ").concat(n.name)),l.length>0&&r.a.createElement(r.a.Fragment,null,r.a.createElement(E.a,{onClick:function(e){return s(e.currentTarget)},"aria-controls":"menu","aria-haspopup":"true"},"Exchange"),r.a.createElement(g.a,{id:"menu",anchorEl:m,keepMounted:!0,open:null!=m,onClose:v},l.filter((function(e){return e.from.name===n.name})).map((function(e){return r.a.createElement(M,{key:e.from.name+"_"+e.to.name,exchangeRate:e,value:1,onDone:v})})))),r.a.createElement(E.a,{disabled:!c,onClick:function(){return a.addToBank(n,-1)}},"Spend 1 ".concat(n.unit))))}function X(){var e=U(_().getCurrencies(),[]);return r.a.createElement(f.a,{display:"flex",flexDirection:"column",alignItems:"center"},r.a.createElement(h.a,{variant:"h5"},"Exchange"),r.a.createElement(f.a,{display:"flex",flexWrap:"wrap",flexDirection:"row",justifyContent:"center"},e.filter((function(e){return e.isSource})).map((function(e){return r.a.createElement(J,{key:e.name,currency:e})}))),r.a.createElement(b.a,{variant:"middle"}),r.a.createElement(h.a,{variant:"h5"},"Spend"),r.a.createElement(f.a,{display:"flex",flexWrap:"wrap",flexDirection:"row",justifyContent:"center"},e.filter((function(e){return!e.isSource})).map((function(e){return r.a.createElement(P,{key:e.name,currency:e})}))))}var A=a(135),$=a(152),q=a(146),z=a(134);function G(){return Object(z.a)("(max-width:425px)")}function H(e){var n=e.currency,a=e.isNew,t=_(),c=r.a.useState((function(){return n.name})),l=Object(i.a)(c,2),u=l[0],o=l[1],m=r.a.useState((function(){return n.icon})),s=Object(i.a)(m,2),v=s[0],g=s[1],b=r.a.useState((function(){return n.description})),p=Object(i.a)(b,2),x=p[0],y=p[1],k=r.a.useState((function(){return n.isSource})),O=Object(i.a)(k,2),w=O[0],j=O[1],C=r.a.useState((function(){return n.isTime})),R=Object(i.a)(C,2),S=R[0],D=R[1],N=r.a.useState((function(){return n.unit})),I=Object(i.a)(N,2),T=I[0],F=I[1],B=G(),U=u!==n.name||v!==n.icon||x!==n.description||S!==n.isTime||T!==n.unit||w!==n.isSource,W=r.a.createElement(r.a.Fragment,null,!a&&r.a.createElement(A.a,null,n.icon),a&&r.a.createElement($.a,{label:"Icon",value:v,onChange:function(e){return g(e.target.value)}}),r.a.createElement($.a,{label:"Name",value:u,onChange:function(e){return o(e.target.value)}}),r.a.createElement($.a,{label:"Description",value:x,onChange:function(e){return y(e.target.value)}}),r.a.createElement($.a,{label:"Unit",value:T,onChange:function(e){return F(e.target.value)}}),r.a.createElement(q.a,{checked:S,onChange:function(e,n){return D(n)}}),r.a.createElement(h.a,null,"Is time"),r.a.createElement(q.a,{checked:w,onChange:function(e,n){return j(n)}}),r.a.createElement(h.a,null,"Is source"),U&&r.a.createElement(E.a,{onClick:function(){t.addOrUpdateCurrency({name:u,icon:v,description:x,isTime:S,unit:T,isSource:w})}},r.a.createElement(A.a,null,"save")),!a&&r.a.createElement(E.a,{onClick:function(){t.removeCurrency(n)}},r.a.createElement(A.a,null,"delete")));return B?r.a.createElement(d.a,{style:{margin:15}},r.a.createElement(f.a,{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"space-between",padding:1},W)):r.a.createElement(f.a,{display:"flex",flexDirection:"row",alignItems:"center",margin:1,justifyContent:"space-between"},W)}function K(){var e=U(_().getCurrencies(),[]);return r.a.createElement(f.a,{display:"flex",flexDirection:"column"},e.map((function(e,n){return r.a.createElement(H,{key:e.name,currency:e,isNew:!1})})),r.a.createElement(H,{key:"new_currency_item_".concat(e.length),currency:{name:"New currency ".concat(e.length+1),description:"",icon:"",isSource:!1,isTime:!1,unit:"hour"},isNew:!0}))}var L=a(138),Q=a(154),V=a(147);function Y(e){var n=e.rate,a=e.isNew,t=_(),c=U(t.getCurrencies(),[]),l=r.a.useState((function(){return null===n||void 0===n?void 0:n.from})),u=Object(i.a)(l,2),o=u[0],m=u[1],s=r.a.useState((function(){return null===n||void 0===n?void 0:n.to})),g=Object(i.a)(s,2),b=g[0],p=g[1],x=r.a.useState((function(){var e;return null!==(e=null===n||void 0===n?void 0:n.rate.toString())&&void 0!==e?e:""})),y=Object(i.a)(x,2),k=y[0],O=y[1],w=G(),j=(null===o||void 0===o?void 0:o.name)!==(null===n||void 0===n?void 0:n.from.name)||(null===b||void 0===b?void 0:b.name)!==(null===n||void 0===n?void 0:n.to.name)||Number(k)!==(null===n||void 0===n?void 0:n.rate),C=!isNaN(Number(k))&&null!=o&&null!=b&&Number(k)>0,R=r.a.createElement(r.a.Fragment,null,r.a.createElement(f.a,{display:"flex",flexDirection:"row"},r.a.createElement(L.a,null,r.a.createElement(Q.a,{id:"from-label-id"},"From"),r.a.createElement(V.a,{labelId:"from-label-id",value:null===o||void 0===o?void 0:o.name,onChange:function(e,n){return m(c.find((function(n){return n.name===e.target.value})))}},r.a.createElement(v.a,null,"-"),c.filter((function(e){return e.name!==(null===b||void 0===b?void 0:b.name)})).map((function(e,n){return r.a.createElement(v.a,{key:e.name+"_from",value:e.name},e.name)})))),r.a.createElement(f.a,{marginX:1}),r.a.createElement($.a,{value:k,inputMode:"decimal",onChange:function(e){return O(e.target.value)},label:"Rate"}),r.a.createElement(f.a,{marginX:1}),r.a.createElement(L.a,null,r.a.createElement(Q.a,{id:"to-label-id"},"To"),r.a.createElement(V.a,{labelId:"to-label-id",value:null===b||void 0===b?void 0:b.name,onChange:function(e,n){return p(c.find((function(n){return n.name===e.target.value})))}},r.a.createElement(v.a,null,"-"),c.filter((function(e){return e.name!==(null===o||void 0===o?void 0:o.name)})).map((function(e,n){return r.a.createElement(v.a,{key:e.name+"_to",value:e.name},e.name)}))))),C&&r.a.createElement(h.a,null,"1 ".concat(null===o||void 0===o?void 0:o.unit," of ").concat(null===o||void 0===o?void 0:o.name," = ").concat(Number(k)," ").concat(null===b||void 0===b?void 0:b.unit," of ").concat(null===b||void 0===b?void 0:b.name)),r.a.createElement(f.a,{display:"flex",flexDirection:"row"},j&&C&&r.a.createElement(E.a,{onClick:function(){null!=o&&null!=b&&t.addOrUpdateExchangeRate({from:o,to:b,rate:Number(k)})}},r.a.createElement(A.a,null,"save")),!a&&null!=n&&r.a.createElement(E.a,{onClick:function(){t.removeExchangeRate(n)}},r.a.createElement(A.a,null,"delete"))));return w?r.a.createElement(d.a,{style:{margin:10}},r.a.createElement(f.a,{display:"flex",flexDirection:"column",alignItems:"center",margin:1},R)):r.a.createElement(f.a,{display:"flex",flexDirection:"row",alignItems:"center",margin:1,justifyContent:"space-between"},R)}function Z(){var e=U(_().getExchangeRates(),[]);return r.a.createElement(f.a,{display:"flex",flexDirection:"column"},e.map((function(e,n){return r.a.createElement(Y,{key:e.from.name+"_"+e.to.name+"_"+e.rate,rate:e,isNew:!1})})),r.a.createElement(Y,{key:e.length,isNew:!0}))}var ee=function(){var e=r.a.useState(1),n=Object(i.a)(e,2),a=n[0],t=n[1],c=r.a.useMemo((function(){return function(){var e=new F,n=B("username"),a=B("password");return T.auth().signInWithEmailAndPassword(n,a).then((function(n){return e.loadFromFirebase(n.user.uid)})).catch((function(e){alert(e.message),window.location.reload()})),e}()}),[]);return r.a.createElement(I.Provider,{value:c},r.a.createElement(u.a,null),r.a.createElement(o.a,{position:"static"},r.a.createElement(m.a,{value:a,onChange:function(e,n){return t(n)},centered:!0},r.a.createElement(s.a,{label:"Setup Currencies"}),r.a.createElement(s.a,{label:"Exchange"}),r.a.createElement(s.a,{label:"Setup Exchange Rates"}))),r.a.createElement(f.a,{marginTop:5,flex:1,minWidth:"75%"},r.a.createElement(d.a,null,0===a&&r.a.createElement(K,null),1===a&&r.a.createElement(X,null),2===a&&r.a.createElement(Z,null))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));l.a.render(r.a.createElement(ee,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[88,1,2]]]);
//# sourceMappingURL=main.73ea3a5a.chunk.js.map